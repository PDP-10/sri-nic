
TOPS20 Change Order Number 4.1.1012

Written by: DBELL		10-Nov-79 11:07:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
Wrong BUGCHK typed when home block check IORB times out, in the PHYCHK
routine.  Instead of PHYCH2, you get PHYCH3, which implies some software
problem.

Diagnosis: 
At CHK5+3, MOVEI T1,(US.ACT) should be MOVSI T1,(US.ACT).

Solution: 
Do it.

[End of TCO 4.1.1012]


TOPS20 Change Order Number 4.1.1015

Written by: OSMAN		12-Nov-79 15:49:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: You don't get "not a switch - does not begin with a slash" anymore.
	Instead, you get "ambiguous"

Diagnosis: CMRFLD had code at CMRAT1 to check specially for crlf.

Solution: Remove the code and just call regular CMCIN instead.

[End of TCO 4.1.1015]


TOPS20 Change Order Number 4.1.1016

Written by: OSMAN		12-Nov-79 16:06:24

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND	MONSYM

Related TCO's:
Related SPR's: 


Problem: You used to be able to say

		@TYPE FOO.BAR<formfeed>

	and get the file's contents displayed at the top of a new page

Diagnosis: With the COMND jsys, the formfeed stuff got lost

Solution: Put it back.

[End of TCO 4.1.1016]


TOPS20 Change Order Number 4.1.1017

Written by: OSMAN		12-Nov-79 16:29:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PROLOG

Related TCO's:
Related SPR's: 


Problem: If a macro is redefined in MACSYM and is one that MONSYM uses,
then programs that search MONSYM,MACSYM continue to get the old definition

Diagnosis: MACSYM should be searched before MONSYM

Solution: In PROLOG, search MACSYM first

[End of TCO 4.1.1017]


TOPS20 Change Order Number 4.1.1018

Written by: R.ACE		13-Nov-79 07:01:32

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: EFACT JSYS STILL EXISTS.  IT IS A VESTIGE THAT HAS BEEN
SUPERSEDED BY THE USAGE JSYS.

Diagnosis: NO ONE HAS REMOVED IT YET.

Solution: TAKE IT OUT OF THE MONITOR AND OUT OF MONSYM.

[End of TCO 4.1.1018]


TOPS20 Change Order Number 4.1.1019

Written by: OSMAN		14-Nov-79 10:27:25

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: User's AC4 is still not preserved correctly during .CMTAD processing.

Diagnosis: UMOVE / UMOVEM confusion.  Also, the restore was happening
	prematurely.

Solution: Save user's AC4 early, and restore it just before returning.

[End of TCO 4.1.1019]


TOPS20 Change Order Number 4.1.1020

Written by: R.ACE		16-Nov-79 08:48:30

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 


Problem: WHEN USING "MSINCE" COMMAND IN DUMPER TO DO INCREMENTAL
SAVES, DUMPER DOES NOT SAVE FILES THAT WERE LAST MODIFIED PRIOR
TO THE "MSINCE" DATE AND RENAMED AFTER THE "MSINCE" DATE.

Diagnosis: RNAMF JSYS DOESN'T CHANGE THE DATE STORED IN THE .FBCRE
WORD OF THE FDB.  THE PHILOSOPHY OF THIS WORD SEEMS TO BE THAT IF
ANY CHARACTERISTIC OF THE FILE CHANGES (IN THIS CASE, THE NAME),
THEN THE .FBCRE DATE SHOULD CHANGE TOO.

Solution: CHANGE THE RENAME FUNCTION IN DISC TO UPDATE THE .FBCRE
DATE IN THE DESTINATION FDB.

NOTE:	THE MONITOR CALLS REFERENCE MANUAL SHOULD BE UPDATED FOR THIS.
	THE DESCRIPTION OF THE RNAMF JSYS SHOULD NOT CLAIM THAT THE
	.FBCRE WORD IS COPIED FROM THE SOURCE FILE TO THE DESTINATION.

[End of TCO 4.1.1020]


TOPS20 Change Order Number 4.1.1024

Written by: SANICHARA		20-Nov-79 15:55:11

Edit checked: NO			   Document: NO
  TCO Tested: YES		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 	 13256


Problem: Incorrect error message by RNAMF JSYS

Diagnosis: After the call to CHKOFN, DISC code does a JRST to a
common location and checks for two possible error codes. If neither
is found, it returns a code for which there is no corresponding error
string.

Solution: After the call to CHKOFN,give the RETBAD with the proper
error code.

[End of TCO 4.1.1024]


TOPS20 Change Order Number 4.1.1026

Written by: MILLER		26-Nov-79 11:01:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC	JSYSF	JSYSA

Related TCO's:
Related SPR's: 


Problem: Users complain that jobs cannot logout because
of incorrect JFN map counts. Such problems are intermittent
and impossible to reprodcue reliably.

Diagnosis: As above. Whereas we don't know the exact cause
of this, we do know of some code that modifies JFN
map counts without benefit of the JFN lock (FILLCK).
Such behavior creates races that could explain the
reported symptoms.

Solution: Fix PMAP, CLZMRC , JFNDCR and OFNJFN to
cooperate to properly lock the FILLCK.

[End of TCO 4.1.1026]


TOPS20 Change Order Number 4.1.1028

Written by: KONEN		26-Nov-79 13:40:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:
Related SPR's: 


Problem: Succeeding versions of a file with data errors also show data errors

Diagnosis: FB%BAT flag in FDB getting set in succeeding files

Solution: Zero FB%BAT bit in FDB in VRLK6A

[End of TCO 4.1.1028]


TOPS20 Change Order Number 4.1.1029

Written by: SCHMITT		27-Nov-79 11:14:26

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MAGTAP

Related TCO's:
Related SPR's: 


Problem: Cobol programs that write multi-reel EBCDIC tape
files will not write tape marks on the end of any of the
reels except the last one.

Diagnosis: This is because, when the physical end of tape
is encountered, PA1050 resets the data mode and then closes the
tape file.  Reseting the data mode causes all buffers to be
written to tape and the buffers are then released.  The
CLOSF JSYS decides whether to write tape marks on whether
there are buffers allocated for that Magnetic Tape Unit.
The JSYS assumes that if there are no buffers allocated then
no output could have been performed on that unit.
Therefore, there is no need to write the tape marks.  This
is a false assumption.

Solution: Remove the test at MTACLZ+12 which checks whether
buffers are allocated.

[End of TCO 4.1.1029]


TOPS20 Change Order Number 4.1.1030

Written by: SCHMITT		27-Nov-79 11:20:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IO

Related TCO's:
Related SPR's: 


Problem: 
When the SIN JSYS is used on a file of two, three, or four
bytes, the bit OF%PLN was not set in the OPENF JSYS and
there are <NUL> bytes as either the second, third, or fourth
byte in the file, then the null bytes will not be returned
to the calling routine.

Diagnosis: 
The MONITOR, when reading a byte from a file which has had
I/O, uses a byte input routine (SIORX) which expects the
decision about whether the file does in fact contain line
sequence numbers to have been made previously.  The routine
to make that decision (BYTINA), decides that if the file is
less than five bytes long, then there must be no LSNs but
does not set the bit which informs the rest of the world.

Solution: 
When the routine BYTINA notices that the file is less than
five bytes long, set the bit <PASLSN>.

[End of TCO 4.1.1030]


TOPS20 Change Order Number 4.1.1031

Written by: DBELL		27-Nov-79 13:25:16

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 


Problem: 
Wrong error code is returned at DSKS12+1, when the offline dates have
expired.  Currently it says wrongly that the file is offline.

Diagnosis: 
The error ARGX26 should be ARGX27.

Solution: 
Change it.

[End of TCO 4.1.1031]


TOPS20 Change Order Number 4.1.1032

Written by: DBELL		27-Nov-79 14:14:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 


Problem: 
SFTAD JSYS doesn't allow times to be set for archival stuff, and in
addition gives the wrong error code.

Diagnosis: 
At SFTAD3, and index is checked for.  But it is done wrong, since
ac D doesn't contain an index.  Also, the error code DATEX6 is
returned, instead of DATEX5.

Solution: 
Do a SUB D,Q3 to make an index, and change the error code.

[End of TCO 4.1.1032]


TOPS20 Change Order Number 4.1.1034

Written by: OSMAN		28-Nov-79 10:52:43

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: There are many cases where typists try to put question marks in
text and have to type a CTRL/V, lest the question mark provoke a help message.
For instance:

o	MS subject line.  If you're asking a question on the subject line.

o	^ESEND command in exec.  If you're asking a question.

For the case of MS, after you figure out to use CTRL/V, the recipient sees
^V in the printout of the subject line.

Diagnosis: COMND is doing standard help in response to "?".

Solution: Change the behavior of .CMTXT function of COMND to allow "?"
in the text without the CTRL/V, unless the "?" is the first character in
the text, in which case the help is displayed.  Also, if the .CMTXT is
encountered during a chain of help displays, the help will be displayed
regardless of where the "?" is.

[End of TCO 4.1.1034]


TOPS20 Change Order Number 4.1.1036

Written by: MILLER		29-Nov-79 13:34:15

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: fork lock timeouts are pervasive.

Diagnosis: The rules for locking fork lock are
unclear.

Solution: We define the following rule:

	1. FKLOCK always nests within the same process

	2. FKLOCK is a more global lock than any other
	except NOSKED

[End of TCO 4.1.1036]


TOPS20 Change Order Number 4.1.1039

Written by: SANICHARA		30-Nov-79 14:30:18

Edit checked: NO			   Document: NO
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 	 13199


Problem: If a user gets a JFN on a file he wishes to rename and then another
user deletes and expunges that file before the RNAMF jsys is called, the
BUGCHKS DIRNL, ULKSTZ and IDFOD2 appear on the console.

Diagnosis: The RNAMF code attempts to get an FDB on the source file which
will fail because the file was deleted and expunged. Since the GETFDB call
failed, the directory was not locked on the error return. The code handling
the error however, incorrectly goes to a common routine which attempts to
unlock the directory which results in the BUGCHKS.

Solution: Remove the fix to SPR 12542. Immediately after the call to GETFDB
for the source file, do correct error handling.


[End of TCO 4.1.1039]


TOPS20 Change Order Number 4.1.1041

Written by: SCHMITT		 3-Dec-79 13:20:06

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 


Problem: SWJFN JSYS does not swap directory name strings
of the JFN blocks.

Diagnosis: The SWJFN JSYS code was not written to swap
the words FILACT, FILLCK, and FILDNM.

Solution: Add the above three words to the list of words
to swap in the SWJFNT table.

[End of TCO 4.1.1041]


TOPS20 Change Order Number 4.1.1043

Written by: OSMAN		 5-Dec-79 08:55:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:	4.1.42410	4.1.1077
Related SPR's: 


Problem: APHLT1 didn't work out too well.

Diagnosis: XCT chains aren't chased by BUGHLT code

Solution: Change the two XCT APHLT1's to BUG(APRNX1)

[End of TCO 4.1.1043]


TOPS20 Change Order Number 4.1.1044

Written by: OSMAN		 5-Dec-79 09:11:32

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: EXEC command in mini-exec causes infinite

		?Invalid CMBFP pointer

Diagnosis: EXEC command doesn't do RESET first, so exec gets merged in and
CINITF is left non-0, so exec assumes it needn't initialize CMBFP again (amongst
its other non-initialization!)

Solution: Make the EXEC command in the mini-exec do an implicit RESET.

[End of TCO 4.1.1044]


TOPS20 Change Order Number 4.1.1046

Written by: OSMAN		 5-Dec-79 11:30:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: VT100 users notice two beeps if they type, for instance:

		@COPY <esc>


Diagnosis: GTJFN types one, then COMND internally calls its field routine
to read the filespec terminator, and that routine sees only an escape so
beeps to denote ambiguity.

Note that if string is

		@COPY M<esc>

only one beep happens since the field routine sees a non-null string before
the escape.

Solution: Check for GJFX48, the special GTJFN error code, and don't
call the field routine at all if that error code is the one returned
by GTJFN.

[End of TCO 4.1.1046]


TOPS20 Change Order Number 4.1.1048

Written by: SCHMITT		 5-Dec-79 12:47:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: 
After inputting a <CR> in binary mode, if the mode is changed
to a non-binary mode, the next character read will be a <LF>.

Diagnosis: 
The MONITOR does not check what mode the <CR> was input in
before deciding whether a <LF> should be simulated as input.

Solution: 
After inputting a character, store the data mode of that
character in the TTY dynamic data block in bits 7-8 of word
TTDAT2 (field TYLMD).  This field is nicely set up but,
unfortunetly, not used.  When checking for whether a <LF>
should be returned when requesting a character from the TTY
buffer, only return it if the last character input was a 
<CR> and it was input in non-binary mode.  The same conditional
should be incorporated into the TTSIBE routine.

[End of TCO 4.1.1048]


TOPS20 Change Order Number 4.1.1050

Written by: SCHMITT		 6-Dec-79 10:35:02

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SERCOD

Related TCO's:
Related SPR's: 


Problem: 
SEBISS BUGCHKs which themselves cause other SEBISS BUGCHKS

Diagnosis: 
The BUG'TYP error block for the SYSERR facility does not expect
a system name string of more than 94 decimal characters.  Since
the MONITOR allows a maximum system name size of 129 characters,
the syserr block is seven words to short.  If a site has a system
name greater than 94 decimal characters in length, than when
certain BUG'TYPs are encountered, SEBISS BUGCHKs will be generated.

Solution: 
Increase the size of the BUGHLT/CHK/INF error block.  This is
done by increasing BG%LEN from BG%SIZ+33 to BG%SIZ+42.

[End of TCO 4.1.1050]


TOPS20 Change Order Number 4.1.1051

Written by: SCHMITT		 7-Dec-79 15:17:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	GLOBS	JSYSA	MEXEC

Related TCO's:	4.1.1052
Related SPR's: 


Problem: 
The item "monitor uptime" in the system restart entry of the USAGE file
is zero filled.

Diagnosis: 
The USAGE JSYS does not expect a monitor uptime item for a restart
entry.  When issuing the USAGE JSYS, the monitor does not calculate
the monitor uptime and place it in the record descriptor block.

Solution: 
Modify the tables RSTLST in MEXEC and UFRSTT in JSYSA so as to
accept an item for monitor uptime.

[End of TCO 4.1.1051]


TOPS20 Change Order Number 4.1.1053

Written by: SANICHARA		10-Dec-79 11:12:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 13200


Problem: SHROFD BUGHLT when attempting to rename a file to a destination
file which was previously opened.

Diagnosis: File status of source file not properly resrored.

Solution: Restore file status properly

[End of TCO 4.1.1053]


TOPS20 Change Order Number 4.1.1059

Written by: KONEN		 8-Jan-80 09:18:20

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: Error code from BOOT JSYS is sometimes zero.

Diagnosis: RMGRNK in DTESRV is being called from several routines.  In case of
error, some routines expect error codes, others expect error flags in T1.

Solution: Change those calls to RMGRNK which expect error codes to calls to
RMGRNC.  RMGRNC will call RMGRNK, then convert error flags to error codes.

[End of TCO 4.1.1059]


TOPS20 Change Order Number 4.1.1067

Written by: MILLER		15-Jan-80 10:43:16

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DSKALC

Related TCO's:
Related SPR's: 


Problem: Code around DOBDRM is not correct. When the
swapping address is computed for a page in the BAT blocks,
the interleaving of swapping space is not accounted for.

Diagnosis: As above.

Solution: Add code that does a similar computation to that
done at GTCUB3 in PHYSIO.

[End of TCO 4.1.1067]


TOPS20 Change Order Number 4.1.1068

Written by: SCHMITT		16-Jan-80 15:37:23

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MFLIN

Related TCO's:
Related SPR's: 


Problem: 
Lower case E, 'e', is not a valid exponent designator for
the FLIN JSYS.

Diagnosis: 
When checking for exponent designator, no attempt is made
to check for lower case E.

Solution: 
Check for lower case E at MMORE+2 in module MFLIN.

[End of TCO 4.1.1068]


TOPS20 Change Order Number 4.1.1069

Written by: SCHMITT		16-Jan-80 15:43:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: 
The .CMNUX function of the COMND JSYS will return a no parse
error of NPXICN, 'Invalid character in number' if the .CMNUX
field is terminated by a '+' or '-' character.

Diagnosis: 
So as to allow strings such as +200 and -5 to be valid
fields for the .CMNUX function, the COMND JSYS does not
specify the '+' or '-' characters in the break set.  The
JSYS, therefore, assumes that all '+' and '-' characters are
part of the field regardless of their position in the
string.  After the string has been passed to the NIN JSYS,
the resulting pointer will show that less bytes have been
read by the NIN JSYS than were read in by the COMND JSYS as
valid for that field.  When this happens, a NPXICN error is
generated.

Solution: 
If the NIN JSYS has not read the entire string which the
COMND JSYS expected it to, the code should check the
function it is currently performing.  If it is a .CMNUM
function, return the no parse error.  If it is a .CMNUX
function, determine the number of bytes the NIN JSYS
actually read.  Now reread the field, but only the number of
bytes previously read by the NIN JSYS, and issue the NIN
JSYS again

[End of TCO 4.1.1069]


TOPS20 Change Order Number 4.1.1071

Written by: SCHMITT		23-Jan-80 09:11:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
ILCNSP Bughlt

Diagnosis: 
When only one element is on a unit's Position Wait Queue,
the requested cylinder is the same as the current cylinder,
the fairness count is exhausted and their are no elements on
the units's Transfer Wait Queue, an ILCNSP BUGHLT will be
generated.

This is because when the SCHSEK routine notices a request on
the PWQ is for the same cylinder that the drive is positioned
to and that the fairness count is exhausted, it will
ignore that element.  If there are no other elements on
the PWQ which are requests to othere cylinders, that no
element will be picked as either 'Minimum Cylinder So Far'
or 'Best Cylinder So Far'.  SCHSEK does not consider this
case and when the call is made to CONSPW, it assumes it has 
already picked a cylinder.  Since no element has been decided 
upon, CONSPW will blow up with ILCNSP.

Solution: 
When the requested cylinder is for the same cylinder as the
current and the fairness count is exhausted, check to see if
a minimum has been found.  If not, make the element the 
'Minimum Found So far'.  This way, if no other minimums are
found then the transfer will be to the current cylinder.

This can be done by changing the JRST at SEK1+6 from a 
JRST SEK5 to a JRST SEK3.

[End of TCO 4.1.1071]


TOPS20 Change Order Number 4.1.1077

Written by: GRANT		 1-Feb-80 15:03:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:	4.1.1043
Related SPR's: 


Problem: APRNX1 BUGHLT prints out garbage on the CTY instead of "APRNX1".

Diagnosis: The BUGHLT is an XCT of an XCT.  

Solution: Make the first XCT a JRST.
[End of TCO 4.1.1077]


TOPS20 Change Order Number 4.1.1082

Written by: OSMAN		15-Feb-80 11:12:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: Two MOVE Q2,ACTPG instructions should be MOVEI Q2,ACTPG

Diagnosis: CMU comp center says so, and it seems to make sense.

Solution: Make the change.

[End of TCO 4.1.1082]


TOPS20 Change Order Number 4.1.1083

Written by: MILLER		19-Feb-80 10:53:16

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 


Problem: When the logout code does a CLZFF JSYS specifying
CZ%ARJ, it is possible, if there are file map count
bugs in other portions of the monitor, to hang the job.

Diagnosis: When logout does the CLZFF, there can be no
uses of any files. This si because all inferior forks have
been killed, and the current fork (the top fork in the job),
has unmapped all of its pages. If any file still have
non-zero map counts, then the logout will never occur.

Solution: Change the meaning of CZ%ARJ as follows:

If from user mode, it still means wait for all uses
of the JFN are relinquished.

If from the monitor, it means close all files regradless
of JFN map counts.

[End of TCO 4.1.1083]


TOPS20 Change Order Number 4.1.1084

Written by: MILLER		19-Feb-80 14:41:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: RMAP can crash the system by causing a NXM

Diagnosis: RMAP maps and inerrgoates another process's PSB
without first locking the fork lock

Solution: Lock the fork lock

[End of TCO 4.1.1084]


TOPS20 Change Order Number 4.1.1110

Written by: OSMAN		14-Mar-80 11:15:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PROLOG

Related TCO's:
Related SPR's: 


Problem: First bug always causes a false warning saying it is out of
order in BUGS.MAC.

Diagnosis: (partial) ..BV gets checked on each bug to make sure there's no
ordering problem.  On first one though, ..BV isn't defined at all.  What
I still don't understand, is why doesn't MACRO complain that ..BV is undefined??

Solution: At end of PROLOG.MAC, before te DEFBUGs in BUGS.MAC are executed,
set ..BV to the smallest possible value (1B0) so that the first DEFBUG will be
in order.

[End of TCO 4.1.1110]


TOPS20 Change Order Number 4.1.1112

Written by: MILLER		14-Mar-80 13:50:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: RSX20F needs to know the count of all data bytes
to be sent in a transaction. Since most transfers
occur in two pieces, it needs to accept some data
before knowing the total.

Diagnosis: As above

Solution: Add a new field to the status word indicating
the total # of bytes being delivered. The field is
CMPCT and is the 16 bits to the left of the current
count.

[End of TCO 4.1.1112]


TOPS20 Change Order Number 4.1.1113

Written by: GRANT		14-Mar-80 13:59:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: Monitor may crash when RCVOK timer goes off.

Diagnosis: The routine ACJKIL is not suitable for calling from the
           scheduler.

Solution: Fix ACJKIL so the necessary piece is resident and make a
          special entry point for the scheduler.
[End of TCO 4.1.1113]


TOPS20 Change Order Number 4.1.1114

Written by: DBELL		14-Mar-80 17:41:27

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM2

Related TCO's:
Related SPR's: 


Problem: Errors on TU77 tape drives can cause TM2CCI and PH2RAE BUGCHKS,
and keep alives.

Diagnosis: 
Code in the FTLCHK routine in PHYM2 tries to do a drive clear of a
TU77 unit by calling WTREG3.  However, this requires Q2 to be set up
with the TM02 unit number, which is not done.  Therefore registers
are written for junk units off of the RH20.

Solution: 
Just before the label DOPCK in PHYM2, change the two calls of WTREG3
to be calls to WTREG.  WTREG will use the TM02 unit number found in
the UDB, which is what is wanted here.

[End of TCO 4.1.1114]


TOPS20 Change Order Number 4.1.1115

Written by: DBELL		15-Mar-80 14:37:08

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	DIAG

Related TCO's:
Related SPR's: 


Problem: 
The DIAG JSYS is limited to setting up channel programs containing
only one CCW word.  Thus diagnostics cannot read or write buffers larger
than a page.  This is a great limitation for diagnostics.  (For example,
it is impossible to format an RP20 in user mode since its sectors are
one page long).

Diagnosis: 
Monitor code was not written to handle multiple CCW words.

Solution: 
Change the DIAG JSYS to allocate resident storage, build a CCW list of
reasonable length, and create a JUMP CCW to the list.  There is an
arbitrary limit of 50 CCWs allowed in the DIAG call.  The number of CCWs
is determined by the number of arguments specified to the .DGSCP function.
Thus the calling sequence for this function looks like:

AC1/	-<n+2>,,ADDR

ADDR/	.DGSCP
	device address
	CCW 1
	CCW 2
	 ...
	CCW n

None of the CCWs can describe a transfer which crosses a page boundary.
Therefore the largest transfer which can be performed using DIAG is
50 pages.

[End of TCO 4.1.1115]


TOPS20 Change Order Number 4.1.1116

Written by: OSMAN		18-Mar-80 09:06:38

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: If you have a file called 2102.. that contains "NRT20 2102<crlf>"
	(without the quotes), and you say

		@2102..

	to the exec, you get "?Invalid network filename" from NRT20.

Diagnosis: COMND changes linefeeds within indirect files to spaces.  This
	produces a trailing space, which NRT20 is too stupid to handle.

Solution: To be conservative, make COMND clever enough to not put in a space
	for a linefeed, if the linefeed is the last character in the indirect
	file.

[End of TCO 4.1.1116]


TOPS20 Change Order Number 4.1.1119

Written by: DBELL		25-Mar-80 13:49:27

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	DSKALC	MSTR	PHYSIO	PHYP4	PHYH2	STG
			DIAG	PHYPAR	PHYM2	PHYH11	MONSYM	MAGTAP
			TAPE	GLOBS	BUGS

Related TCO's:
Related SPR's: 


Problem: 
Monitor doesn't know anything about RP20 disks.  In particular, all
of the disk I/O code thinks that disks have no controllers.

Diagnosis: 
Only tapes had controllers previous to the RP20, and so the code was
written to not handle disk controllers.

Solution: 
Change many routines in DSKALC, MSTR, PHYSIO, STG etc. to understand
the changes required for RP20 disks.  These code changes also include
many small changes related to the RP20 project.

[End of TCO 4.1.1119]


TOPS20 Change Order Number 4.1.1120

Written by: DBELL		25-Mar-80 14:28:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
Routine in TAPE to clear the volid for a tape is wrong.

Diagnosis: 
MTCLVL used the wrong AC when doing AOBJN over all units.

Solution: 
Fix the AC.

[End of TCO 4.1.1120]


TOPS20 Change Order Number 4.1.1128

Written by: MILLER		27-Mar-80 15:16:07

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: TAPE blocking is not always handling correctly.

Diagnosis: If a job default is set, the monitor may
ignore it and try to assign a record size more amenabel
to its purposes. The code it uses is supposed to be used
only when the system default has been selected.

Solution: Check for a job default.

[End of TCO 4.1.1128]


TOPS20 Change Order Number 4.1.1129

Written by: DBELL		27-Mar-80 20:25:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: 
When a job is logging out, the monitor wants to expunge the login
directory and the connected directory.  But the connected directory
fails to get expunged.

Diagnosis: 
At SJLGO4+33, the CAMN T2,T3 should be CAMN T1,T3.  This change
causes the monitor to make the wrong decision about doing the expunge.

Solution: 
Make the change.

[End of TCO 4.1.1129]


TOPS20 Change Order Number 4.1.1132

Written by: OSMAN		31-Mar-80 13:58:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: BATCON can't ^C enabled wheel batch job that is running
a program (NVTHAK !) that traps ^C.

Diagnosis: Although exec tries to prevent batch programs from trapping ^C,
monitor allows enabled wheel to have privilege bits that aren't even in
fork's capabilities!  The EPCAP jsys allows anything in AC3 regardless of
AC2 is caller is an enabled wheel.

Solution: Modify EPCAP to *never* allow a fork to have more in AC3 than
is granted in AC2.

[End of TCO 4.1.1132]


TOPS20 Change Order Number 4.1.1142

Written by: OSMAN		11-Apr-80 09:19:40

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILMSC

Related TCO's:
Related SPR's: 


Problem: One way to implement macro command languages is to use a PTY as
the controlling terminal of a fork tree, so that the command controller can
send characters to the pty when it wants the tree to see input, and the
command controller merely reads pty output to get the tree's output.

Unfortunately, if tree does something like

	@EDIT FOO

the editor doesn't get the string, because it does RSCAN, and monitor
uses real tty data instead of RSCAN data.

Diagnosis: The TTYIN routine only uses RSCAN data if the designator is -1.

Solution: Make TTYIN use RSCAN data if -1 OR if designator is for fork's
controlling terminal.

[End of TCO 4.1.1142]


TOPS20 Change Order Number 4.1.1143

Written by: KONEN		15-Apr-80 09:24:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTFEDV

Related TCO's:
Related SPR's: 


Problem: -20 and lines on front end passing XON's and XOFF's thru the night.

Diagnosis: -20 is trying to XOFF the line, while the line is trying to XOFF the
-20.

Solution: Check before storing input in big buff to see if the character is an
XOFF, and take appropriate action.

[End of TCO 4.1.1143]


TOPS20 Change Order Number 4.1.1149

Written by: DBELL		26-Apr-80 11:42:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
OVRDTA BUGCHKs are not handled too well.  The lower level hung device
routines are not called in the proper cases.  More importantly, the
HNGIRB routine knows nothing about disks like the RP20 which have a
controller, and so it clears bits incorrectly.

Diagnosis: 
Code was old style, and used to be adequate.

Solution: 
Change HNGIRB to understand all about controllers in all cases, and
to call the lower level hung IORB routines when necessary.

[End of TCO 4.1.1149]


TOPS20 Change Order Number 4.1.1150

Written by: DBELL		27-Apr-80 16:06:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
The routine MTCLVA in TAPE to clear all volume valid bits is wrong, and
only clears the first MT:.

Diagnosis: 
AOBJN is missing the AC field.

Solution: 
Change AOBJN to AOBJN U, in the loop.

[End of TCO 4.1.1150]


TOPS20 Change Order Number 4.1.1153

Written by: DBELL		 1-May-80 15:16:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYPAR

Related TCO's:
Related SPR's: 


Problem: 
It is hard to debug RP20 disks since only 5 units can be busy doing
DSKOPs at a time.

Diagnosis: 
There are only 5 IORBs allocated for UDSKIO to use.  Any processes which
want another IORB after they are used block waiting for them.

Solution: 
Change the parameter NUIORB in PHYPAR to a more reasonable value such
as 15 or so.

[End of TCO 4.1.1153]


TOPS20 Change Order Number 4.1.1154

Written by: DBELL		 1-May-80 17:36:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM2

Related TCO's:
Related SPR's: 


Problem: 
If a TU77 tape drive gets errors, then TM2CCI BUGCHKs could occur.

Diagnosis: 
It seems possible that slave status change in the drive status register
can be set without slave attention also being set.  But PHYM2 assumed in
the TM2POL loop that slave attention would be up.  Therefore no clear
function is done for the tape drive, eventually causing the TM2CCI error.

Solution: 
Check for DS.SLA and DS.SSC at TM2PNO-9, and clear the drive if either
bit is set.

[End of TCO 4.1.1154]


TOPS20 Change Order Number 4.1.1155

Written by: DBELL		 6-May-80 16:10:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	DIAG

Related TCO's:
Related SPR's: 


Problem: 
DIAG users can't generate skip words for their channel programs.

Diagnosis: 
Code doesn't work properly for that type of CCW word.

Solution: 
Check for skip words, and allow them.

[End of TCO 4.1.1155]


TOPS20 Change Order Number 4.1.1162

Written by: MURPHY		12-Dec-80 14:41:15

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: Crash during CRDIR%

Diagnosis: During scan of jobs, code falls over job which is
not fully created.

Solution: Setup JOBPT earlier so that transient state isn't seen.

[End of TCO 4.1.1162]


TOPS20 Change Order Number 5.1020

Written by: LYONS		 9-Apr-80 16:50:06

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	NETWRK	STG	ACJ

Related TCO's:
Related SPR's: 


Problem: It is impossible to control access to DECnet and ARPAnet
in a system.

Diagnosis: There is no checking done for access, and there is nothing to check!

Solution: Add two new priv bits, SC%ANA and SC%DNA (ARPAnet access and DECnet
access), with code to check for them. Also, add two new ACJ functions,
.GOANA, AND .GODNA, to allow ACJ to control access to the networks.

[End of TCO 5.1020]


TOPS20 Change Order Number 5.1022

Written by: DBELL		20-Apr-80 15:25:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 
There are LOGIN security bugs related to the fact that the LOGIN JSYS
is not NOINT for all of its running, so that some of its activities
can be aborted or confused.

Diagnosis: 
Code is not defensive enough.

Solution: 
Make it more foolproof.

[End of TCO 5.1022]


TOPS20 Change Order Number 5.1024

Written by: OSMAN		24-Apr-80 10:50:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: If switch table contains /ABC: and /ABCD: and user types /ABC:,
	he gets "?Ambiguous".

Diagnosis: Since colon isn't in atom buffer, ABC is looked up in the table,
	which is ambiguous!

Solution: If ambiguous return, try with colon to see if that succeeds!

[End of TCO 5.1024]


TOPS20 Change Order Number 5.1025

Written by: LYONS		25-Apr-80 16:29:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JOBCOF	SAVEB

Related TCO's:
Related SPR's: 


Problem: MEXEC DOES NOT RUN WELL IN SECTIONS OTHER 0

Diagnosis: THERE ARE TWO OFFENDING PUSH'ES OF LITERAL PC'S

Solution: CHANGE THE PC'S FROM [MRETN] TO [IFIW!MRETN] AND
		[SAVEBL] TO [IFIW!SAVEBL]

[End of TCO 5.1025]


TOPS20 Change Order Number 5.1027

Written by: OSMAN		30-Apr-80 09:23:39

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: In exec, for instance, if you say

	@INFO DEFAULT <cr>

you get

	?Ambiguous

which itself is rather ambiguous!  Better would be

	?Null switch or keyword given

Diagnosis: yes

Solution: do it

[End of TCO 5.1027]


TOPS20 Change Order Number 5.1030

Written by: GRANT		30-Apr-80 14:54:59

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC	SCHED

Related TCO's:
Related SPR's: 


Problem: When typing a ^C before logging on to the system you can get
	the  ?FULL  message.  This is not very informative.

Diagnosis: There are 5 different decisions that may cause this message to
	be returned to the user.  Each different case should provide its
	own reason as to why the user is not being allowed to login.

Solution: Do it.
[End of TCO 5.1030]


TOPS20 Change Order Number 5.1031

Written by: GRANT		 1-May-80 14:41:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	STG	GLOBS

Related TCO's:
Related SPR's: 


Problem: TOPS-20 NSP doesn't distinguish between a server being busy
	and being non-existent.

Diagnosis: The processing of the CI calls a routine to look for the
	requested object.  If the lookup fails, the CI processor plugs
	in NSP reason code 4.

Solution: Make the object lookup routine determine why the lookup failed
	and return the appropriate NSP reason to the CI processor.
[End of TCO 5.1031]


TOPS20 Change Order Number 5.1032

Written by: OSMAN		 5-May-80 10:51:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: When using COMND to read date and/or time, and typist types <cr>
after it, the cr ends up in atom buffer after the date.  This is a problem
if the atom buffer is subsequently used as a string!

Diagnosis: COMND was using CMRFLN to read exact length string, which was
reading one character too many.

Solution: Fix CMRFLN.  (and XCMNUM which was depending on the buggy
behavior of CMRFLN!!)

[End of TCO 5.1032]


TOPS20 Change Order Number 5.1033

Written by: MILLER		 5-May-80 15:54:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: If bias is set not to use queue 1, fork creation
is very slow.

Diagnosis: Fork creation relies on the fact that queue 1 is
a high priority queue no matter what scheduler option is
being used. However, when queue 1 is not used, the class
scheduler may not give sufficient priority to queue 2.

Solution: Give PI boost to fork being created.

[End of TCO 5.1033]


TOPS20 Change Order Number 5.1036

Written by: MILLER		12-May-80 14:41:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: Interpretation of generation number and generation
version number on labeled tapes is incorrect.

Diagnosis: Code does not conform to latest DEC standard.

Solution: Make it conform. The change will affect the computed
version number so some existing files.

[End of TCO 5.1036]


TOPS20 Change Order Number 5.1042

Written by: DBELL		19-May-80 16:33:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYX2

Related TCO's:
Related SPR's: 


Problem: 
Asychronous status can be lost, thus making a tape drive never seem to
complete a rewind operation.  (However, this is an EXTREMELY unlikely
event).

Diagnosis: 
There exists a race between the DX20 and the KL in which a DATAI
instruction for the asychronous status register reads only 8 bits
of data, and the other 8 bits are zero.  Thus invalid status is used,
making the drive presenting the status be forgotten about.  This race
occurs because the DX20 handles data in 8 bit bytes, and the MASSBUSS
handles data in 16 bit bytes.

Note:  This problem also affects the RP20 disk, since that is also
controlled by a DX20.  In this case, seeks never complete which causes
OVRDTA BUGCHKs.

Solution: 
First, change the DX20 microcode to store the two bytes of the status
in the order of drive number, then status flags.  This requires a new
microcode since it currently stores the status flags first.

Secondly, when asychronous status is read by the monitor and is nonzero,
check to see if any of the status flags are set.  If not, read the
register once more.  By the second read of the register, the DX20 will
have had time to store the flags.  If flags exist on the first read,
another read isn't necessary since the DX20 will have already stored
the unit number and so the status is complete.

[End of TCO 5.1042]


TOPS20 Change Order Number 5.1044

Written by: ZIMA		24-May-80 18:35:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	BOOT

Related TCO's:
Related SPR's: 


Problem: The attempt to zero 20-23 to fend against CCW word parity errors
is not doing it.

Diagnosis: Typo in literal.

Solution: Fix typo.

[End of TCO 5.1044]


TOPS20 Change Order Number 5.1045

Written by: ZIMA		24-May-80 18:37:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	BOOT

Related TCO's:
Related SPR's: 


Problem: The MTBOOT prompt is coming out as MTBOOT > (extra space).

Diagnosis: Typo in BYTE pseudo-op.

Solution: Fix typo.

[End of TCO 5.1045]


TOPS20 Change Order Number 5.1046

Written by: ZIMA		24-May-80 18:44:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	BOOT

Related TCO's:
Related SPR's: 


Problem: BOOT hangs on KS-10s.

Diagnosis: 
     Non-zero contents in location 35 (KLINIK output word) when BOOT
tries to output its prompt induces the 8080 to think that KLINIK output
is desired.  The microprocessor tries to output the spurious KLINIK byte
and forgets about the CTY output (checks KLINIK first).  This leaves
BOOT looping waiting for the CTY communication word to be cleared.

Solution: 
     Final solution will be in a future revision to the microporcessor
ROM; in the interim, put in code (SMFLG conditional) to clear the
KLINIK communication words.

[End of TCO 5.1046]


TOPS20 Change Order Number 5.1048

Written by: DBELL		25-May-80 17:25:48

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO	DSKALC

Related TCO's:
Related SPR's: 


Problem: 
RP20s need a quick way of reading arbitrary pages of a disk.  The current
DSKOP JSYS is too slow since it reads only one page at a time and blocks
between reads.  The ability to read quickly is needed for the fast dumping
program being written for the RP20.

Diagnosis: 
That's the way it has always worked.

Solution: 
Extend the DSKOP JSYS to be able to read many sectors of the disk at once.
Changes required are in the DSKOP JSYS, and the UDSKIO routine.  User programs
notice the change in the following way:

1.	If the word count in AC2 is not greater than 1000 octal, then
	DSKOP works as it has in the past.  That is, I/O cannot cross
	a page boundary, and error recovery can be performed if desired.

2.	If the word count in AC2 is greater than 1000 octal, then the
	user's buffer does not have to be aligned to any page boundary.
	And a very large count can be specified (such as about 50 pages).
	However, the following restrictions have to be obeyed:

	A.	The count must be an EXACT multiple of the sector size
		of the disk being read/written.  The sector size of a
		disk can be obtained by using the .MSRUS function of
		the MSTR JSYS.

	B.	No error recovery or error logging is attempted by
		the monitor.  Thus the DSKOP acts like the flags
		DOP%IL are DOP%IR are always set, whether or not the
		user actually set them.  On an error, the user program
		can reread the affected pages one at a time in order
		to determine which pages were actually bad.

[End of TCO 5.1048]


TOPS20 Change Order Number 5.1049

Written by: ZIMA		28-May-80 15:06:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: MSFRK blows WHEEL or OPERATOR check.

Diagnosis: Typo.

Solution: Fix typo, change to TX test.

[End of TCO 5.1049]


TOPS20 Change Order Number 5.1050

Written by: OSMAN		29-May-80 09:46:06

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILMSC

Related TCO's:
Related SPR's: 


Problem: If fork has a special controlling terminal (because another fork
did SCTTY), and the fork reads TTY: via a real jfn, the monitor doesn't know
to read the special terminal instead of the job's controlling terminal.

Diagnosis: yes

Solution: In TTYIN2, check for terminal in FRKTTY before resorting to job's
controlling terminal.

[End of TCO 5.1050]


TOPS20 Change Order Number 5.1051

Written by: SCHMITT		29-May-80 13:05:53

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	LOGNAM

Related TCO's:
Related SPR's: 	 14101


Problem: BUGHLT ILMREF when the byte size for the pointer
to the logical name definition string in AC3 for the CRLNM
JSYS is greater than 7 bits.

Diagnosis: 
The MONITOR made no check as to the validity of the byte size
before using each byte as an index into a table of character types.
This could couse the index register to contain big numbers and thus
cause ILMREF BUGHLTs

Solution: 
At CRLNM0 (after the byte pointer has been checked for the default
byte size and position, ie. -1,,ADR) have the MONITOR check the byte
size.  If greater than 7 bits, return the error

		ARGX09 - 'Invalid Byte Size'

to the calling routine

[End of TCO 5.1051]


TOPS20 Change Order Number 5.1053

Written by: DBELL		31-May-80 22:58:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
IORBs are terminated with errors if a hung device occurs for a seek
operation on a disk.  Since all of our disks do automatic seeks on
a transfer operation, there is no reason to terminate the IORB on
such an error.  By continuing on and trying the transfer operation
anyway, we give one more change for the I/O to be successful.

Diagnosis: 
That's the way the code has always worked.  Unfortunately, for RP20
disks, there appear to be obscure ways for seeks to be lost.  So
not terminating the IORB wins big for them.

Solution: 
On a hung IORB, just mark the IORB done for a position operation for
disks.  Give an error for tape operations or for transfer operations
as before.

[End of TCO 5.1053]


TOPS20 Change Order Number 5.1054

Written by: ZIMA		 1-Jun-80 17:38:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MAGTAP

Related TCO's:
Related SPR's: 	 12623


Problem: 
     COBOL programs receive errors such as "Read an EOF instead of a label"
or record sequence errors while reading magtapes.

Diagnosis: 
     Tape read ahead is handled incorrectly, allowing a race condition in
the tape status code concerning bits used at both program level and at
PHYSIO interrupt level.

Solution: 
     Prevent the race in MTSTS by changing the call to UPDSTS to one to
UPDSTA to at least achieve proper status synchronization.

[End of TCO 5.1054]


TOPS20 Change Order Number 5.1059

Written by: ZIMA		 4-Jun-80 12:47:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 	 13064


Problem: 
PS:<SYSTEM> over quota by +INF pages.

Diagnosis: 
One last place where someone used 377777,,777777 instead of 377777,,0
to be the "positive infinity" for disk quotas.

Solution: 
Change the constant at ENAC0: plus several.

[End of TCO 5.1059]


TOPS20 Change Order Number 5.1060

Written by: SCHMITT		 6-Jun-80 14:48:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DSKALC

Related TCO's:
Related SPR's: 	 14263


Problem: 

When installing TOPS-20 on a 2020 with a three or four pack RM03 PS:
the MONITOR will let you define the structure but when it attempts to
mount it, it will fail.

The messages look something like:

	[Structure PS: Successfully Defined]

	[PS: not found, What is the name of the public structure?]

Diagnosis: 

The calculation for the size of the bit table for the
structure is done correctly during the mount procedure but
incorrectly during the definition procedure.

The current calculation during structure definition is to multiply
the number of cylinders per unit by the number of units per structure,
thus getting cylinders per structure.  It then compares this to the
number of words available in the bit table.  This is not a valid compare.
The bit table comprises more than one word per cylinder in the structure,
in fact it contains a number of words equal to (1+bit words per cylinder)
times the number of cylinders per structure.

Solution: 

Have the calculation at FSIDI2+52 in DSKALC multiply the number of
cylinders in the structure by 1+BTWCYL to generate the actual size of the
bit table.

[End of TCO 5.1060]


TOPS20 Change Order Number 5.1061

Written by: KONEN		 6-Jun-80 15:25:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MSTR	PAGEM

Related TCO's:
Related SPR's: 


Problem: J0NRUN BUGHLT's

Diagnosis: DDMP was trying to read the index block of a structure that was
off-line, and never coming back.

Solution: Add global subroutine to MSTR to check if a structure is off-line,
then call it from DDMP.

[End of TCO 5.1061]


TOPS20 Change Order Number 5.1062

Written by: LYONS		 9-Jun-80 15:51:05

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	EXECIN	MSTR	CHECKD	PHYSIO	MONSYM	DSKALC

Related TCO's:
Related SPR's: 


Problem: 
There is very little done for bad block recovery in the swap space
at this time.  More code is needed.

Diagnosis: 
Certian types of errors (or bad pages) could allow the system as a whole
to continue, but hang the current job.  The system now will crash.
When the system crashes, the fact that the page was bad is lost, and not
written in the BAT blocks.

Solution: 
Add a general read after write function to PHYSIO, to allow read after
write for the swap space, as well as the data space.  Update CHECKD to
set and clear these bits, and to scan the disk, looking for bad blocks,
and adding them to the BAT block.  Also update EXEC, to report the status
of these bits.

	In the .MSSSS function of the MSTR jsys, add two new flag bits

	MS%RWS==:1b7	;Read after Write for Swap space
	MS%RWD==:1b8	;Read after Write for Data space

The work for CHECKD includes adding to commands, ENABLE, and DISABLE,
as well as subcommands for them.  At the same time, the LIMIT, and UNLIMIT
commands have been removed and made subcommands of ENABLE/DISABLE.
Also add a command VERIFY to check the disk for errors.

[End of TCO 5.1062]


TOPS20 Change Order Number 5.1063

Written by: KONEN		10-Jun-80 10:28:53

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MONSYM	MSTR	STG	MEXEC	FUTILI

Related TCO's:
Related SPR's: 


Problem: Avoid duplicate structure names in LCS environment.

Diagnosis: Allow system structures to have other names besides PS:

Solution: Find system structure by CPU serial number in home block(s), rather
than PS: name.
[End of TCO 5.1063]


TOPS20 Change Order Number 5.1064

Written by: DBELL		11-Jun-80 12:11:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SYSERR

Related TCO's:
Related SPR's: 


Problem: 
ILMNRF BUGHLTs whenever there is no free space on PS:, and the SYSERR
fork tries to write a new page in the SYSERR data file.

Diagnosis: 
The SYSERR code maps in the new page of the SYSERR file, and tries to
copy data into it.  Since it is a new page, a page fault occurs and
PAGEM goes off and tries to allocate a new disk page.  This fails
because the disk is full.  Thus PAGEM then goes off and causes a
page fault failure, which turns into the ILMNRF since the reference
was from the monitor.

This condition can diagnosed by noticing no obvious reason for the
page fault in the TRAPPC, etc words, and LSTERR contains the error
code IOX11.

Solution: 
Insert a SETMM followed by an ERJMP right after mapping the SYSERR
file page, and if the ERJMP fails flick in the writing of the entry.
(Notice we can't even do a BUGCHK to say what happened, or this
would cause a loop!)

[End of TCO 5.1064]


TOPS20 Change Order Number 5.1065

Written by: DBELL		13-Jun-80 11:52:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
The monitor does not like having a disk unit of a structure be
write-protected.  However, it does not complain about it, so that
the operators don't know to write-enable the disk again.

Diagnosis: 
No code to complain to the operators.

Solution: 
In the UNICHK routine in PHYSIO, check to see if a disk unit is
write-locked and part of a structure.  If so, complain to the
operator about it.

[End of TCO 5.1065]


TOPS20 Change Order Number 5.1066

Written by: DBELL		16-Jun-80 00:04:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
THE OVRDTA BUGCHK DOESN'T QUITE GIVE ENOUGH INFORMATION.  I WANT
TO KNOW WHAT OPERATION WAS BEING TRIED.

Diagnosis: 
IT DOESN'T TELL YOU.

Solution: 
ADD NEW FIELD TO THE BUGCHK WHICH GIVES THE IORB FUNCTION.

[End of TCO 5.1066]


TOPS20 Change Order Number 5.1067

Written by: SCHMITT		16-Jun-80 13:05:17

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
When closing a fixed format file on a Labeled tape, the Close will
fail and the error message IOX14 'Invalid Segment Size' will be returned.

Diagnosis: 
The test for whether padding should be performed on a fixed format file
never gets executed because of a comparison which inforces that the buffer
size be the same size as the record size.

Solution: 
Change the CAME at MTRCOF+3 L to a CAMLE

[End of TCO 5.1067]


TOPS20 Change Order Number 5.1068

Written by: KONEN		17-Jun-80 16:30:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: Files with OF%DUD bit on can get bad pages PMAPed to file on a
^C, RESET.

Diagnosis: KSELF does a general PMAP to unmap a process's pages.

Solution: Add PM%ABT bit to the PMAP in the KSELF code.

[End of TCO 5.1068]


TOPS20 Change Order Number 5.1069

Written by: OSMAN		18-Jun-80 17:58:15

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: If, to the exec, you say

	@TAKE FOO.BAR (LOGGING OUTPUT ON) NUL:

you get an error saying

	?Device is not a terminal

instead of the correct error

Diagnosis: The SFCOC at XCOMX1+n clobbers LSTERR

Solution: Save and restore LSTERR around this SFCOC

[End of TCO 5.1069]


TOPS20 Change Order Number 5.1070

Written by: OSMAN		19-Jun-80 15:13:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 


Problem: If your directory has a REAL long filespec in it, certain things
fail that shouldn't, such as

	@DELETE real-long-files-spec...

You get

	?GTJFN source failure on... - Byte count too small

Diagnosis: DEFINP in GTJFN too small

Solution: Make DEFINP equal to MAXINP

[End of TCO 5.1070]


TOPS20 Change Order Number 5.1071

Written by: DBELL		19-Jun-80 16:21:55

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
SYSERR output doesn't show RP20 unit numbers.

Diagnosis: 
The SYSERR format only shows the RH20 drive number, which is the DX20
number.  The drive number in this case is never stored.

Solution: 
Change the MB%UAD entry in the SYSERR block to be of the form:

	ctrl,,unit	;controller number and unit of controller

or	-1,,unit	;just unit number without any controller

This affects the ERRFIN routine in PHYSIO.

[End of TCO 5.1071]


TOPS20 Change Order Number 5.1073

Written by: SCHMITT		21-Jun-80 11:48:14

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 14185


Problem: 
DIRECTORIES ARE CREATED WITH DEFAULT FILE OFFLINE EXPIRATION
DATES OF .STDFE REGARDLESS OF WHETHER A TAPE RECYCLE PERIOD
HAS BEEN SET.

Diagnosis: 
THE DIRINI CODE USES THE VALUE OF .STDFE WHEN SETTING UP THE
DEFAULT FILE OFFLINE EXPIRATION DATE.

Solution: 
USE THE CONTENTS OF TPRCYC IF SET RATHER THAN .STDFE FOR THE
DEFAULT FILE OFFLINE EXPIRATION DATE AT DIRINI+60L.

[End of TCO 5.1073]


TOPS20 Change Order Number 5.1075

Written by: OSMAN		24-Jun-80 11:37:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: If you say "SET LOC<cr>" to exec, you get L2102 instead of 2102

Diagnosis: ATBPTR was getting copied to ATBSUF in COMND before CMRNS but
no characters were in atom buffer.  The "L" is hence left over from "LOC".

Solution: Move the copy to after the SKPNB call so it doesn't happen unless
we have at least one non-break character.

[End of TCO 5.1075]


TOPS20 Change Order Number 5.1076

Written by: OSMAN		24-Jun-80 14:53:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: In exec, if you type "SYSTAT ABC^V$^V$<cr> you get a beep!
	(That's two quoted escapes folloed by end-of-line.)

Diagnosis: At CMRQUT, COMND goes to CMCIN to read the character being quoted
	but sets the CM%ESC flag if the quoted character is escape.  Hence
	it beeps thinking there's an ambiguity.

Solution: Make CMRQUT call CMCINX (new CMCIN entry) that doesn't set flags.

[End of TCO 5.1076]


TOPS20 Change Order Number 5.1078

Written by: DBELL		25-Jun-80 12:07:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:
Related SPR's: 


Problem: 
The monitor doesn't give enough information about directory problems.

Diagnosis: 
The various BUGCHKs like DIRFDB type only the directory number and
structure name.  This isn't good enough to fix the problem (short of
blasting and recreating the involved directory).  You also want to
know what location in the directory is bad.

Solution: 
Add another argument to lots of of the directory BUGCHKs which will tell
the offset into the directory of the bad data.  As an example, DIRFDB will
now give the offset into the directory of the bad FDB.

[End of TCO 5.1078]


TOPS20 Change Order Number 5.1079

Written by: GRADY		25-Jun-80 15:59:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 	 14333


Problem: 
Possible ILMNRF BUGHLTs on V4, or ILWRT2 on 3A.  Other random write to memory
bugs as well.

Diagnosis: 
LDTAC2 routine in MEXEC calls STADYN with CTRLTT in T2.  If CTRLTT has a
-1 (for detached) in it, STADYN does not care and returns junk.

Solution: 
Check CTRLTT before calling STADYN.  If .LE. 0, unlock DEVLCK, go OKINT
and return.

[End of TCO 5.1079]


TOPS20 Change Order Number 5.1081

Written by: GRADY		25-Jun-80 16:03:15

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 14328


Problem: 
Under certain circumstances, you cannot change a owner-changeable field of
an FDB without opening the file for write access.

Diagnosis: 
CHFDB1 assumes T4 has the FDB index, yet just before getting to CHFDB1 a call
to ACCCHK blows T4 away.

Solution: 
Reload T4 with the FDB index (from CHFDBD) at CHFDB1+1 and plod on.

[End of TCO 5.1081]


TOPS20 Change Order Number 5.1082

Written by: GRADY		25-Jun-80 16:10:26

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 13542


Problem: 
You can delete a directory while someone else is connected to it or logged
into it.

Diagnosis: 
CRDIR doesn't really check thoroughly, and it isn't too simple.....

Solution: 
First, prevent anyone from getting to the directory by setting it's invalid
bit in the IDXTAB.  Then scan the job tables for anybody connected to it or
logged into it.  If anybody IS using it, return a CRDIX6 (directory mapped)
mostly so they get an expected error code, otherwise blow it away.  In either
case we need to set the IDXTAB entry valid again, which still allows a window
for someone to connect to it before we delete it, but so it goes.  The only
other feasible solution would be to do all this NOSKED, and that could take
a lot of time.

[End of TCO 5.1082]


TOPS20 Change Order Number 5.1083

Written by: SCHMITT		25-Jun-80 21:40:21

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MSTR	GTJFN

Related TCO's:
Related SPR's: 


Problem: 
JOBS HANG WITH JSSTLK LOCKED

Diagnosis: 
ROUTINE SETDEV LOCKS JSSTLK WITHOUT BEING NOINT
AND ERROR RETURNS FROM CALL TO GTSTOJ IN MSTDMC AND MSTDFC
DOES NOT UNLOCK JSSTLK BEFORE RETURNING

Solution: 
BE NOINT AROUND LOCK IN SETDEV AND FIX ERROR RETURNS FROM
GTSTOJ TO UNLOCK JSSTLK LOCK

[End of TCO 5.1083]


TOPS20 Change Order Number 5.1084

Written by: ZIMA		26-Jun-80 15:38:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IO

Related TCO's:
Related SPR's: 	 14270


Problem: Extra null byte appended after memory to memory SIN.

Diagnosis: 
     Code at SIN3 checks user AC3 for zero after it has already updated
the count in the user's AC3, usually to zero.

Solution: 
     Extend the TRVAR at SINR1 to include a flag representing whether
the user AC3 is zero or not, and test that at SIN3.

[End of TCO 5.1084]


TOPS20 Change Order Number 5.1085

Written by: SANICHARA		26-Jun-80 15:56:37

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: Attempting to assign channel 23 gives an ATIX1 error.

Diagnosis: The range checking code is incorrect. It does not allow
channel 23 to be user assignable.

Solution: Correct code to do proper chenge. In module FORK at ATX2E+5
change CAIL 3,^D24 to CAIL 3,^D23.

[End of TCO 5.1085]


TOPS20 Change Order Number 5.1087

Written by: LYONS		 1-Jul-80 14:48:59

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SFCC0

Related TCO's:
Related SPR's: 


Problem: ^X does not echo in GTJFN

Diagnosis: Prehistoric (i.e. TENEX) feature of ^X being an editing char.
therefor, it was coded not to echo.

Solution: Fix the echo mask in GTJFN.MAC at SFCC0

[End of TCO 5.1087]


TOPS20 Change Order Number 5.1088

Written by: LYONS		 1-Jul-80 15:01:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IMPANX

Related TCO's:
Related SPR's: 


Problem: IMPNII, ILLUUO and other BUGHLTS, due to the stack being smashed

Diagnosis: Somebody changed IMIN3 to use stack as bitbucket rather than
some other location, but used pointer to stack rather than stack.

Solution: Change the DATAO that hits the stack to really hit the stack,
not the stack pointer.

[End of TCO 5.1088]


TOPS20 Change Order Number 5.1089

Written by: LYONS		 1-Jul-80 15:26:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IMPDV

Related TCO's:
Related SPR's: 


Problem: NCP fork does not run often enough, and can cause IMINX2
buginfs and problems for arpa users.

Diagnosis: NCP runs at high priority due to its being started with MSFRK,
but it must share with other job 0 forsk, and thats not good enough.

Solution: Make the NCP fork run in queue 0 all the time

[End of TCO 5.1089]


TOPS20 Change Order Number 5.1091

Written by: SANICHARA		 2-Jul-80 14:44:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN	LOGNAM

Related TCO's:
Related SPR's: 


Problem: 
Long form GTJFN can cause SEGT37. Also SECGT1 happens when the byte size
in AC3 in LOGNAM is bad.

Diagnosis: 
The monitor never validate the character it is retrieving. Hence the byte
pointer from CPTAB and the dispatch location for CCTAB could either or both
be invalid with the resultant BUGHLTS.

Solution: 
Ensure that the character being retrieved is a valid ASCII character. The
byte pointer and dispatch location will then be both correct. Also combine
the two similar but separate routines into a single routine at GTCODE.

[End of TCO 5.1091]


TOPS20 Change Order Number 5.1094

Written by: OSMAN		 3-Jul-80 16:53:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: "?" doesn't work in time and date fields

Diagnosis: CMRFLN stops just before "?"

Solution: Make CMRFLN read one more character to see if it's "?"

[End of TCO 5.1094]


TOPS20 Change Order Number 5.1095

Written by: ZIMA		 5-Jul-80 22:12:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	BOOT

Related TCO's:	5.1257
Related SPR's: 


Problem: BOOT HANGS

Diagnosis: 
     BOOT is totally unprepared for the case of uninitialized memory,
especially in the area of the BOOT self-relocation code.  It takes
page faults on each word of the exchange and winds up looping at zero.
A KS10 cannot be booted after powerup until a ZM is done.

Solution: 
     Move the initial EPT to the CODEND page, where it will remain fixed
until BOOT has moved itself.  Change the sense of the exchange loop so it
will be microcode invariant against the destructive page faults from any
uninitialized memory.

[End of TCO 5.1095]


TOPS20 Change Order Number 5.1096

Written by: DBELL		 6-Jul-80 21:33:06

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:
Related SPR's: 


Problem: 
Users using RP20 disks can get hung waiting for I/O, and if they are
NOSKED at the time, the system stalls and gets a J0NRUN BUGHLT.

Diagnosis: 
The DX20 microcode for the RP20s falls over occasionally, thus making
the units appear off-line.  If the operator restarts or reloads the
microcode, things work again.  However, if the system is hung, the
operator cannot reload the microcode to unhang it!!

Solution: 
Have the monitor check the state of controllers once a minute in the
PHYCHK routine in PHYSIO.  If a controller is dead, make an attempt to
restart it.

[End of TCO 5.1096]


TOPS20 Change Order Number 5.1098

Written by: BLOUNT		 8-Jul-80 10:17:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NONE

Related TCO's:
Related SPR's: 


Problem: THIS IS A TEST

Diagnosis: FOO

Solution: FOO

[End of TCO 5.1098]


TOPS20 Change Order Number 5.1100

Written by: GRANT		 8-Jul-80 13:26:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILNSP

Related TCO's:
Related SPR's: 


Problem: If a DECnet filespec is given in which the node name is more than
         6 characters the error message returned is "Invalid network file
	 name".

Diagnosis: The code in PRSNAM has actually detected the right situation but
	   a better error message could be used.

Solution: Use COMX19 instead of DCNX1.
[End of TCO 5.1100]


TOPS20 Change Order Number 5.1101

Written by: OSMAN		 9-Jul-80 09:18:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: The poor tops-10 slob that comes to tops-20 and
tries typing

	@MOUNT TAP FOO:/VOLIDS:ABC/WE

expecting /WE to mean /WRITE-ENABLED, she gets the wrong diagnostic saying

	?Comma not given

Diagnosis: the XCMTOK routine was leaving old junk in atom buffer

Solution: Make XCOMNE always call TIELCH to get atom buffer tied off at
appropriate place.  This way, the slob in the above example will get

	?Does not match switch or keyword

[End of TCO 5.1101]


TOPS20 Change Order Number 5.1102

Written by: DBELL		11-Jul-80 15:54:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: 
Non extended addressing systems cannot use RP20s.  They won't mount
because the BITTABLE area is too small for them.

Diagnosis: 
Size is only 15000 octal words, but a single RP20 spindle needs slightly
over that much.

Solution: 
Increase BTBMAX by another page.  Notice, for non-extended addressing
monitors, that an RP20 structure can only use one spindle because of
this tight fit of the bittable.  For extended addressing monitors, this
table is not a restriction.

[End of TCO 5.1102]


TOPS20 Change Order Number 5.1103

Written by: MILLER		16-Jul-80 15:59:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: Non-blocking dump mode input on labeled tapes
sometimes fails at the EOF.

Diagnosis: There is a race in MAGTAP that can cause a read operation
to be posted to PHYSIO even though a data exception is detected.
This race means that the first trailer record will be read
into the user's buffer and that the monitor will perceive a badly
formed tape.

The race occurs in both the monitor and the user interface so that
the MAGTAP code ought to be fixed. However there is a temporary hack
fix to TAPE that should fix the current problem with labeled tapes.

Solution: When EOF or EOV is detected on a tape being read
non-blocking, force repositioning of the tape by doing a backspace
file followed by a forward space file.

[End of TCO 5.1103]


TOPS20 Change Order Number 5.1104

Written by: ZIMA		18-Jul-80 21:14:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: TEXTI JSYS returns garbage error code.

Diagnosis: Typo uses address symbol instead of error code around RDTOPM+2L.

Solution: Fix typo.

[End of TCO 5.1104]


TOPS20 Change Order Number 5.1109

Written by: OSMAN		23-Jul-80 10:49:02

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	FORK	globs	monsym

Related TCO's:
Related SPR's: 


Problem: none

Diagnosis: PDVOP% jsys needed

Solution: Put it in

[End of TCO 5.1109]


TOPS20 Change Order Number 5.1110

Written by: ZIMA		23-Jul-80 13:37:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MAGTAP

Related TCO's:
Related SPR's: 	 14468


Problem: .MOINF function of MTOPR gets tape info reversed.

Diagnosis: Historical screwup on UDB variables.

Solution: 
     Make code return documented values by reversing appropriate entries
in the XCT table at MTINFT.

[End of TCO 5.1110]


TOPS20 Change Order Number 5.1112

Written by: R.ACE		23-Jul-80 17:16:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: Spurious "MOVE T1,FORKX" at JOBCF1+2

Diagnosis: Vestige from Release 3A

Solution: Remove it of course

[End of TCO 5.1112]


TOPS20 Change Order Number 5.1119

Written by: GRANT		 1-Aug-80 13:17:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: When the DN20 gets reloaded many BUGCHKs occur indicating
	 an "overly OKINT" situation.

Diagnosis: The coroutine DEDCOR (called from within OBJSRC) is being called
	   multiple times before returning to MCBDED.

Solution: At OBJSFD+1 change the JUMPN to JUMPG so you will not loop if
	  "any match" was acceptable.
[End of TCO 5.1119]


TOPS20 Change Order Number 5.1121

Written by: ZIMA		 2-Aug-80 17:26:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MFLOUT

Related TCO's:
Related SPR's: 	 14415


Problem: ILLUUO BUGHLTs

Diagnosis: Bad stack management in MFLOUT POPJs to oblivion.

Solution: In ROUND, put stack to the level TOOSML expects before entering it.

[End of TCO 5.1121]


TOPS20 Change Order Number 5.1125

Written by: SCHMITT		 5-Aug-80 10:35:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 
The NIN JSYS will incorrectly inputs characters following a CR
if the CR is not followed by a LF.

Diagnosis: 
NIN calls a general byte input routine, BIN1, which will simply ignore
all carriage returns.

Solution: 
Actually, BIN1 should ignore carriage returns only if they are followed
by a line feed.  If a CR is not followed by a LF, the CR should be 
returned.  To accomplish this, BIN1 should be rewritten.  I have chosen
to create a new routine, BIN2, which will return the next character 
regardless of what it is.  BIN1 then checks to see if it is a CR.  If so,
BIN1 will call BIN2 again to get the next character and if it is not a LF,
BIN1 will put the character back and return the CR to the calling routine.

[End of TCO 5.1125]


TOPS20 Change Order Number 5.1132

Written by: KONEN		14-Aug-80 12:01:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	BUGS	PROLOG	FUTILI	MSTR

Related TCO's:
Related SPR's: 


Problem: Structure is not accessible to anyone on a system.  INF STR
command says structure is not mounted, but looking at disks via MSTR
JSYS shows a mounted pack on a drive(s).

Diagnosis: The structure has been mounted with exclusive access.  This is
done on a fork basis.  If something happens to the fork, the structure is
left hanging.

Solution: Add code at KSELF time to dismount any structures that fork has
mounted with exclusive access.  The code was added in RELSTR: in FUTILI.
[End of TCO 5.1132]


TOPS20 Change Order Number 5.1135

Written by: MILLER		20-Aug-80 11:08:50

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: It is possible to use SMAP to create a read-only
private secton. Such an entity is useless.

Diagnosis: As above

Solution: If the user requests to create a private section, assume
that write access is required.

[End of TCO 5.1135]


TOPS20 Change Order Number 5.1136

Written by: ENGEL		20-Aug-80 14:50:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	all	monitor	routines

Related TCO's:
Related SPR's: 


Problem: The locks in the monitor do not follow any coherent set of rules.

Diagnosis: Re-write the locking scheme.

Solution: Force all locks to follow a precedence scheme. Create multiple
modes that allow for fast (production run) and slow (debuging run) locks
to run in the monitor.

[End of TCO 5.1136]


TOPS20 Change Order Number 5.1139

Written by: HALL		28-Aug-80 10:57:21

Edit checked: YES			   Document: YES
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: 
When fork 0 crashes, it doesn't tell you where it was executing
or what error it got.

Diagnosis: 
An error sends fork 0 to JB0INT, where it prints the PC to which
it is going but not the PC from which it got the error.

Solution: 
Add some code. This code prints MONPC and LSTERR. These locations
may not always help in the diagnosis of the problem, but they are
better than nothing.

[End of TCO 5.1139]


TOPS20 Change Order Number 5.1141

Written by: MOSER		 9-Sep-80 11:52:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MSTR

Related TCO's:
Related SPR's: 


Problem: Structure status bits not sent to MOUNTR correctly causing
accounting to be done on non-regulated structures.

Diagnosis: Status bits from left half of T4 are discarded and garbage
is stored.

Solution: At SNDUSG+24 change HRRM T4,T4(P6) to HLRM T4,T4(P6).

[End of TCO 5.1141]


TOPS20 Change Order Number 5.1145

Written by: OSMAN		12-Sep-80 14:20:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: When you ^C out of a PCL routine that has an INVOKEd fork, the
fork continues to run even though you are back at "@" level.

Diagnosis: The SCTTY jsys call that resets the fork's controlling terminal
is resuming the fork near SCTT22 due to the call to RFORK1.

Solution: Change SCTT21+5 to call FFORK3 instead of FFORK1 and change the
call at SCTT22+3 to call RFORK3 instead of RFORK1 in order that the "real"
frozenness of the fork be preserved.

[End of TCO 5.1145]


TOPS20 Change Order Number 5.1146

Written by: GRANT		16-Sep-80 15:29:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: RESBAD BUGCHK caused by MTRDIN routine.

Diagnosis: BLKULK has been rewritten and MTRDIN assumed that it didn't
           touch T2.

Solution: In MTRDIN, stash T2 before CALL BLKULK and get it back before
          CALL RELRES.
[End of TCO 5.1146]


TOPS20 Change Order Number 5.1153

Written by: GRANT		24-Sep-80 11:43:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: BIN, SIN, and SINR randomly returned a 1 (instead of the
	correct byte) from DECnet JFNs.

Diagnosis: The NETSQI routine in NSPSRV was returning it to the
	user.

Solution: BLKULK was recently rewritten and NETSQI can no longer take
	advantage of BLKULK leaving T2 untouched.
[End of TCO 5.1153]


TOPS20 Change Order Number 5.1154

Written by: SCHMITT		24-Sep-80 14:49:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
Error Message IOX22 'Invalid HDR1 Sequence Number' when setting data
mode or attempting to read from some EBCDIC labeled tapes.

Diagnosis: 
When TOPS-20 checks the Form Control Byte in the HDR2 Label in the
routine GETFC0, it enforces that the Form Control Byte (CP 37) conform
to DEC standard (A, M, X, or space).  ANSI standard X3.27-1969 clearly
states that CP 16-50 of the HDR2 Label are system defined and should
be ignored in interchange mode.  TOPS-20 does not ignore this byte and 
as a result, may disagree with the contents of this character position
and return the IOX22 error message.

Solution: 
At the check in the GETFC0 routine for an EBCDIC labled tape, return
the code for an undefined form control rather than checking for
consistency of this byte with DEC standard.

[End of TCO 5.1154]


TOPS20 Change Order Number 5.1155

Written by: ZIMA		24-Sep-80 14:51:11

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE	monsym

Related TCO's:
Related SPR's: 	 14417


Problem: Garbage error code returned using labeled tape.

Diagnosis: Filename size checking code forgets to return one.

Solution: Return new error code for this case in several places in TAPE,
after TSTSIZ calls and other check in MTEXL.  New code is GJFX53 -
'Tape label filename specification exceeds 17 characters'.

[End of TCO 5.1155]


TOPS20 Change Order Number 5.1159

Written by: GRANT		30-Sep-80 10:37:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: NSP not recognizing a DECnet Phase III Transport init as invalid.

Diagnosis: The route header test in DOMSGQ must be enhanced.

Solution: Make sure B0 is off in the first byte of the message.
[End of TCO 5.1159]


TOPS20 Change Order Number 5.1160

Written by: GRANT		30-Sep-80 10:50:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	BUGS

Related TCO's:
Related SPR's: 


Problem: BUGCHK NSPRTH has useless optional data - the message address.

Diagnosis: The byte that was determined to be invalid would be better.

Solution: Optional data now comprised of line number and invalid byte.
[End of TCO 5.1160]


TOPS20 Change Order Number 5.1161

Written by: GRANT		30-Sep-80 14:03:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	KDPSRV

Related TCO's:
Related SPR's: 


Problem: MONPDL BUGHLTs on KS

Diagnosis: KMC stack overflow

Solution: Increase it from 40 to 50
[End of TCO 5.1161]


TOPS20 Change Order Number 5.1164

Written by: DONAHUE		 2-Oct-80 10:54:21

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 	 14665


Problem: GTJFN does not catch logical name loop if the parse-only bit
is turned on.

Diagnosis: 
At GTJF23+16 and in the literal at ENDLZ1+3, if a logical name has been
stepped, GTJFST is called to restart the parse.

Solution: 
In both places, check for Parse-only, and if so, ignore logical name
stepping.

[End of TCO 5.1164]


TOPS20 Change Order Number 5.1165

Written by: ZIMA		 3-Oct-80 11:42:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	IMAN22

Related TCO's:
Related SPR's: 	 14913


Problem: IONXM BUGHLTs on 2020 ARPA systems when AN22 is not present.

Diagnosis: 
     If local host has been set, the NCP fork at IMPSTT calls IMPRLQ
which properly does existence check on AN22, but on failure, proceeds
to IMPSTA and IMPSTB and IMPRSS to cycle the interface.  IMPRSS makes
no validity check for the interface before trying to reload the AN22
microcode.

Solution: 
     Have IMPRSS make a check for the AN22.  IMPRLQ is not good enough,
since if the AN22 is there, we want to reload it if IMPRLQ fails,
indicating IMP not ready.  Therefore, call UBGOOD directly.

[End of TCO 5.1165]


TOPS20 Change Order Number 5.1166

Written by: SCHMITT		 3-Oct-80 13:12:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: 
Keywords will not be parsed if an alternate function for the
COMND JSYS is a .CMTXT function.

Diagnosis: 
COMND will  only parse  the function  whose break  set  will
allow the most  number of characters.   This works for  most
fields but  not  when  a function  is  .CMTXT.   The  .CMTXT
function will always  parse more characters  than any  other
field so if  it is used  anywhere in a  FDB chain, no  other
function will get parsed.

Solution: 
Create a new bit for the command functions special  argument
block which  says that  a  first pass  for reading  a  field
should not be performed for this field.  The functions which
should  have  this  new  characteristec  should  be  .CMNOI,
.CMCFM, .CMCMA, .CMINI, .CMTXT, .CMTAD, .CMQST, .CMUQS,  and
.CMTOK.

Along with this added structure, check whether a first  pass
should be performed for the specific function at XCOM7+2.

[End of TCO 5.1166]


TOPS20 Change Order Number 5.1169

Written by: GRANT		 8-Oct-80 10:42:33

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: GTJFN doesn't know about DECnet Phase III node name restrictions.

Diagnosis: PRSNAM needs to analyze node name.

Solution: PRSNAM now calls PARND1.
[End of TCO 5.1169]


TOPS20 Change Order Number 5.1173

Written by: MOSER		15-Oct-80 10:10:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MONSYM

Related TCO's:
Related SPR's: 


Problem: 
MOUNTR does not do accounting correctly. 

Diagnosis: 
Code is wrong or nonexistent.

Solution: 
Add or correct code and add new symbols to MONSYM for label state.

[End of TCO 5.1173]


TOPS20 Change Order Number 5.1175

Written by: MOSER		17-Oct-80 10:40:08

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
Record size and related fields are not preserved when doing a volume switch.

Diagnosis: 
Open code resets record size to job defaults and it is not reset.

Solution: 
Set record size to correct value and call MTASWB when doing a volume switch.

[End of TCO 5.1175]


TOPS20 Change Order Number 5.1177

Written by: GRANT		21-Oct-80 09:08:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: KS get ILLUUO BUGHLT when DECnet link goes down.

Diagnosis: DEDCOR cleanup routine wasn't modified correctly when TSTLCL
	routine was eliminated.

Solution: Make the test for a local link work properly.
[End of TCO 5.1177]


TOPS20 Change Order Number 5.1180

Written by: HALL		25-Oct-80 11:01:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	PAGEM	APRSRV	FORK	SWPALC

Related TCO's:
Related SPR's: 


Problem: 
We've run out of virtual address space.

Diagnosis: 
Need to move data out of section 0/1 so that there is room for more
code.

Solution: 
Move the DST into a non-zero section. This means making code run in
section 1, as well as creating a section for the DST. Also, GDSTX
was changed to return an address rather than an offset into the DST.
Callers were changed to reference (T2) rather than DST(T2).

[End of TCO 5.1180]


TOPS20 Change Order Number 5.1182

Written by: MURPHY		29-Oct-80 12:21:52

Edit checked: YES			   Document: YES
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	MONSYM

Related TCO's:
Related SPR's: 


Problem: Inadequate interactive response under class scheduling.

Diagnosis: Giving equal priority to all jobs within a class, while
"fair", might not be what you want.

Solution: New bias bit to optionally make jobs within a class
behave as under non-class scheduling.  This provides much
more interactive response (subject to other bias bits), allows
jobs with multiple forks to get proportionately more time, etc.
Bit is SK%CL1.

[End of TCO 5.1182]


TOPS20 Change Order Number 5.1184

Written by: UHLER		31-Oct-80 07:04:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYX2	PHYP2

Related TCO's:
Related SPR's: 


Problem: DX20 (both tape and disk) microcode sometimes crashes in strange
and wonderful ways with no good explanation.

Diagnosis: Reading Massbus register 30 from the -20 causes it to get loaded
from the microstore location pointed to by the PC.  If the microcode is
running and the PC is changing, we can screw up the next instruction fetch
with IR parity errors and the like.

Solution: Don't read register 30 unless the microcode has stopped and then
write off IR enable before doing so.

[End of TCO 5.1184]


TOPS20 Change Order Number 5.1187

Written by: GRANT		 3-Nov-80 16:21:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	NSPPAR

Related TCO's:
Related SPR's: 


Problem: DN20 crashing when connected to KS.

Diagnosis: TOPS-20 NSP sending message that are "too big" to DN20.

Solution: Make proper segment size calculation in STRMSG.
[End of TCO 5.1187]


TOPS20 Change Order Number 5.1188

Written by: GRANT		 3-Nov-80 20:49:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FREE

Related TCO's:
Related SPR's: 


Problem: VERY DIFFICULT TO TRACK DOWN RESIDENT FREE SPACE BUGS.

Diagnosis: FREE SPACE MANAGER DOESN'T POLICE ITS USERS AS WELL AS IT
	MIGHT.  ALSO, NOT MUCH DATA IS KEPT ON FREE SPACE USERS.

Solution: ADD MORE INFORMATION TO FREE SPACE HEADER AND CREATE A
	TRAILER WORD.  THIS TRAILER WORD IS USED FOR CHECK FOR
	THE CALLER WHO WRITES BEYOND ITS ASSIGNED AREA.
[End of TCO 5.1188]


TOPS20 Change Order Number 5.1193

Written by: OSMAN		 7-Nov-80 09:55:56

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	lost

Related TCO's:
Related SPR's: 


Problem: Make GET and SAVE handle extended addressing

Diagnosis: 

Solution: Do it.  Also, GETX4 is a new error code and SSAVX2 has been changed.

[End of TCO 5.1193]


TOPS20 Change Order Number 5.1194

Written by: SCHMITT		 7-Nov-80 14:52:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC	BUGS

Related TCO's:
Related SPR's: 	 15032


Problem: 
'Unknown data in file, Continuing...' messages from CHKPNT

Diagnosis: 
When the MONITOR copies CHECKPOINT.BIN to SYSTEM-DATA.BIN
during system start up, it would use the right half of word
one in a checkpoint record as the length of the record and
would deposit a trailer label in this word.  When a new
CHECKPOINT.BIN is created, word one of each record is the
maximum number of jobs on the system.  This would change
when the job became active, but until then, whenever the
system is reloaded, whichever word is an offset JNOBS away
from the start of the checkpoint record will get trashed.
If NJOBS is an even multiple of 100 then the flag word which
specifies whether a job is active or not will get trashed.
This will fool the MONITOR into believing that the entry is
active and will then write this record into SYSTEM-DATA.BIN.
This is an erroneous record and will thus cause the CHKPNT
error message.

Solution: 
Before depositing the trailer label in a checkpoint record,
check to see if the job is active.  If the job is not
active, do not deposit the trailer label.  Also, check the
size of the record before depositing the trailer label and
generate a CKPLEN BUGCHK if the length of the record is out
of range.  This is to cure ILMREF BUGHLTs which can occur if
the checkpoint file has been trashed.

[End of TCO 5.1194]


TOPS20 Change Order Number 5.1195

Written by: GRANT		 8-Nov-80 17:45:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FREE

Related TCO's:
Related SPR's: 


Problem: Resident free space BUGxxx's can provide conflicting information.

Diagnosis: Make the individual tests mutually exclusive.

Solution: Reorder the validity tests in RELRES.
[End of TCO 5.1195]


TOPS20 Change Order Number 5.1196

Written by: DONAHUE		12-Nov-80 16:17:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: 
If status reporting is turned on, a BUGxxx, or CPU or channel problem
can hang the machine.

Diagnosis: 
Routine GENBLK (called if status reporting turned on) does a SAVEP and
SAVET which eats up the whole stack and causes PDL overflow. The 'T'
AC's are clobbered shortly after returning from GENBLK.

Solution: 
Don't do the SAVET, freeing up 4 stack locations.

[End of TCO 5.1196]


TOPS20 Change Order Number 5.1198

Written by: MURPHY		17-Nov-80 12:29:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: Swap wait time as reported by WATCH, SYSDPY, etc. very high,
even when system lightly loaded.

Diagnosis: NBSWP not being decremented under certain circumstances.

Solution: Fix missing case.

[End of TCO 5.1198]


TOPS20 Change Order Number 5.1199

Written by: OSMAN		18-Nov-80 15:58:10

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR

Related TCO's:
Related SPR's: 


Problem: 

Diagnosis: 

Solution: There are many changes to GET and SAVE commands in exec and
GET and SSAVE jsyses for extended addressing.  PS:[DOC-SPECS]GETSAV.MEM
describes some of these changes.  Others include the exec's
defaulting of page ranges on the SAVE command.

Many of these things need to be documented!

[End of TCO 5.1199]


TOPS20 Change Order Number 5.1200

Written by: DONAHUE		21-Nov-80 10:17:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 14813


Problem: 
When attempting to @RUN a file that is offline, the error message will be
"File does not exist".

Diagnosis: 
Routine ARACCK doesn't bother to check for EXE access requested.

Solution: 
Make ARACCK check for EXE access along with Read.

[End of TCO 5.1200]


TOPS20 Change Order Number 5.1202

Written by: GRANT		24-Nov-80 16:09:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: TOPS-20 accepts DECnet Phase III messages and tries to process
	them.

Diagnosis: No checking is done for valid subtypes in the message flags.

Solution: Put in subtype validation for ACKs and data messages.
[End of TCO 5.1202]


TOPS20 Change Order Number 5.1203

Written by: MURPHY		24-Nov-80 17:38:29

Edit checked: YES			   Document: NO
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: PREPG1 not returning page number in T1 under some circumstances.

Diagnosis: 

Solution: UPD ID = 1311

[End of TCO 5.1203]


TOPS20 Change Order Number 5.1204

Written by: OSMAN		26-Nov-80 10:18:06

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK	monsym

Related TCO's:
Related SPR's: 


Problem: With extended addressing, way needed to start fork in arbitrary
section

Diagnosis: pc's larger than 18 bits don't fit in old-style SFORK jsys args

Solution: Two things:

1)	Modify old SFORK jsys to conjure starting PC as section in entry vector,
	(which is settable with GET jsys since entry vector has enough room
	in exe file) and 18-bit arg supplied by user.

2)	Implement new XSFRK jsys whose args are:

		AC1/	same as SFORK
		AC2/	PC flags (same as left half of AC2 for SFORK)
		AC3/	PC address

[End of TCO 5.1204]


TOPS20 Change Order Number 5.1205

Written by: OSMAN		26-Nov-80 15:08:48

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	monsym	FORK

Related TCO's:
Related SPR's: 


Problem: GEVEC and SEVEC aren't sufficient for extended addressing

Diagnosis: We need 36-bit entry vector addresses, and these jsyses only allow
18-bit ones.

Solution: Implement XGVEC and XSVEC whose ac's mean:

	AC1/	fork handle
	AC2/	length
	AC3/	address

[End of TCO 5.1205]


TOPS20 Change Order Number 5.1206

Written by: WACHS		 2-Dec-80 05:45:47

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYH2	PHYM78	STG	BOOT

Related TCO's:
Related SPR's: 


Problem: Monitor doesn't talk to RP07, TM78

Diagnosis: No code

Solution: Add code

[End of TCO 5.1206]


TOPS20 Change Order Number 5.1213

Written by: GRANT		11-Dec-80 11:28:02

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: Growing frequency of not being able to open DECnet links.

Diagnosis: DECnet pool for swappable free space being exhausted.

Solution: Increase MAXBLK - swappable free space allocation for DECnet.
[End of TCO 5.1213]


TOPS20 Change Order Number 5.1215

Written by: DONAHUE		15-Dec-80 13:54:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 	 15169


Problem: 
If echoing is turned off and the user gives a '?' to COMND, it will type
a help text and echo the current field.

Diagnosis: 
When COMND notices the '?' it doesn't check if echoing is turned on or off.

Solution: 
Add routine ECOCHK to check echo mode and at CMRAT1:+N after seeing '?',
call ECOCHK and if echoes are off send a bell to user.

[End of TCO 5.1215]


TOPS20 Change Order Number 5.1216

Written by: GRANT		16-Dec-80 13:00:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: ILMNRF BUGHLTs

Diagnosis: Resident free space being wiped out by DECnet messages.
	DTE driver appending 2 messages together.

Solution: In DOFMCI, if the call to NSPSPC fails clear the byte count
	DTEBC,(A).  Thus, when it is time for another transfer it won't
	find invalid data in DTEBC.
[End of TCO 5.1216]


TOPS20 Change Order Number 5.1217

Written by: GRANT		22-Dec-80 08:50:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: ILMNRF BUGHLT when trying to delete a file.

Diagnosis: If you try to delete a file whose index block is marked in the 
	BAT block you hit a bug in the YESBAT routine.

Solution: STRUDB is a DEFSTR - use LOAD instead of MOVE.
[End of TCO 5.1217]


TOPS20 Change Order Number 5.1218

Written by: GRANT		22-Dec-80 09:44:39

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: MS gets "Invalid task name" error when trying to do an OPENF.

Diagnosis: Wrong error message being returned to the user.

Solution: In OPNDFT, change DCNX4 to MONX06.
[End of TCO 5.1218]


TOPS20 Change Order Number 5.1222

Written by: WACHS		31-Dec-80 08:48:05

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYSIO	PHYP4

Related TCO's:
Related SPR's: 


Problem: User programs have to be killed when a disk drive fails.

Diagnosis: There is no way without DISMOUNTing the structure, and
reMOUNTing it elsewhere to move a pack from a sick drive to a
healthy one.

Solution: When a pack spins up check its HOME blocks against all
the structures known to the system. If the HOME blocks match, and
the former drive is now off-line, assume that the pack has moved
from one unit to another, and adjust the monitor's tables
accordingly.

[End of TCO 5.1222]


TOPS20 Change Order Number 5.1226

Written by: SCHMITT		 6-Jan-81 15:23:23

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 
Bad code in the RMAP routine.  The routine FRKMAP will never return
if the routine fails (ie, called for a non-existent section).  Instead,
FRKMAP will jump to PMAPER which will generate an ITERR.  RMAP should
call FKHPTN instead and do its own error recovery (in this case, would
be to unlock the fork structure and then generate an ITERR.  This problem
appeared in the autopatch monitor because that monitor does not have
the cludge in PMAPER which will unlock the fork structure but only if
the fork structure is locked.  If some routine locks the fork lock, then
that routine should unlock it.

Diagnosis: 
Lazy coding.

Solution: 
Call FKHPTN instead of FRKMAP and unlock the fork structure and generate
an ITERR if FKHPTN fails.

[End of TCO 5.1226]


TOPS20 Change Order Number 5.1229

Written by: HALL		 8-Jan-81 16:37:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:
Related SPR's: 


Problem: A bad FDB can cause ILMNRF's

Diagnosis: Routines to scan FDB chains don't always verify that an
FDB is good before using its data.

Solution: Add calls to FDBCHK to NAMSCN and EXTSCN whenever they
find a new FDB and start to use its data.

[End of TCO 5.1229]


TOPS20 Change Order Number 5.1230

Written by: GRANT		 8-Jan-81 16:39:21

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	DTESRV	FREE	PROLOG

Related TCO's:
Related SPR's: 


Problem: The existing DEBUG switch is not very useful.

Diagnosis: Make individualized switches for special types of debug-mode checking
	and make DEBUG a master switch which will easily turn all the individual
	switches off.

Solution: Convert existing uses of DEBUG to the new individual switches.
[End of TCO 5.1230]


TOPS20 Change Order Number 5.1232

Written by: OSMAN		12-Jan-81 14:40:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: Try this with exec:

	@DEFINE SY: (as) SYS:FORTRA.EXE
	@DAY
	Monday...
	@
	@SY:
	?error message
	@

Diagnosis: Normally, the COMND jsys is clever about interpreting input,
such that an input such as SY: gets correctly interpreted as a logical name
rather than an abbreviated SYSTAT command followed by a colon!  However,
COMND's logic that handles blank lines (note the extra @ after DAY's output
due to user typing extra cr) erroneously doesn't loop back far enough.  Hence
if you type a blank line after a command, then something like SY:, COMND
incorrectly interprets it (as SYSTAT rather than as a device).

Solution: CHKDF1+3/  JRST XCOMN0 => JRST XCOMB0

[End of TCO 5.1232]


TOPS20 Change Order Number 5.1234

Written by: WACHS		20-Jan-81 05:31:03

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GLOBS	PHYSIO	PHYH2	PHYH11	PHYM78

Related TCO's:
Related SPR's: 


Problem: MAGTAPE error recovery doesn't do as thorough a job
as it could

Diagnosis: Reread in the opposite direction isn't tried

Solution: Implement retry in opposite direction on read errors

[End of TCO 5.1234]


TOPS20 Change Order Number 5.1236

Written by: SCHMITT		21-Jan-81 11:18:40

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MSTR

Related TCO's:
Related SPR's: 


Problem: 
If the MSTR JSYS is called with function .MSIMC  (increment
the mount count for a job)  with an invalid job number, bad
error messages could be returned, the system could crash, or
the job could hang.

Diagnosis: 

If MSTR is called with a valid job number but the job is not
logged in, MSTR will  generate an error  return but with  no
error number.  The code is simply missing the error code  to
return.

If MSTR is called  with an invalid job  number, no check  is
made as to whether  it is valid.  The  system then tries  to
map the JSB, whcih could fail and cause a BUGHLT, or TOPS-20
could map the JSB and try to lock the JSSTLK.  This is where
the job could hang.

Solution: 
Provide an error code for the  no such job error return  and
make a check for invalid job number at MSTJOB.

[End of TCO 5.1236]


TOPS20 Change Order Number 5.1238

Written by: ZIMA		22-Jan-81 12:27:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 	 14712


Problem: TCO 4.1.1129 never made it to the 5 sources.

Diagnosis: Sloppy source control.

Solution: Put it in.

[End of TCO 5.1238]


TOPS20 Change Order Number 5.1239

Written by: ZIMA		22-Jan-81 13:20:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 	 14330


Problem: 
     System crashes such as ILMNRF on Model B processors, wild addressing
causing ILMNRF or possibly memory modification on Model A processors.

Diagnosis: 
     Garbage passed to RPACS JSYS may be used as a JFN without any validity
checking, causing wild references.

Solution: 
     Range check JFN value to make sure it is reasonable before attempting
first reference to JFN blocks.

[End of TCO 5.1239]


TOPS20 Change Order Number 5.1240

Written by: ZIMA		24-Jan-81 23:17:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 	 14838


Problem: 
     Accounting session connect times are garbaged.  The accounting shift
change feature is in use.

Diagnosis: 
     Checkpoint code uses the wrong value for calculation; an index
register is missing.

Solution: 
     Correct the code to include the index register in CPGCON.

[End of TCO 5.1240]


TOPS20 Change Order Number 5.1241

Written by: ZIMA		24-Jan-81 23:39:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 	 14572


Problem: 
     ILPPT3 BUGHLTs on Model B machines.

Diagnosis: 
     GTJFN may under some circumstances try to use resources implied
by GJ%XTN while doing a short-form GTJFN.  GJ%XTN is supposed to be
ignored on short-form GTJFNs.

Solution: 
     Make sure that the internal flag JFNRD is cleared in two places
if a short-form GTJFN is being done.

[End of TCO 5.1241]


TOPS20 Change Order Number 5.1242

Written by: ZIMA		25-Jan-81 00:58:19

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILMSC

Related TCO's:
Related SPR's: 


Problem: 
     FLKTIM or other BUGCHK, job "hung" not interruptible while waiting
for non-controlling terminal to close.

Diagnosis: 
     TTYCLZ code does a DOBE which may block NOINT with the device table
lock, DEVLCK locked.

Solution: 
     Replace the DOBE with the proper code to achieve the same results via
the monitor's blocking return mechanism.

[End of TCO 5.1242]


TOPS20 Change Order Number 5.1243

Written by: ZIMA		25-Jan-81 01:21:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 15000


Problem: 
     CRDIR JSYS sometimes fails when passed -1,,ADDRESS as the pointer to
the password string.  It succeeds if passed a true byte pointer instead.

Diagnosis: 
     New code added to check for setting a null password (which requires
ownership rights to the directory) did not check for the case of -1,,ADR
in place of a byte pointer.

Solution: 
     Add the code to handle the case.

[End of TCO 5.1243]


TOPS20 Change Order Number 5.1244

Written by: ZIMA		25-Jan-81 20:27:56

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 	 14450


Problem: 
     Certain classes of GTJFN errors cause JFNs to become "lost", that is,
the JFN numbers are not available for assignment until a global cleanup
operation is done (i.e. RLJFN -1).

Diagnosis: 
     Error path out of GTJFN bypasses the routine to release the JFN on
an error.

Solution: 
     Install an ERJMP to catch the case and exit via the cleanup routine.

[End of TCO 5.1244]


TOPS20 Change Order Number 5.1245

Written by: ZIMA		26-Jan-81 13:45:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 	 13624


Problem: 
     ERSTR JSYS sometimes does not recognize ERJMP/ERCAL following it on
error conditions such as illegal error number.

Diagnosis: 
     Code just returns without bothering to check.

Solution: 
     Change code to exit JSYS via the route which will notice the ERJMP/ERCAL
when needed.

[End of TCO 5.1245]


TOPS20 Change Order Number 5.1252

Written by: ZIMA		26-Jan-81 17:50:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	t20-an

Related TCO's:
Related SPR's: 


Problem: TOPS20AN (KL) is not Autopatchable.

Diagnosis: REL library constructed incorrectly for use with MAKLIB.

Solution: Remove the unneeded FILINI.REL from before the needed EFILIN.REL.

[End of TCO 5.1252]


TOPS20 Change Order Number 5.1253

Written by: ZIMA		27-Jan-81 10:42:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DATIME

Related TCO's:
Related SPR's: 	 14335


Problem: 
     ODTIM JSYS does not include the comma when OT%DAM and OT%SPA are
specified, contrary to documentation.  In addition, if no output is
generated, and a string pointer is specified, then the string is not
properly terminated.

Diagnosis: 
     In the first case, code does not check, and does comma only for
verbose month name specified.  In the second, code not written.

Solution: 
     Correct code to output comma as documented for OT%DAM and OT%SPA
set and OT%NMN not set (i.e. Feb 10, 80), and add code to be sure the
output string is terminated properly with a null.

[End of TCO 5.1253]


TOPS20 Change Order Number 5.1255

Written by: ZIMA		30-Jan-81 15:55:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 13119


Problem: 
     SACTF JSYS has several problems: it modifies the JFN it uses, it returns
a zero error code for certain error conditions, and it returns the updated
string pointer in the wrong register, destroying the user's data.

Diagnosis: 
     Code was written to modify the JFN, the zero error codes are the result
of incorrectly using an unforgiving macro, and the wrong register was just
bad code.

Solution: 
     Change the code to correct all of the above.  This results in effectively
a complete rewrite of the JSYS.

[End of TCO 5.1255]


TOPS20 Change Order Number 5.1256

Written by: ZIMA		31-Jan-81 18:34:07

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	LINEPR

Related TCO's:
Related SPR's: 	 14630


Problem: 
     Lineprinters lose data during online/offline transitions.

Diagnosis: 
     Buffer initialization is incorrect, and the buffer size allocation
is calculated incorrectly; it should follow the data byte size on a per
buffer basis.

Solution: 
     Change the code to initialize the buffers properly.

[End of TCO 5.1256]


TOPS20 Change Order Number 5.1258

Written by: ZIMA		 5-Feb-81 10:54:56

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	BUGS	FILINI	IO	STG

Related TCO's:
Related SPR's: 


Problem: TOPS-20 is too big and too slow.

Diagnosis: Unused code and large data areas unused since prior to Release 2.

Solution: Remove some of the historical code and its data areas, specifically
the dump IO buffers and initialization/use code.  Frees something more that
10(octal) pages of address space.

[End of TCO 5.1258]


TOPS20 Change Order Number 5.1259

Written by: GRANT		 5-Feb-81 13:25:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: NSP returns the wrong disconnect reason code in response to
a DI.

Diagnosis: The response to a DI should always be reason code 42.

Solution: The code should always return reason 42 in response to a DI.
DCs for other reason should have their own routines.
[End of TCO 5.1259]


TOPS20 Change Order Number 5.1263

Written by: MURPHY		25-Feb-81 17:09:33

Edit checked: YES			   Document: YES
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 


Problem: EOF pointer of file is changed when closing file
with CZ%ABT.

Diagnosis: No check of CZ%ABT flag in code which updates
FDB on close.

Solution: Add such a check.

[End of TCO 5.1263]


TOPS20 Change Order Number 5.1264

Written by: WACHS		27-Feb-81 03:55:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DSKALC

Related TCO's:
Related SPR's: 


Problem: System won't come up - dies with an ILLUUO

Diagnosis: If PS is not mounted, asking what the public
structure is puts us in section 0. There is a call to XBLTA
in GOTSWM which requires us to be in a non-0 section

Solution: CALL SE1CAL

[End of TCO 5.1264]


TOPS20 Change Order Number 5.1265

Written by: FLEMMING		27-Feb-81 09:41:25

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PROLOG	FORK	PAGEM	JSYSA

Related TCO's:
Related SPR's: 


Problem: RMAP says a write protected section can be written in.

Diagnosis: RMAP and the page fault handler don't know about access
restricted by a section pointer.

Solution: 1) Have FKHPTN return section access bits and have RMAP
and section bits with page access bits.
2) On a page fault caused by a write, see if the section pointer
allows write.

[End of TCO 5.1265]


TOPS20 Change Order Number 5.1266

Written by: WACHS		 2-Mar-81 07:13:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: TM78 retry-opposite error recovery is too paranoid

Diagnosis: The byte-count can change during the course of retrying,
and we should still try it.

Solution: Add code to handle varying of the byte-count register

[End of TCO 5.1266]


TOPS20 Change Order Number 5.1267

Written by: WACHS		 2-Mar-81 07:17:13

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: TU FAULT A, TM FAULT A errors from the TM78 are thrown away

Diagnosis: We don't have an IORB to blame them on, so they get tossed

Solution: Give TM8AEI BUGINF (Asymchronous Error Interrupt) instead,
with data=the error code, instead

[End of TCO 5.1267]


TOPS20 Change Order Number 5.1268

Written by: MURPHY		 3-Mar-81 13:08:49

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC	PAGEM

Related TCO's:
Related SPR's: 


Problem: New OPENF mode needed by data base applications.
Need to be able to open file for read regardless of other
openings.

Diagnosis: Feature needed.

Solution: Add OF%RDU bit to OPENF to indicate "read unrestricted"
mode.  Only legal if OF%THW and OF%WR off.  Opens file for
read regardless of simultaneous thawed/unthawed/write access.
Logic primarily implemented in ASOFN.

[End of TCO 5.1268]


TOPS20 Change Order Number 5.1270

Written by: OSMAN		 5-Mar-81 15:49:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	getsav

Related TCO's:
Related SPR's: 


Problem: You can crash the system by saving a fork whose pages are fluctuating

Diagnosis: SSAVB9 does a SKIPE on the monitor's window into the user space
in order to see if the page is all 0 data.  If that page is nonexistent and
mapped to a read-only file, this SKIPE causes an ILMNRF.

Solution: Change SKIPE to a MOVE and put ERJMP after it, such that failure
causes SAVE to assume the page is nonexistent.

[End of TCO 5.1270]


TOPS20 Change Order Number 5.1271

Written by: ZIMA		11-Mar-81 11:12:18

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 	 15773


Problem: 
     ILMNRF BUGHLT resulting from use of SFTAD JSYS.  In addition, setting
a legal offline expiration period may be refused if no system period was
established in n-CONFIG.CMD.

Diagnosis: 
     Capabilities check uses incorrect AC, trashing pointer used a few
instructions later.  Expiration period code doesn't check.

Solution: 
     Use proper AC instead.  Correct expiration/recycle period code to use
default (.STDFE) if system-wide value has not been set.

[End of TCO 5.1271]


TOPS20 Change Order Number 5.1272

Written by: WACHS		16-Mar-81 04:36:08

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIAG

Related TCO's:
Related SPR's: 


Problem: If 2 jobs are trying to do DIAGs, 1 will block while
the other continually gets and returns the DIAG lock.

Diagnosis: If a job tries to get the DIAG lock and fails, it
tries again every 100 millisecs. The other job, though, keeps
returning the lock and immediately getting it again. The waiter
never looks when the lock is available

Solution: Add some code to indicate that a job is waiting. Block
(once) even if the lock is available, so the other job has a chance
at it.

[End of TCO 5.1272]


TOPS20 Change Order Number 5.1273

Written by: WACHS		16-Mar-81 04:41:57

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIAG

Related TCO's:
Related SPR's: 


Problem: Diagnostic Engineering wants to be able to look at the
channel list after it has been mapped by the monitor.

Diagnosis: 

Solution: Modify the get channel logout function to return the
mapped channel list (or whatever porion of it will fit into the
users argument block) if the wordcount supplied is greater than 4.

[End of TCO 5.1273]


TOPS20 Change Order Number 5.1277

Written by: GRANT		27-Mar-81 14:47:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: Don't need to link monitor module PHYM2 if you don't have TM02
	style tape drives.

Diagnosis: PHYM2 is always linked - no provision for excluding it.

Solution: Put LOADMODULE PHYM2 under a conditional on TM02F.
[End of TCO 5.1277]


TOPS20 Change Order Number 5.1279

Written by: GRANT		13-Apr-81 14:39:14

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPPAR	NSPSRV	STG

Related TCO's:
Related SPR's: 


Problem: DECSYSTEM-20 DECnet facilities need to be enhanced.

Diagnosis: Make TOPS-20 (on the KL) be able to use a DECnet Phase III
	DN20 so that the KL will appear to be a full Phase III node.

Solution: Add NSP message time out capability, a minimal subset of DECnet
	Phase III Network Management, and new mechanism for determining
	network topology.
[End of TCO 5.1279]


TOPS20 Change Order Number 5.1283

Written by: SCHMITT		15-Apr-81 16:02:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
TPBLKB Bugchks under version 4.  Read errors under version 5

Diagnosis: 
The routine ER.RDY does not handle the case where an EOF has been
read for a labeled tape while another IORB has already been queued
for the next buffer.  The routine does not want to block and so will
just pass up an error.  Under version 4 it would also generate a
TPBLKB bugchk

Solution: 
Kill the IORB for the read ahead buffer and continue label processing.

[End of TCO 5.1283]


TOPS20 Change Order Number 5.1284

Written by: SCHMITT		15-Apr-81 16:06:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MAGTAP

Related TCO's:
Related SPR's: 


Problem: 
MTANOQ BUGCHKs

Diagnosis: 
With TCO 5.1054 installed, setting the status of a tape unit will
mark the current buffer as done.  Any other operation which then
attempts to mark this buffer as done (such as set direction of read)
will generate an MTANOQ BUGCHK.

Solution: 
Instead of calling UPDSTA at MTSTS:, simply wait for all activity
to cease and then call UPDSTS.

[End of TCO 5.1284]


TOPS20 Change Order Number 5.1285

Written by: MOSER		16-Apr-81 16:48:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MSTR

Related TCO's:
Related SPR's: 


Problem: THE STATUS BITS FOR STRUCTURES ARE NOT SENT TO MOUNTR CORRECTLY
AND THE STATUS BITS FOR PS: DO NOT INCLUDE MS%DOM.

Diagnosis: THE BITS ARE GOTTEN BY A LOAD AND ARE PLACED IN THE WRONG
HALF OF THE AC BECAUSE OF THIS. BITS FOR PS: DO NOT INCLUDE MS%DOM.

Solution: USE A MOVE INSTEAD OF A LOAD AND ADD MS%DOM

[End of TCO 5.1285]


TOPS20 Change Order Number 5.1287

Written by: WACHS		17-Apr-81 09:34:58

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: Its is difficult for a program to determine why the system
was reloaded

Diagnosis: Operator is allowed to type in anything he wants in
answer to the why reload question

Solution: Allow only a specific set of responses to the question.
The possible answers are:OPR, PARITY, POWER, STATIC, HARDWARE, HALT,
HUNG, PM, CM, SA, NEW, SCHED, OTHER

[End of TCO 5.1287]


TOPS20 Change Order Number 5.1288

Written by: WACHS		17-Apr-81 09:45:22

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYSIO	MAGTAP	PHYM2	PHYM78	PHYX2	DSKALC

Related TCO's:
Related SPR's: 


Problem: SPEAR can't do as good a job as it should

Diagnosis: Not enough statistics gathered

Solution: Gather more statistics

[End of TCO 5.1288]


TOPS20 Change Order Number 5.1289

Written by: WACHS		21-Apr-81 06:34:37

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: BUGHLTS after a BUGCHK which occurs when a job has the DIAG lock

Diagnosis: DIAG resources aren't returned after a BUGCHK

Solution: Return them

[End of TCO 5.1289]


TOPS20 Change Order Number 5.1290

Written by: WACHS		21-Apr-81 06:37:03

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: Can't keep the DIAG resource as long as necessary for
some tests (micro diagnostics run by the controller itself)

Diagnosis: keep-alive counter isn't updated if a process is NOSKED

Solution: Keep the keep-alive counter going if thw NOSKED is due
to DIAG

[End of TCO 5.1290]


TOPS20 Change Order Number 5.1291

Written by: SCHMITT		21-Apr-81 13:06:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IPCF

Related TCO's:
Related SPR's: 	 15200


Problem: 
IPCF35 Errors when reading the IPCF PID quota (function .MUFPQ of the
MUTIL JSYS) and word two of the argument block contains trash.

Diagnosis: 
The routine MUTFPQ checks this word for validity.  When returning
the PID quota, there is no need to check this word for validity.

Solution: 
Break apart the routines MUTSPQ and MUTFPQ so that specific argument
validation can occur and don't check the second word in the argument
block for the .MUFPQ function.

[End of TCO 5.1291]


TOPS20 Change Order Number 5.1292

Written by: SCHMITT		21-Apr-81 13:45:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYX2	PHYM2

Related TCO's:
Related SPR's: 	 14953


Problem: 
OVRDTA and TM2UNA BUGCHKs when reading from or writing to
magnetic tapes and unit is in error recovery.

Diagnosis: 
When the device code retries operations on the units, it does
not reset the overdue timer.  It should.

Solution: 
In the routines NOTCKP in both PHYX2 and PHYM2, call SETIO before
starting the I/O on the channel.

[End of TCO 5.1292]


TOPS20 Change Order Number 5.1293

Written by: PAETZOLD		21-Apr-81 15:40:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: TEXTI% jsys does NOT break on CR (carraige return) when it is specified
in the 4 word break mask.

Diagnosis: In routine RDCR checks are made for breaks for CR, CRLF, End of line
etc...  The code at RDCR2 forces an LF (line-feed) into B.  When INSRT checks 
for the break condition the CR is not there anymore.

Solution: Fix the broken code by handling breaks on CR before checking for
breaks on LF and EOL.

[End of TCO 5.1293]


TOPS20 Change Order Number 5.1296

Written by: SCHMITT		22-Apr-81 10:58:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	CFORK

Related TCO's:
Related SPR's: 	 15415


Problem: 
Using CR%ACS of the CFORK JSYS does not set the process as NON-VIRGIN

Diagnosis: 
Oversight.

Solution: 
Before copying the ACs to the processes PSB, call CLRVGN for the process.

[End of TCO 5.1296]


TOPS20 Change Order Number 5.1298

Written by: MURPHY		24-Apr-81 16:39:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:	5.1390
Related SPR's: 


Problem: KPALV BUGHLT

Diagnosis: User creates loop of indirect pointers with fork-to-fork
PMAPs; monitor loops while NOSKED trying to trace pointers.

Solution: Count indirect pointers, return error if more than 100
indirects.

[End of TCO 5.1298]


TOPS20 Change Order Number 5.1300

Written by: SCHMITT		27-Apr-81 17:14:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IO

Related TCO's:
Related SPR's: 	 15285


Problem: 
Jobs will hang in non-interruptable loops if an infinite
indirect pointer is given as the source designator to the SOUT JSYS.

Diagnosis: 
The first ILDB is done NOINT.

Solution: 
Attempt to get a byte from the pointer supplied to the SOUT JSYS
before going NOINT.  If the pointer is an infinite indirect,
the user will be able to interrupt it then.

[End of TCO 5.1300]


TOPS20 Change Order Number 5.1301

Written by: PAETZOLD		 1-May-81 11:07:36

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC	STG	GLOB

Related TCO's:
Related SPR's: 


Problem: There is no efficient way to track compiler usage under TOPS-20.

Diagnosis: There was never any previous need for this.

Solution: Create a table called SCOUNT parallel to SNAMES to keep track of 
the number of times a subsystem is used.  Also create a GETOK% function to
be executed by compilers to collect data for later analysis.

[End of TCO 5.1301]


TOPS20 Change Order Number 5.1304

Written by: SCHMITT		 4-May-81 10:37:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:
Related SPR's: 


Problem: 
With directories over 400000(8) words in length, recognition
of subdirectories breaks.

Diagnosis: 
The byte pointer which the MONITOR builds for copying the
tail of the directory name to the JFN block looks like 
POINT 7,4xxxxx(D) where D is 2,,0.  The Y field will be sign
extended so the result is a pointer whith a negative Y field.

Solution: 
Build the pointer like POINT 7,0(D) where D is 2,,4xxxxx.

[End of TCO 5.1304]


TOPS20 Change Order Number 5.1305

Written by: SCHMITT		 4-May-81 12:25:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 	 16108


Problem: 
Tape label read errors generated from 
DUMPER>REW
DUMPER>SAVE FOO.BAR
DUMPER>REW
DUMPER>SAVE FOO.BAR
DUMPRE>...(About 4 or 5 times)

Diagnosis: 
TU45 Hardware deficiency.  The TU45s creep backwards.  Product
support says they cannot fix it.
While rewritting the HDR1 label, TOPS-20 will backspace records until
tape is positioned immediately before the HDR1 lable, then TOPS-20 rewrites
the HDR1 label.  TU45s do not like to backspace records and rewrite
that record.  Each time it backspaces over the record, it backspaces
slightly into the IRG until it eventually begins to write over the previous
record.  This will cause tape label read errors.

Solution: 
Backspace one extra record at REPOS1, then forward space one record so
that then the tape is positioned before the HDR1 label.  In this
case there is no TU45 creep.

[End of TCO 5.1305]


TOPS20 Change Order Number 5.1308

Written by: SCHMITT		 5-May-81 15:19:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: 
No way of knowing if the system is shut down.

Diagnosis: 
HSYST1 (DWNTIM GETTAB entry) is reset to zero after shutdown timer
expires.  This signifies no shutdown pending when actually what we
would like is system is currently shutdown

Solution: 
Latch HSYST1 to -1 when the system is shutdown.  This can be reset
by a ^ECEASE with a null argument.

[End of TCO 5.1308]


TOPS20 Change Order Number 5.1311

Written by: MOSER		 5-May-81 16:50:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: Help for COMND does not function as documented. When parsing
a keyword or switch and nothing can match the users settings of CM%SDH and
CM%HPP are ignored.

Diagnosis: This is treated as special and the users bits are not examined.

Solution: Make COMND consistent.

[End of TCO 5.1311]


TOPS20 Change Order Number 5.1312

Written by: WACHS		 6-May-81 03:59:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIAG

Related TCO's:
Related SPR's: 


Problem: RH2PIL BUGCHKS

Diagnosis: If the clock ticks, the scheduler decides to reschedule,
and PHYSIO decides to do its once-a-second checking during a 15
instruction race window in DIAG release channel, we get the
BUGCHK

Solution: Dont clear maintenance bit from the CDB until after
the NOSKED

[End of TCO 5.1312]


TOPS20 Change Order Number 5.1314

Written by: PAETZOLD		 6-May-81 14:38:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: ARPANET monitors crash will all kinds of wondrous bughlts such as
ilmmrf etc...

Diagnosis: NVTDET routine was changed to destroy the return address (on stack)
for calls from the TDCALL macro.

Solution: Create a new entry point to NVTDET called NVTDTT which will not 
destroy the return address.

[End of TCO 5.1314]


TOPS20 Change Order Number 5.1318

Written by: PAETZOLD		 7-May-81 15:10:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	APRSRV	SERCOD	BUGS

Related TCO's:
Related SPR's: 


Problem: EBOX may make MBOX requests for words relative to the EPT or UPT.  If
a parity error occurs on the above references the error is not handled 
correctly.

Diagnosis: Page fail word does not tell us what kind of reference it was 
making.

Solution: 

Treat parity error traps in page zero as a special case.  If 
the parity trap occurs for a address in page zero then return 
the following data in the syserr block (event code 160 processor
parity trap)

Offset	Symbol Description

10	PT%UPA	UPT offset physical address
11	PT%UPD	UPT offset data word
12	PT%EPA	EPT offset physical address
13	PT%EPD	EPT offset data word

If the 4 data words are zero then the parity error trap did not 
occur in page zero.  If a second parity error occurs when referencing
the EPT and UPT offsets then a EPTMPE or UPTMPE BUGHLT occurs.
EPTMPE and UPTMPE BUGHLT's return the following additional data:

	1.  The page fail word (of this reference)
	2.  Physical address of this failure
	3.  The bad data word (from AC block 7)


[End of TCO 5.1318]


TOPS20 Change Order Number 5.1319

Written by: SCHMITT		 8-May-81 10:16:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DSKALC

Related TCO's:
Related SPR's: 


Problem: 
BAT blocks in the swapping wrea are not marked
correctly in the drum bit table for the structure if the
drive type has lost sectors in its cylinders (RM03)

Diagnosis: 
The code simply doesn't take lost sectors into account.

Solution: 
Rewrite the algorithm which calculates the drum address
for a physical sector address for the disk.
This involves taking into account the physical to logical
sector translation and the interleaving of swapping sectors
over all packs in the structure.

[End of TCO 5.1319]


TOPS20 Change Order Number 5.1320

Written by: MOSER		11-May-81 13:31:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MSTR

Related TCO's:
Related SPR's: 


Problem: MSTR can crash the system if a bad job number is specified in
the argument block.

Diagnosis: MSTJOB does not check for a legal job number before calling
MAPJSB.

Solution: Check for legal job number if it is illegal return an error.

[End of TCO 5.1320]


TOPS20 Change Order Number 5.1321

Written by: PAETZOLD		11-May-81 14:51:46

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NETWRK	IMPDV	bugs	imppar

Related TCO's:
Related SPR's: 


Problem: ARPANET code does not work in release 5.  IMPBSC's result
whenever messages are sent.

Diagnosis: RTS messages set the link field to zero. This causes all 
data messages to be sent to link zero.  link zero is the control link.
It is assumed that control link messages have a byte size of 8.  The
byte size is not eight and an IMPBSC results.

Solution: Symbol FLINK was redefined in PROLOG.  Our value was the
first usable NCP data message link (2).  The new def. was zero.
Change our FLINK symbol to FNLINK.  Also field LINKF was defined to
be 1B0.  This causes the FSM state to go to 17 when a connection goes
to the open state.  (17 is undefined.)  Also add IMPBLK BUGCHK to detect
RTS messages with zero in the link field.  

[End of TCO 5.1321]


TOPS20 Change Order Number 5.1322

Written by: ZIMA		11-May-81 19:33:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IPCF

Related TCO's:
Related SPR's: 	 15937


Problem: PIDFLF BUGCHKs.

Diagnosis: 
     If a monitor is built with MAXPID odd instead of even, the PID
free list is initialized improperly.  The initialization code is
hard-wired for an even number.

Solution: 
     Replace the code that tries to terminate the free list with a
zero by code that handles both even and odd cases.

[End of TCO 5.1322]


TOPS20 Change Order Number 5.1323

Written by: ZIMA		12-May-81 23:21:25

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 15604


Problem: 
     CRDIR JSYS will create a MAIL.TXT file in a non-files-only directory
if one does not exist.

Diagnosis: 
     This should not occur except on directory creation; the mail file
attributes should be preserved, including existence.

Solution: 
     Correct the code to only create MAIL.TXT on initial directory creation.

[End of TCO 5.1323]


TOPS20 Change Order Number 5.1324

Written by: ZIMA		13-May-81 00:01:27

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYP4

Related TCO's:
Related SPR's: 	 16039


Problem: 
     None observed, but possibility of disk error suggested.

Diagnosis: 
     Small but finite possiblity of the ECC code used in the RP04/RP06/RM03
type disks miscorrecting an error burst.

Solution: 
     Increase the number of retries before ECC will be applied from three
to eight according to recommendation from Disk Engineering.

     Note that this discussion is not appropriate to the RP20 disks which
employ a different error correcting polynomial.

[End of TCO 5.1324]


TOPS20 Change Order Number 5.1325

Written by: SCHMITT		13-May-81 12:05:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 	 16158


Problem: 
After a DUMPI to a labeled tape, GTSTS returns zero bytes transfered.

Diagnosis: 
TAPE GTSTS routine does not check for file opened in dump mode.  If it
had, it would know that the bytes transferred information should be
obtained from MAGTAP

Solution: 
Make MTGSX0 smarter to check for dump mode tape and if so, trust
bytes transferred from MAGTAP

[End of TCO 5.1325]


TOPS20 Change Order Number 5.1326

Written by: DONAHUE		14-May-81 13:47:56

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MAGTAP

Related TCO's:
Related SPR's: 


Problem: Various intermittant errors when reading dump-mode tape.
The problem will most likely occur on 256K systems with a heavy
swapping load.

Diagnosis: MTDIR5 sets the modify bit in CST0 for all the buffer
pages when reading from tape. The pages are then locked and the
iorb is queued. If the pages are swapped out before being locked,
the modify bit can be reset, and future swaps of the page will
think that the drum copy is valid, possibly clobberring the real
data that got read in from the tape.
	At MTDIR1, the code to set the modify bit after locking
the pages was commented out.

Solution: Set the modify bit after locking the page.

[End of TCO 5.1326]


TOPS20 Change Order Number 5.1327

Written by: ZIMA		14-May-81 23:12:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:
Related SPR's: 	 15280


Problem: 
     If a call to GTJFN specifies GJ%FOU and the exact generation number,
sometimes error GJFX20 is improperly returned.

Diagnosis: 
     The test is incorrect concerning the case of invisible files.

Solution: 
     Correct the code to properly find this file generation and return
successfully.

[End of TCO 5.1327]


TOPS20 Change Order Number 5.1328

Written by: ZIMA		14-May-81 23:15:18

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 	 15793


Problem: 
     Lower case characters on EBCDIC tapes are converted to upper case
on input.

Diagnosis: 
     The translation table is wrong.

Solution: 
     Correct the translation table to produce the proper code values.

[End of TCO 5.1328]


TOPS20 Change Order Number 5.1329

Written by: ZIMA		14-May-81 23:48:39

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 16067


Problem: 
     GTSTS JSYS returns inconsistent results.

Diagnosis: 
     Code follows different paths for the JFN being currently available or
not.  One path fails to mask out the undocumented internal bits before
returning the file status word to the user.

Solution: 
     Redo the code to always return the proper result.

[End of TCO 5.1329]


TOPS20 Change Order Number 5.1330

Written by: ZIMA		14-May-81 23:51:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
     Certain MTOPRs to labeled tapes, notably .MOSTA and .MOOFL do not
work unless the JFN is open, contrary to documentation.

Diagnosis: 
     MTOPR dispatch table for labeled tapes is wrong.

Solution: 
     Correct the table.

[End of TCO 5.1330]


TOPS20 Change Order Number 5.1331

Written by: WACHS		19-May-81 03:41:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: NOIORB BUGHLT

Diagnosis: MORE PROBLEMS WITH INTERACTION OF THE DIAGNOSTIC

Solution: MORE CHECKING

[End of TCO 5.1331]


TOPS20 Change Order Number 5.1333

Written by: PAETZOLD		19-May-81 12:42:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	GLOB

Related TCO's:
Related SPR's: 


Problem: OWGBP microcode needs a table in the EPT to translate P fields
greater than 44 to P and S fields of other styles of byte pointer.

Diagnosis: OWGBP ucode is new.

Solution: define space for the OWGBP table in EPT locations 700-722.
The words will get blt'ed from the OWGBPV table into the EPT at startup
time.

[End of TCO 5.1333]


TOPS20 Change Order Number 5.1335

Written by: PAETZOLD		19-May-81 16:08:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	BUGS

Related TCO's:
Related SPR's: 


Problem: It is possible to OKSKED when not NOSKED.  This can cause
problems in sensitive routines.  It also makes debugging difficult.

Diagnosis: No code to detect this.

Solution: Create a new BUGCHK call OKSKBG when OKSKED or OKSKD1 are
called when not NOSKED


[End of TCO 5.1335]


TOPS20 Change Order Number 5.1336

Written by: WACHS		20-May-81 06:17:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: TU78 error reporting (SPEAR) not quite right

Diagnosis: missing bit in a table

Solution: add it

[End of TCO 5.1336]


TOPS20 Change Order Number 5.1337

Written by: PAETZOLD		20-May-81 12:07:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTNTDV

Related TCO's:
Related SPR's: 


Problem: NSKDIS BUGHLT'S WHEN CLEARING OUTPUT BUFFER OF ARPANET NVT

Diagnosis: NVTCOB DOES OKSKED.  IS DOESNT HAVE TO SINCE THE CALLER OF
NVTCOB NOW DOES AN OKSKD1.

Solution: REMOVE THE OKSKED FROM NVTCOB

[End of TCO 5.1337]


TOPS20 Change Order Number 5.1338

Written by: LEACHE		21-May-81 08:47:24

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILINI	SYSERR

Related TCO's:
Related SPR's: 


Problem: SYSERR sometimes damages system directory.

Diagnosis: 

Solution: Create directory specifically for SYSERR's use: <SYSTEM-ERROR>.
Change FILINI to create this directory during structure initialization.
Change SYSERR to open <SYSTEM-ERROR>ERROR.SYS.

[End of TCO 5.1338]


TOPS20 Change Order Number 5.1339

Written by: SCHMITT		21-May-81 10:53:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 	 15925


Problem: 
When an operator issues the OPR command 'SET SCHEDULER
BATCH-CLASS BACKGROUND (or NONE), the currently active batch
jobs are not affected.

Diagnosis: 
The .SKBBG function of teh SKED% JSYS does not set the 
priority of currently active batch jobs.

Solution: 
Loop over all PTYs looking for batch jobs.  Then change the
priority of the batch jobs to reflect the state of the
background flag.

[End of TCO 5.1339]


TOPS20 Change Order Number 5.1340

Written by: SCHMITT		21-May-81 10:55:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 16616


Problem: 
The CRDIR% JSYS may leave the job with a JFN on a directory
file.

Diagnosis: 
If the directory file is open, the call to CHKOFN at
DELDI6+20 will fail.  The error return neglects to release
the JFN on the directory.

Solution: 
Instead of returning, jump to DELDI3, which releases the JFN
and returns an error.

[End of TCO 5.1340]


TOPS20 Change Order Number 5.1341

Written by: SCHMITT		21-May-81 17:19:55

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IPCF

Related TCO's:
Related SPR's: 	 14368


Problem: 
IPCSOD BUGCHKs

Diagnosis: 
There is a race in IPCF that when a job is getting
initialized, its senders count is reset while the IPCF data
base is unlocked.  This leaves about a 10 line window where
if another job recieves a message sent previously by a job
with the same number as the one which is getting
initialized, the senders count will be over decremented and
an IPCSOD BUGCHK will be generated.

Solution: 
Lock up the data base early in the PIDJBI routine.

[End of TCO 5.1341]


TOPS20 Change Order Number 5.1342

Written by: ZIMA		21-May-81 22:43:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 	 15758


Problem: 
     If a user refusing links is already linked to the maximum number of
lines, another link request will still ring the bell and wait.

Diagnosis: 
     Code does not check for this case before entering the ring and wait
routine.

Solution: 
     Add code to handle this case by returning TLNKX3 immediately.

[End of TCO 5.1342]


TOPS20 Change Order Number 5.1344

Written by: ZIMA		22-May-81 16:25:50

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 	 15931


Problem: 
     Various, including GALAXY component confusion and crash; access to
invalid scheduler classes, etc.

Diagnosis: 
     User attaches to a job controlled by the batch processor at an inopportune
moment.  In actuality, this should have been illegal unless the user had
WHEEL or OPERATOR privileges enabled.

Solution: 
     Correct DTACH and ATACH JSYSes to prevent batch jobs from detaching,
unless enabled, and from attaching to a batch job unless logged-in and enabled,
as it is supposed to be.

[End of TCO 5.1344]


TOPS20 Change Order Number 5.1345

Written by: ZIMA		24-May-81 15:08:26

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	LINEPR

Related TCO's:	5.1346
Related SPR's: 


Problem: 
     MTOPR function .MOSTS to set a printer losercase does not work.

Diagnosis: 
     Code ignores the case entirely.  In addition, the code does not
allow the clearing of MO%LCP status bit for a printer by either the
MTOPR or by the LPINI JSYS.

Solution: 
     Add code necessary to make the MTOPR work, and allow MO%LCP to
be cleared by the MTOPR and LPINI JSYSes.  Note: SETSPD then needs to
be changed to latch a lowercase setting for a printer when encountered
in the configuration file.

[End of TCO 5.1345]


TOPS20 Change Order Number 5.1347

Written by: ZIMA		24-May-81 17:07:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MAGTAP

Related TCO's:
Related SPR's: 	 15963


Problem: 
     Automatic volume switch at end of reel does not occur when writing a
labeled tape in dump mode.

Diagnosis: 
     Code does not set ERRF flag on end-of-tape encountered before returning
to caller.  Labeled tape code want it set to key volume change tests.

Solution: 
     Set the flag, analogous to the non-dump mode case.

[End of TCO 5.1347]


TOPS20 Change Order Number 5.1348

Written by: ZIMA		25-May-81 11:19:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA	JSYSF	TTYSRV

Related TCO's:
Related SPR's: 	 15579


Problem: 
     Certain JSYSes which are defined to be no-ops unles directed at a
terminal do not handle this correctly.  In addition, some JSYSes, in
handling error conditions, do not return the error in LSTERR.  The affected
JSYSes are CFIBF, CFOBF, SFCOC, SFMOD, SFPOS, SIBE, SOBE, and STPAR.

Diagnosis: 
     Code to reject non-terminals is wrong; code doesn't bother to set
LSTERR in certain circumstances.

Solution: 
     Correct code to perform as documented.

[End of TCO 5.1348]


TOPS20 Change Order Number 5.1349

Written by: PAETZOLD		27-May-81 08:35:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: ^C, ^O, ^Q do not work over ARPANET NVT's

Diagnosis: SYNCH not getting sent correctly.  INS gets sent but DM does not.

Solution: change CFEOB to not call NVTCOB.  add a TDCALL to NVTCOB for nvt's
after output buffers aree cleared.

[End of TCO 5.1349]


TOPS20 Change Order Number 5.1353

Written by: SCHMITT		28-May-81 12:01:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 	 16174


Problem: 
GNJFN broken if there is a higher deleted generation of a 
file in the file specification.

Diagnosis: 
The IGDLF flag is set before the call to VERLUK.

Solution: 
Only set this flag if looking for deleted files.

[End of TCO 5.1353]


TOPS20 Change Order Number 5.1354

Written by: PAETZOLD		29-May-81 10:06:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IMPDV

Related TCO's:
Related SPR's: 


Problem: 

ARPANET status messages to console are confusing.  We support more networks
than ARPANET.


Diagnosis: 


Solution: 

Change the messages at CHKN5 to ARPANET from Network


[End of TCO 5.1354]


TOPS20 Change Order Number 5.1356

Written by: CHALL		 1-Jun-81 10:31:11

Edit checked: YES			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF	DISC

Related TCO's:	5.1355
Related SPR's: 


Problem: NEED TO MAKE SOME FILES UNEDITABLE AND UNDELETABLE (LIKE FRONT-END
FILES).

Diagnosis: 

Solution: DEFINE BIT FB%NDL IN THE FILE DATA BLOCK, WHICH MARKS THE FILE
AS UN-THE-ABOVE; FB%NDL NEEDS WHEEL/OPR TO SET OR CLEAR.

IN DISC.MAC, CHANGE CODE AT DSKDEL: TO GIVE AN ERROR IF THE USER TRIES TO
DELETE A FILE WHICH HAS FB%NDL SET. ALSO, AT DSKDV:, DON'T DELETE A FB%NDL
FILE WHICH HAS BEEN OVERWRITTEN BY A RENAME OR WRITE.

[End of TCO 5.1356]


TOPS20 Change Order Number 5.1357

Written by: SCHMITT		 1-Jun-81 14:38:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 	 15623


Problem: 
If a bare CRLF is input as a command line to the COMND JSYS,
and ifthe following input can be parsed by the first 
function in the chain, this function will be the one which parses
regardless of whether there are better functions in the chain.

Diagnosis: 
After resetting the buffers for the input and retyping the
prompt on a bare CRLF, COMND remains on pass2.  This means it
will not attempt to find the best function to parse,
rather it will parse the first successful function.

Solution: 
Jump back to XCOMB0 to reset PASS1 rather than XCOMN0 in
CHKDEF.

[End of TCO 5.1357]


TOPS20 Change Order Number 5.1360

Written by: SCHMITT		 8-Jun-81 09:43:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 	 14016


Problem: 
If a .CMCMA function is terminated by an escape, the fields
following the comma will not parse correctly.  If a noise
word follows, it will not be printed and COMND will act as
if the escape was typed for the first non noise word function
following the comma.

Diagnosis: 
The comma parsing routine does not check the character
following the ',' for an escape.  Therefore, it remains in
the buffer, the CM%ESC flag is not set and the following
functions will see the escape.

Solution: 
Read the next character after the comma is parsed.  If it is
an escape, delete it from the buffer (the CM%ESC flag was set upon
reading it).  If it is not an escape, put it back in the buffer.

[End of TCO 5.1360]


TOPS20 Change Order Number 5.1361

Written by: SCHMITT		 8-Jun-81 11:51:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 	 15402


Problem: 
Unparsed characters from default string cause parsing of
following function to generate errors.

Diagnosis: 
When an escape is typed, the entire default string is copied
into the command buffer, even if the string contained a break
character.  When this string is parsed, the break
character terminates the input for the function yet, the
rest of the default string is still in the command buffer.
This will cause the next funtion to return an error.

Solution: 
Check the default string when copying the string into the
command buffer.  If a break character is encountered
generate a COMX10 error.

[End of TCO 5.1361]


TOPS20 Change Order Number 5.1362

Written by: CHALL		 8-Jun-81 13:34:14

Edit checked: YES			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: PEOPLE CAN BE LOGGED OUT WITHOUT KNOWING WHY OR WHODUNIT.

Diagnosis: LOGOUT LEAVES NO TRACE. DEAD PROCESSES TELL NO TALES.

Solution: IF A JOB IS LOGGED OUT BY ANOTHER JOB OUTPUT A MESSAGE OF THE
FORM "KILLED BY MANSON AT TTY13"

[End of TCO 5.1362]


TOPS20 Change Order Number 5.1363

Written by: SCHMITT		 8-Jun-81 15:11:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: 
Cannot read variable length records on EBCDIC labled tapes.
When reading in a record, the program will get the physical record
minus the BDW rather than just the logical record minus both the BDWs
and the RCWs

Diagnosis: 
The MONITOR does not make the check correctly for a new physical
record just read in, so it never does any BDW processing.
It assumes the RCW to the record is the BDW and thus will return a record
the size of a physical block.

Solution: 
Correct the check.

[End of TCO 5.1363]


TOPS20 Change Order Number 5.1364

Written by: PAETZOLD		 9-Jun-81 11:01:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem:      

Diagnosis:       

Solution:     
[End of TCO 5.1364]


TOPS20 Change Order Number 5.1365

Written by: PAETZOLD		 9-Jun-81 12:03:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SYSERR

Related TCO's:
Related SPR's: 


Problem: 

Front end sends data over for syserr.  Some packets never make it to
syserr.

Diagnosis: 

SYSERR fork not emptying syserr buffers fast enough.


Solution: 

Many solutions are possible.  Have the SYSERR fork do an SPRIW% on behalf
of itself.  SYSERR fork will run in scheduler queue zero.


[End of TCO 5.1365]


TOPS20 Change Order Number 5.1366

Written by: DONAHUE		10-Jun-81 09:24:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 	 16113


Problem: 
When parsing a noise word and a carriage return is entered after at least
one field was defaulted, COMND will reissue the prompt rather than
perform the default action.

Diagnosis: 
Routine NLINE forgets to check if we are parsing a noise word.

Solution: 
Check if parsing a noise word at NLINE, and if so, continue with command.

[End of TCO 5.1366]


TOPS20 Change Order Number 5.1367

Written by: SCHMITT		10-Jun-81 09:47:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 	 16305


Problem: 
The tape data mode is reset to job default when a rewind  is
done.

Diagnosis: 
When a rewind is performed, the tape is logically closed,
and remains closed even after the rewind funtion is complete.

When the next I/O operation is requested, the tape is
reopened.  At this time, the data mode is reset to the job
default.

Solution: 
After this open, the data mode should be set to the
previously requested mode.  This requires a new storage
location in the labeled tape storage area which holds the
prevailing tape data mode.  When the tape is opened, this
mode should be reset to system default.  When the data mode
is set, this location should reflect the change and all
future logical opens should set the data mode to the 
prevailing mode.

[End of TCO 5.1367]


TOPS20 Change Order Number 5.1369

Written by: MOSER		12-Jun-81 12:15:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MSTR

Related TCO's:
Related SPR's: 


Problem: WHEN A STRUCTURE IS MOUNTED WITH MS%XCL SET ONLY THE MOUNTING FORK
CAN USE THAT STRUCTURE INSTEAD OF THE MOUNTING JOB.

Diagnosis: MSTR DOES NOT ASSIGN THE STRUCTURE TO THE JOB BUT INSTEAD
ACTS AS IF THE STRUCTURE IS BEING INITIALIZED BY THE MOUNTING FORK.

Solution: ASSIGN THE STRUCTURE TO THE JOB AND CLEAR THE INITIALIZE BIT AND
FORK NUMBER.

[End of TCO 5.1369]


TOPS20 Change Order Number 5.1371

Written by: GRANT		17-Jun-81 09:32:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: Entire DECnet network can deadlock.

Diagnosis: TOPS-20 NSP can get into a deadly embrace over resident free
	space.

Solution: When DECnet's pool of resident free space is low, don't allow
	1) any more links to be created
	2) any more users to send outgoing messages
	3) any more in coming messages from the DTE

	The background task continue to run uninhibited.

[End of TCO 5.1371]


TOPS20 Change Order Number 5.1372

Written by: ZIMA		17-Jun-81 20:34:06

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM2

Related TCO's:
Related SPR's: 	 15801


Problem: 
     MTA error retry count is wrong.

Diagnosis: 
     For the case of a recovered error, the code winds up at ABTNOS
before it accounts for the retry.  The retry failed cases account
for the trial.

Solution: 
     Count up the retry at the retry succeeded case in RTYNOE.

[End of TCO 5.1372]


TOPS20 Change Order Number 5.1373

Written by: OSMAN		18-Jun-81 10:13:04

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR

Related TCO's:
Related SPR's: 


Problem: see 6.1018

Diagnosis: 

Solution: 
[End of TCO 5.1373]


TOPS20 Change Order Number 5.1375

Written by: GRANT		19-Jun-81 10:16:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: The ATACH JSYS allows you to attach a job to a TTY which already
	has a job attached to it.  Also, it allows you to attach a job
	to TTY0.

Diagnosis: No checking done to prevent either case.

Solution: Add the necessary checking code and create 2 new error codes.
[End of TCO 5.1375]


TOPS20 Change Order Number 5.1376

Written by: MURPHY		22-Jun-81 14:44:02

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	MEXEC

Related TCO's:
Related SPR's: 


Problem: Hung jobs.  Job hung and using CPU time, and cannot be
logged out privileged logout.

Diagnosis: Logout and carrier off requests handled through PSI
handler.  PC flags not properly set when doing debreak, so
sometimes breaks to user mode.  Also, itrap during logout
tends to produce infinite loop.

Solution: Setup flags properly.  Detect itrap during logout
sequence and return instead of generating interrupt.

[End of TCO 5.1376]


TOPS20 Change Order Number 5.1380

Written by: PAETZOLD		23-Jun-81 17:37:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SYSERR	FREE	STG

Related TCO's:
Related SPR's: 


Problem: 

Error packets from front end are lost.  


Diagnosis: 

SYSERR buffer facility runs out of room as SYSERR fork does not write the 
buffers to error.sys fast enough.  Placing SYSERR fork in queue zero helps
but does not solve the problem.


Solution: 

Change SYSERR code to use .RESGP resident free space pool for SYSERR blocks.
Rework ALCSEB to use FREE routines.  Remove RELSEB calls.  Remove SEBBFR
and several other data cells.  Add new and remove deleted global symbols
from GLOBS.  Remove references to .RESEP and .RESQP as they have never been
used before and we are not using them now.  Move UFPGS in SEBCHK to the
CLOSF call.


[End of TCO 5.1380]


TOPS20 Change Order Number 5.1381

Written by: ZIMA		23-Jun-81 18:53:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MFLOUT

Related TCO's:
Related SPR's: 	 16387


Problem: 
     GETER JSYS returns wrong value after floating point output error.

Diagnosis: 
     FLOUT and DFOUT error cases fail to store error properly; monitor's
AC1 is saved instead.

Solution: 
     Correct code to save the proper error code in LSTERR.

[End of TCO 5.1381]


TOPS20 Change Order Number 5.1383

Written by: LEACHE		24-Jun-81 11:57:35

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MONSYM

Related TCO's:
Related SPR's: 


Problem: 2 separate conditions can produce a DESX7 error.

Diagnosis: Monitor does not differentiate between wild-carding and a parse-
only JFN.

Solution: Change DESX7 to reflect both conditions.

[End of TCO 5.1383]


TOPS20 Change Order Number 5.1384

Written by: MURPHY		24-Jun-81 18:06:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: It is possible to write a file to which only read access
is permitted.  This is done by mapping a section of the file
into a fork section, and then mapping a page of another
fork section to the former section.

Diagnosis: The fork-fork PMAP case assumes all access is permitted
(for historical reasons) and so does not limit access according
to the actual section pointer.

Solution: Cause CPMAPX, etc. to use the access bits returned
by FKHPTN.

[End of TCO 5.1384]


TOPS20 Change Order Number 5.1385

Written by: GRANT		25-Jun-81 07:18:08

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: Very hard to detect when NSP receives and throws away a
	garbled message.

Diagnosis: The completion of all message processing goes to the same place
	in the code.

Solution: Create a new entry point (and BUGINF) for message which were not
	readable.
[End of TCO 5.1385]


TOPS20 Change Order Number 5.1390

Written by: MURPHY		29-Jun-81 17:31:50

Edit checked: YES			   Document: YES
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV	NSPSRV	FILMSC

Related TCO's:	5.1298
Related SPR's: 


Problem: Support Network Virtual Terminals.

Diagnosis: Implementation needed.

Solution: See PS:<DOC-SPECS>NVTNOT.MEM.

[End of TCO 5.1390]


TOPS20 Change Order Number 5.1392

Written by: PAETZOLD		 2-Jul-81 11:32:37

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IMPDV	TTYSRV	globs

Related TCO's:
Related SPR's: 


Problem: 

TTMSG's to ARPANET NVT's do not always work.


Diagnosis: 

Output to ARPA NVT's only happens during tty output scan by NCP fork.
TTSOBE does not see output from TTMSG and NETTCS never gets called.


Solution: 

Insert a test for TT%SAL for the line in IMPTS code.


[End of TCO 5.1392]


TOPS20 Change Order Number 5.1393

Written by: PAETZOLD		 2-Jul-81 13:31:25

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: 

BUGINT symbol gets truncated in MEXEC.


Diagnosis: 

The symbol value is greater than 2**18-1 and is used in an immediate
instruction.


Solution: 

Change the ADDI at CHKBGS+4 to an ADD


[End of TCO 5.1393]


TOPS20 Change Order Number 5.1394

Written by: GRANT		 6-Jul-81 14:13:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: Incorrect error returned when a DECnet process is currently busy
	can can't accept an incoming connecion.

Diagnosis: CI message processing masks the real error.

Solution: If OBJSRC fails don't overwrite the error it returns.
[End of TCO 5.1394]


TOPS20 Change Order Number 5.1395

Written by: WACHS		 7-Jul-81 10:50:06

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	phym78

Related TCO's:
Related SPR's: 


Problem: SPEAR gets the wrong "last operation to the controller"
when analyzing TM78 errors

Diagnosis: Read extended status saves that function in the CDB

Solution: save, restore CDBICR when reading extended status

[End of TCO 5.1395]


TOPS20 Change Order Number 5.1396

Written by: MURPHY		 7-Jul-81 10:55:14

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	MONSYM

Related TCO's:
Related SPR's: 


Problem: With the class scheduler in operation (and under very heavy loads
even without class scheduling), the various system programs running
under SYSJOB or PTYCON may get insufficient time to perform their
functions.  Since ordinary jobs may depend on these services in
order to proceed, failure of these jobs to run can subvert the
class allocations. 

Diagnosis: Systems jobs may fail to run due to insufficient class
allocation even though performing services for job with large
allocations.

Solution: Define bit in job priority (SJPRI%) to declare system
job.  Scheduler will give priority to such forks ahead of
all ordinary class jobs.  We assume that these forks should
be given all the time they need; hence certain computation-intensive
services like FAL should not be given this priority.

[End of TCO 5.1396]


TOPS20 Change Order Number 5.1397

Written by: WACHS		 7-Jul-81 11:01:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SYSERR

Related TCO's:
Related SPR's: 


Problem: SPEAR can't distinguish between rel 4 and rel 5 entries, and
some tape info changed meanings between the 2 releases

Diagnosis: yes

Solution: define a header version in the syserr block. Make itt
1 for rel 5

[End of TCO 5.1397]


TOPS20 Change Order Number 5.1398

Written by: MURPHY		 7-Jul-81 11:02:25

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	PAGEM	MONSYM	DSKALC

Related TCO's:
Related SPR's: 


Problem: Poor handling of "over quota", "disk full", and "swapping
full" conditions.

1. User programs bomb out when swapping becomes full.  This is usually
a transitory condition.  In any event, it is a condition which
occurs independently of the activities of most programs, and one
which the programs cannot predict or prevent.

2. The indications for "disk full" and "quota exceeded" are
indistinguishable.  Users may be confused about why their
program bombed out.  Programs cannot take useful corrective
action.

3. "Disk full" is a condition which may be transitory.  Program
failure should be avoided if possible.

Diagnosis: 

Solution: 
1. Cause fork to wait if swapping space is insufficient
to handle page fault.  Give advisory message on terminal.
However, if "machine size exceeded" PSI is active, generate
interrupt as before.

2. Return distinct error codes for various cases:
    IOX11 - 'quota exceeded' (formerly 'quota exceeded or disk full');
    IOX34 - 'disk full'
    IOX35 - 'unable to allocate disk - structure damaged'

3. Wait on 'disk full' condition unless 'machine size exceeded' PSI
enabled.

[End of TCO 5.1398]


TOPS20 Change Order Number 5.1399

Written by: SCHMITT		 7-Jul-81 13:05:26

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 	 16431


Problem: 
MJBUSE does not hold the maximum job number in use.

Diagnosis: 
At HLTJOB the compare instruction for whether the current
job is the current maximum job in use doesn't work because
T2 does not conatin the current job number.

Solution: 
Load the job number before making the compare.

[End of TCO 5.1399]


TOPS20 Change Order Number 5.1402

Written by: PAETZOLD		 8-Jul-81 15:26:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 


Problem: 

Forks (and jobs) hang waiting for FILLCK for a jfn after a page to
write on copy page.


Diagnosis: 

OFNJFN locks FILLCK and then checks for desired jfn/ofn.


Solution: 

Make some quick checks to see if this is the desired JFN before
locking FILLCK.


[End of TCO 5.1402]


TOPS20 Change Order Number 5.1403

Written by: MOSER		 9-Jul-81 11:58:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: GTDIR WRITES GROUP LISTS 1 WORD LONGER THAN THE ARGUMENT BLOCK LENGTH
SPECIFIED IF THERE ARE MORE GROUPS THAN WILL FIT IN THE BLOCK.

Diagnosis: GTDIR USES THE ARGUMENT BLOCK LENGTH AS A COUNTER FOR NUMBER OF
GROUPS TO STORE FORGETTING THAT THE BLOCK LENGTH INCLUDES THE LENGTH WORD.

Solution: SUBTRACT 1 FROM THE BLOCK LENGTH BEFORE USING AS A COUNTER.

[End of TCO 5.1403]


TOPS20 Change Order Number 5.1406

Written by: MOSER		10-Jul-81 09:08:19

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	PAGEM

Related TCO's:
Related SPR's: 


Problem: THE FIRST COPY-ON-WRITE REFERENCE TO A PAGE USED FOR A NON-BLOCKING
DUMPO CAN CAUSE ILPAG1 BUGHLT.

Diagnosis: DUMPO LOCKS DOWN THE PAGE AND THE COPY-ON-WRITE REFERENCE CAUSES
AN ATTEMPTED SWAPOUT OF THE PAGE LEADING TO AN ILPAG1.

Solution: MAKE COPY ON WRITE TO A LOCKED PAGE ILLEGAL.

[End of TCO 5.1406]


TOPS20 Change Order Number 5.1407

Written by: PAETZOLD		11-Jul-81 15:39:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: 

Large monitors (eg MONDEV) will not boot on small systems with 256K of
memory.


Diagnosis: 

GSMDSK locks down pages in large sections and then calls on BOOT to
map in the pages.  After BOOT maps in the pages the pages get swapped
to disk.  Sometimes not enough pages exist on the replacable queue to
handle all the pages CGPLK creates.  Job zero then gets stuck waiting
for pages and the scheduler runs GCCOR continuously trying to free
up some pages.  GCCOR never frees any.  The system is hung forever 
and ever.


Solution: 

Make sure enough pages exist on the replacable queue to handle all the
pages we want to create and map.  In mexec in GSMD2.


[End of TCO 5.1407]


TOPS20 Change Order Number 5.1408

Written by: PAETZOLD		12-Jul-81 16:25:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	ttntdv

Related TCO's:
Related SPR's: 


Problem: 

Detachs of ARPANET NVT's causes all kinds of wondrous BUGHLT's.  eg. ILLUOO
ILFPTE etc...


Diagnosis: 

Code for TTMSG (used to notify user of what happened to his job)  at
TTMSN1 does an extra POP off the stack.  Since nothing was PUSH'ed on
the stack the PC ends up in the twilight zone.


Solution: 

Remove it.


[End of TCO 5.1408]


TOPS20 Change Order Number 5.1409

Written by: GRANT		13-Jul-81 09:53:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IPCF

Related TCO's:
Related SPR's: 


Problem: FLKTIM BUGCHK

Diagnosis: The MRECV JSYS code tries to get the fork lock while NOINT.

Solution: Create a routine which gets the fork lock, then tries to get the
	PID lock.  If the attempt to get the PID lock fails, give up the
	fork lock and try again after waiting for a bit.
[End of TCO 5.1409]


TOPS20 Change Order Number 5.1412

Written by: PAETZOLD		14-Jul-81 12:51:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SYSERR

Related TCO's:
Related SPR's: 


Problem: 

JRST using a relative address (.+x) in UNQSEB.


Diagnosis: 

Questionable morals.


Solution: 

Create a new symbol (UNQSB2) and jrst to that


[End of TCO 5.1412]


TOPS20 Change Order Number 5.1413

Written by: DONAHUE		15-Jul-81 10:51:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 16260


Problem: 
JFNS% does will not return an updated byte pointer if it gets a HRROI style
pointer and does not print anything. It will place a null in the destination
buffer but not update the byte pointer.

Diagnosis: 
JFNS% deposits a null before doing anythong else, but neglects to update
the pointer if it was a HRROI style pointer.

Solution: 
Have JFNS% return return the pointer after depositing the initial null byte.

[End of TCO 5.1413]


TOPS20 Change Order Number 5.1415

Written by: SCHMITT		15-Jul-81 15:01:09

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 	 16477


Problem: 
DIRFDB, DIRDNL, ULKSIZ, and RELINT BUGCHKs

Diagnosis: 
When releasing a parse only JFN, it sometimes may be associated with
a new file.  In this case, an attempt will be made to delete the new
FDB.  It is possible, though, that the FDB will have already been 
deleted due to a close abort or a delete and a lookup will have to
be performed to acquire the address of the FDB to delete.  Since the
JFN is a no parse JFN, it is assumed that no FDB is associated with it.
The lookup routine (VERLKX) will return success but with the directory
unlocked.  This will make GETFDB return success also.  A call will 
subsequently be made to USTDIR which will generate the series of BUGCHKs.
The problem arises because a parse only JFN is given a new file FDB.

Solution: 
If it is noted early in the GTJFN JSYS, that we are parsing a parse only
JFN, then no FDB will be created.  This will have two side affects, mostly
preferable.  Parse only JFNs will never acquire an FDB, regardless of
whether stars are typed.  This means, file I/O will never be allowed to
occur to a parse only JFN.  Currently, if no stars are typed in the
string, the JFN can be opened and I/O can occur.  (ie. it is treated as
if the JFN were not a parse only JFN).  The second effect is that the
bits GJ%NEW and GJ%OLD will have no bearing on the parsing of the parse
only JFN.  Currently, if the bit GJ%OLD is set, the file name must exist
for the GTJFN to succeed.  


[End of TCO 5.1415]


TOPS20 Change Order Number 5.1416

Written by: WACHS		16-Jul-81 05:48:54

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: TM78s show up when they shouldn't

Diagnosis: dual-port stuff wrong

Solution: check available bit in status word

[End of TCO 5.1416]


TOPS20 Change Order Number 5.1419

Written by: SCHMITT		16-Jul-81 16:09:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 	 14944


Problem: 
Class load average trashing.

Diagnosis: 
Race in SCHED which would cause the class of a logged out
job to get changed.

Solution: 
Since CHGCLS is called NOSKED, check in CHGCLS if the job is
logged in.  If it is not, don't decrement or increment class
counts.

[End of TCO 5.1419]


TOPS20 Change Order Number 5.1422

Written by: FLEMMING		19-Jul-81 06:21:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: Jobs hung in logout

Diagnosis: KFORK tries to PMAP away all the pages of a section. If
this fails giving an illegal page error return, CPMAP attempts to
create a section with SMAP%. This fails via ITRAP and the fork never
goes away.

Solution: Never attempt section creates when doing a PMAP to delete
pages.

[End of TCO 5.1422]


TOPS20 Change Order Number 5.1423

Written by: MOSER		20-Jul-81 15:41:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: SETTING LOWERCASE AND FLAG CAUSE DELETE TO BACKUP TOO MANY CHARS.

Diagnosis: TT%LCA IMPLIES THAT TT%UOC WILL BE IGNORED BUT COMND DOSEN'T
KNOW THIS.

Solution: LOOK AT TT%LCA AS WELL AS TT%UCO.

[End of TCO 5.1423]


TOPS20 Change Order Number 5.1425

Written by: GROUT		21-Jul-81 11:27:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF	DIRECT

Related TCO's:	5.1479
Related SPR's: 


Problem: RCUSR doesn't see all users; .CMUSR (or .CMDIR) FDB with CM%DWC set
used for parsing a wild user (or directory) string with no match returns
user (or directory) number of zero with CM%NOP clear.

Diagnosis: RCUSR calls MDDDIR, which checks read access before it uses
directories; RCUSR/RCDIR set RC%NMD instead of RC%NOM when RC%STP is off.

Solution: Make MDDDIR not check read access if called from RCUSR; set the
right flag.

[End of TCO 5.1425]


TOPS20 Change Order Number 5.1428

Written by: MURPHY		21-Jul-81 17:21:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	STG

Related TCO's:
Related SPR's: 


Problem: High load average, sluggish response.  Comes and goes.

Diagnosis: Fork becomes stuck in high priority scheduling state
(CSKED, etc.) due to unrelated bug.

Solution: Detect excessive time in high priority scheduling,
reduce priority.

[End of TCO 5.1428]


TOPS20 Change Order Number 5.1429

Written by: MOSER		22-Jul-81 14:54:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PH4P4

Related TCO's:
Related SPR's: 


Problem: WHEN A DISK DRIVE IS SWITCHED TO "OUR" CONTROLLER AND POWERED UP
THE MONITOR KNOWS ABOUT THE DISK BUT MOUNTR DOESN'T.

Diagnosis: RP4INI NEGLECTS TO SET US.PSI INDICATING THAT A PSI MAY BE NEEDED.

Solution: SET US.PSI IN RP4INI.

[End of TCO 5.1429]


TOPS20 Change Order Number 5.1430

Written by: PAETZOLD		23-Jul-81 10:39:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	APRSRV	IMPANX	BUGS

Related TCO's:
Related SPR's: 


Problem: 

AN20 sometimes generates IO Page Fails when the ARPANET is being shut off.


Diagnosis: 

Solution: 

At APRIOP in APRSRV call routine IMPFPF to determine if cause of the page
fail was the AN10.  If is was the AN10 then shut it off and generate a 
IMPIOP BUGCHK.


[End of TCO 5.1430]


TOPS20 Change Order Number 5.1431

Written by: GRANT		23-Jul-81 14:05:13

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILINI

Related TCO's:
Related SPR's: 


Problem: When installing a new system you can't run UETP.

Diagnosis: PS:<OPERATOR> doesn't have IPCF privileges.

Solution: When you create a structure give PS:<OPERATOR> IPCF.
[End of TCO 5.1431]


TOPS20 Change Order Number 5.1432

Written by: PAETZOLD		24-Jul-81 05:23:08

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: 

SYSDPY and MONRD do not work with non-decnet systems.


Diagnosis: 

Symbol BLKASG is looked for but not found.


Solution: 

If monitor has no decnet then create a dummy BLKASG.


[End of TCO 5.1432]


TOPS20 Change Order Number 5.1433

Written by: SCHMITT		24-Jul-81 15:58:44

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM	MONSYM	JSYSA

Related TCO's:
Related SPR's: 	 16286


Problem: 
KPALVH BUGHLTs, hung jobs, hung system when page or sections are
mapped into a loop.  When certain arguments to JSYSs are in a
page which is mapped to a loop, the job would loop, sometimes NOINT.
When sections are mapped together in a loop and the process which
contains this map is killed, the system will hang attempting to
resolve the indirect section pointers.

Diagnosis: 
Tops-20 depends on loops not existing.  Code could probably be added
to make argument checking and page fail code more careful about 
dealing with potential loops but it seems that the mapping code
should disallow loops.

Solution: 
Insert code at MSETST and SETPT0 which will check for page or
section map loops.  Error codes SMAPX2 and PMAPX8 will be returned
from SMAP and PMAP respectively if a loop is detected.

[End of TCO 5.1433]


TOPS20 Change Order Number 5.1434

Written by: PAETZOLD		26-Jul-81 19:02:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	ttntdv

Related TCO's:
Related SPR's: 


Problem: 

ARPANET connections to NVT's do not get bit transmission counts updated.
They are always zero.


Diagnosis: 

No code to increment them.


Solution: 

Add the code in TTNTDV at NETTC5 and NVTUPD


[End of TCO 5.1434]


TOPS20 Change Order Number 5.1435

Written by: WACHS		27-Jul-81 09:04:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: TM fault B, MB fault don't get logged by SPEAR

Diagnosis: Waiting for an interrupt that never happens

Solution: Don't read extended sense info on TM fault B,, MB fault

[End of TCO 5.1435]


TOPS20 Change Order Number 5.1436

Written by: LEACHE		30-Jul-81 09:40:27

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: USAGE% can no longer accomodate indexed or indirect
secondary argument pointers.

Diagnosis: Someone changed argument-fetch code from:

	HRLI T3,(<MOVE T2,@0>)
	XCTUU T3

to:

	XCTU [MOVE T2,0(T2)]

Solution: Restore original argument-fetch code.

[End of TCO 5.1436]


TOPS20 Change Order Number 5.1439

Written by: SCHMITT		 4-Aug-81 09:23:36

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 	 16397


Problem: 
JSYS Trapping programs recieve interrupts from JSYSs
executed from execute only programs.  This reveals 
information about the execute only program.

Diagnosis: 
This really wasn't addressed before.

Solution: 
Before trapping JSYSs, check for whether executing process
is execute only.  If so, perform the JSYS as if no JSYS
trapping was occuring.

[End of TCO 5.1439]


TOPS20 Change Order Number 5.1440

Written by: SCHMITT		 4-Aug-81 09:27:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 	 16431


Problem: 
MJBUSE does not hold the maximum job number in use.

Diagnosis: 
At HLTJB3-5 the compare instruction for whether the current
job is the current maximum job in use doesn't work because
T2 does not contain the current job number

Solution: 
Load the job number before making the compare.

[End of TCO 5.1440]


TOPS20 Change Order Number 5.1441

Written by: SCHMITT		 4-Aug-81 09:31:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 	 16353


Problem: 
Inconsistencies with COMND JSYS when parsing .CMFIL with
.GJALL specified as the extension.  No error would be
generated unless the line was reparsed, at which point the
error GJFX31 would be returned.

Diagnosis: 
GTJFN places the file string that was parsed into the atom
buffer.  When .GJALL is specified, the '*' for the version
is also placed in the atom buffer.  When this string is
reparsed, the * is illegal because GJ%IFG was not specified
in the call.

Solution: 
When defaulting the version number of the file, do not allow
.GJALL if GJ%IFN was not specified in the call.

[End of TCO 5.1441]


TOPS20 Change Order Number 5.1442

Written by: ZIMA		 4-Aug-81 11:00:38

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 	 16532


Problem: 
     DELF JSYS with arguments DF%NRJ and DF%CNO for an offline file
returns error code ARGX25 - "Invalid class".

Diagnosis: 
     Wrong code; should be ARGX26 - "File is offline".

Solution: 
     Change the code to ARGX26.

[End of TCO 5.1442]


TOPS20 Change Order Number 5.1446

Written by: PAETZOLD		 8-Aug-81 15:39:54

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	mstr

Related TCO's:
Related SPR's: 


Problem: 

MSTR jsys gets errors when trying to mount a structure with a bad primary
home block (but a good secondary home block).  


Diagnosis: 

Copy of secondary home block to primary is broke for MSTR.  It still works
for the primary structure when booting.


Solution: 

Remove the two ADDI's at HOMCK3 in MSTR.


[End of TCO 5.1446]


TOPS20 Change Order Number 5.1447

Written by: ZIMA		 9-Aug-81 20:20:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	CDRSRV

Related TCO's:
Related SPR's: 


Problem: TOPS-20 is too big and too slow.

Diagnosis: Unneeded instruction in REQPSI in CDRSRV, can fall through.

Solution: Comment out the CALLRET.

[End of TCO 5.1447]


TOPS20 Change Order Number 5.1451

Written by: PAETZOLD		11-Aug-81 16:30:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IMPDV

Related TCO's:
Related SPR's: 	 15018


Problem: 

IMPHLT tries to shut down net when not on.


Diagnosis: 

Doesnt check state of IMP (IMPRDY).


Solution: 

check state of imprdy.


[End of TCO 5.1451]


TOPS20 Change Order Number 5.1453

Written by: ZIMA		14-Aug-81 10:24:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: TOPS-20 is too big and too slow.

Diagnosis: In COMND, at RTYP33, two instructions are wasted by JRST'ing
into a literal to do one instruction and JRST'ing back.

Solution: Do the instruction inline.

[End of TCO 5.1453]


TOPS20 Change Order Number 5.1457

Written by: ZIMA		26-Aug-81 11:42:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 


Problem: None observed, but code is wrong.

Diagnosis: In DSK10A, the reference to .STDFE should have forced it to the
left half for proper use as days in the address arithmetic.

Solution: Force .STDFE to the left half.

[End of TCO 5.1457]


TOPS20 Change Order Number 5.1458

Written by: ZIMA		26-Aug-81 13:24:37

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MFLOUT	MFLIN	iman22	impanx	bugs	STG
			dtesm

Related TCO's:
Related SPR's: 


Problem: 
     Autopatch procedures have numerous error-prone and unnecessary steps.

Diagnosis: 
     Autopatch keys off the module name for a REL file as provided in the
TITLE statement.  Several modules have titles which differ from the name
of the file containing the module, requiring by-hand exception handling.

Solution: 
     Make those modules have titles corresponding to the filename where
possible.

[End of TCO 5.1458]


TOPS20 Change Order Number 5.1460

Written by: ZIMA		26-Aug-81 16:33:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: YES
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MFLOUT

Related TCO's:
Related SPR's: 


Problem: TOPS-20 is too big and too slow.

Diagnosis: In the FLOUT code an unneeded UMOVE is done before calling BOUTA.

Solution: Remove the unneeded code.

[End of TCO 5.1460]


TOPS20 Change Order Number 5.1462

Written by: PAETZOLD		26-Aug-81 20:05:02

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FREE

Related TCO's:
Related SPR's: 


Problem: 

Modules in FREE do PION's when they should not.

Diagnosis: 

Code doesnt check if PIOFF was allready in effect before going PIOFF/PION.

Solution: 

Make the code check.  Only go PION if entered routine PION.


[End of TCO 5.1462]


TOPS20 Change Order Number 5.1469

Written by: MURPHY		27-Aug-81 09:36:03

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: DEAUNA bugchks while running DBMS.

Diagnosis: Disk address being deassigned in RELADR, but index
block not being rewritten to reflect change.

Solution: Set OFN modified bit to get index block rewritten.
Also, prevent UPDOFN from writing index blocks containing
uninitialized disk addresses (i.e. with DSKNB set).

[End of TCO 5.1469]


TOPS20 Change Order Number 5.1470

Written by: MURPHY		27-Aug-81 09:36:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: Code at PGUNTP clears FPD from wrong word.  No known
symptoms.

Diagnosis: 

Solution: Make instruction reference correct word.

[End of TCO 5.1470]


TOPS20 Change Order Number 5.1471

Written by: PAETZOLD		27-Aug-81 09:36:09

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IO	APRSRV

Related TCO's:
Related SPR's: 


Problem: 
MONITOR has confusion resulting from TTY UDX being used as IO designators
because they have the same format as certain OWGBP.  CHKJFN does not
allow OWGBP to be used as designators because of range checks on the P
field of the byte pointers.  BYTBLT does not use word transfers when using
OWGBP.

Diagnosis: 
BYTBLT and CHKJFN need work.

Solution: 
When in non-zero section (NZS) the TTY UDX will not be allowed as an IO
designator.  CHKJFN will be fixed.  BYTBLT will be fixed.  All section
zero behaivor will not change.

[End of TCO 5.1471]


TOPS20 Change Order Number 5.1473

Written by: PAETZOLD		27-Aug-81 09:36:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NETWRK	GLOBS	STG

Related TCO's:
Related SPR's: 


Problem: 
Difficult to debug problems with ncp lock.

Diagnosis: 
NCP locking mechanism keeps tracks of usefull things about the locker.
However it does not keep track of the pc of the call to the locking mechanism.

Solution: 
Store the PC of the NCP locker in NCPLPC in STG.

[End of TCO 5.1473]


TOPS20 Change Order Number 5.1475

Written by: CHALL		27-Aug-81 09:36:32

Edit checked: YES			   Document: NO
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: IF A COMMAND HAS A KEYWORD LIST THAT ONE KEYWORD LONG THE
USER HAS TO TYPE AT LEAST AN ESCAPE TO GET THE KEYWORD. BUT WHY SHOULDN
THAT KEYWORD COME OUT, NOISE-LIKE, IF THE PREVIOUS WORD OF THE COMMAND WERE
ENDED WITH AN ESCAPE?

Diagnosis: 

Solution: ALTER COMND SUCH THAT IF: 1) THE CURRENT THING BEING PARSED IS A
KEYWORD, 2) A KEYWORD IS THE ONLY THING THAT LEGAL RIGHT NOW, 3) THERE
ONLY ONE KEYWORD IN THE LIST, AND 4) ESCAPE RECOGNITION WAS USED WITH THE
PREVIOUS WHATZIT, THEN: COMPLETE THE RECIGNITION OF THE PREVIOUS WHATZIT
AND THEN OUTPUT THE KEYWORD AS IF IT WERE NOISE.

NOTE: IF ANOTHER KEYWORD IS ADDED TO THE LIST THEN THE ABOVE WON HAPPEN,
SO THIS CHANGE ONLY WORKS WHERE IT SHOULD.

NOTE: THIS CHANGE DOESN AFFECT THE SITUATION OF TYPING <PREVIOUS WHATZIT>
<SPACE> <ESCAPE>. FOR THAT CASE, SET UP THE KEYWORD AS THE DEFAULT KEYWORD.

[End of TCO 5.1475]


TOPS20 Change Order Number 5.1479

Written by: GROUT		28-Aug-81 11:39:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:	5.1425
Related SPR's: 


Problem: Indirect words in SETDIR/SETDRR calls from MDDDIR can
cause section change.

Diagnosis: IFIW bits are not set.

Solution: Set them

[End of TCO 5.1479]


TOPS20 Change Order Number 5.1481

Written by: PAETZOLD		31-Aug-81 14:45:01

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA	JSYSF	GLOBS

Related TCO's:
Related SPR's: 


Problem: 

Several JSYS' accept arguments in ACs that conflict.  Eg. CACCT accepts
either <<5B2>!<ACCOUNT NUMBER>B35> or <BYTE POINTER> in AC1.  If OWGBP's
are used then confusion between the byte pointer and numeric designators
will result.

The following JSYS' are affected:

CACCT, CRJOB, LOGIN, SACTF, ACCES, CHKAC, RCDIR, STPPN, DEQ, ENQ, and ENQC

Diagnosis: 


Solution: 

Add code to jsys' to detect OWGBP's.  In non-zero sections only seven bit
one word global byte pointers will be allowed.

[End of TCO 5.1481]


TOPS20 Change Order Number 5.1484

Written by: DONAHUE		 1-Sep-81 22:19:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: 
If CTRL/V is set as a break character to TEXTI, the first CTRL/V will
not be treated as a break character.

Diagnosis: 
The routine in to handle CTRL/V does not return to the code that checks 
if the character is in the break mask.

Solution: 
Make routine RDQT return to INSRT, which checks the break mask, instead of
INSRT1.

[End of TCO 5.1484]


TOPS20 Change Order Number 5.1485

Written by: MOSER		 2-Sep-81 16:54:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IO

Related TCO's:
Related SPR's: 


Problem: SIN with a byte pointer with infinite indirection hangs.

Diagnosis: First reference to byte is done NOINT.

Solution: Reference a byte before going NOINT.

[End of TCO 5.1485]


TOPS20 Change Order Number 5.1486

Written by: DONAHUE		 3-Sep-81 10:20:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILMSC

Related TCO's:
Related SPR's: 


Problem: 
A SOUT to .PRIOU with an unreasonably large byte count will hang the job
indefinitely.

Diagnosis: 
Routine TTYBLO loops for each character and stays NOINT.

Solution: 
Set up a loop counter at TTYOLP. After every 1000 times thru, unlock the
TTY, allowing interrupts.

[End of TCO 5.1486]


TOPS20 Change Order Number 5.1487

Written by: MILLER		 3-Sep-81 12:26:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	APRSRV	STG	SYSERR	PHYH2	PHYPAR

Related TCO's:
Related SPR's: 


Problem: Numerous cases of MB parity error, SBUS error and
AR/ARX error are not handled correctly. In particular, channel
write parity errors are causing problems in the field.

Diagnosis: A number of problems exist in the code. A general
reworking of the MB parity error, SBUS error and AR/ARX error
code is required.

Solution: Do the rework. The highlights are:

	1. Don't enter secondary protocol on parity errors, but do
	everything in job 0.

	2. Add a failsafe check at BUGHLT to force typeout of any
	unprocessed parity errors.

	3. Make PHYSIO aware of channel write parity errors and
	have convert the operation into a device error.

	4. RH20 logout code cooperates with APRSRV to scan
	memory and correct errors written by the channel.

	5. Numerous fixes to APRSRV code to insure that MOS
	controllers are correctly unlatched.

[End of TCO 5.1487]


TOPS20 Change Order Number 5.1490

Written by: GRANT		 8-Sep-81 17:03:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:	5.1587
Related SPR's: 


Problem: DECnet-20 needs improved performance.

Diagnosis: One of the causes for sluggishness may be that data segments
	are acked when the user does the SINR instead of when the monitor
	actually recieves the message.

Solution: Do ACKs in scheduler once a second.
[End of TCO 5.1490]


TOPS20 Change Order Number 5.1491

Written by: CHALL		 9-Sep-81 09:13:29

Edit checked: YES			   Document: YES
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: TCO 5.1475 CAUSES MORE PROBLEMS THAN IT FIXES

Diagnosis: 

Solution: REMOVE IT UNTIL I GET IT RIGHT.

[End of TCO 5.1491]


TOPS20 Change Order Number 5.1494

Written by: PAETZOLD		 9-Sep-81 10:05:55

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: 

MONPDL BUGHLT's

Diagnosis: 

Stack overflow from TRAPSK.  TRAPSK isnt big enough.


Solution: 

Increase size of TRAPSK.  Move PIAC past PSB location 600.  Increase TRAPSK
by 20 words.


[End of TCO 5.1494]


TOPS20 Change Order Number 5.1495

Written by: DONAHUE		 9-Sep-81 11:05:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DSKALC

Related TCO's:
Related SPR's: 


Problem: 
A disk that has lost pages (not an exact multiple of 4 sectors per cylinder
such as the RM03) can have its Bat blocks released by CHECKD.

Diagnosis: 
CHECKD uses the physical address stored in the Bat blocks to create its
copy of the Bat blocks. When checking if a page is marked in the Bat block,
it translates the logical address to a physical address using the wrong
algorithm. When the Monitor initializes a structure, it marks the physical
address in the Bittable, when it really should mark the logical address.

Solution: 
In CHECKD the changes are to NXTPR and SEEADR. NXTPR creates CHECKD's copy
of the Bittable. The change here is to convert the physical addresses found in 
the Bat blocks to the proper logical address. At SEEADR, the change is to
use the logical address passed to it when checking CHECKD's copy of the
Bat block.
In Tops-20, routines TOPASG, SEEADR and DOABA1 are affected. TOPASG marks
all Bat blocks in the Bittable when initializing a structure. Make it
translate the physical addresses to logical. SEEADR should not translate the
physical address to logical, as DOABA1 will translate the physical addresses
found in the Bat blocks to logical addresses, and then compare the result
to the logical address passed to SEEADR.
These edits should not affect disks with no lost pages, as the translation
from physical to logical results in the same address.

[End of TCO 5.1495]


TOPS20 Change Order Number 5.1499

Written by: MOSER		 9-Sep-81 15:49:14

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DEVICE

Related TCO's:
Related SPR's: 


Problem: If a file is opened for read and write and a write is done then
reads can be done past the end of file using SIN. The file gets longer
each read and each read returns nulls.

Diagnosis: SIN depends on FILCNT to determine the number of bytes in the buffer.
When writing this is fine but for reading FILCNT should reflect the number of
bytes in the buffer or the last byte in the file minus the current byte
whichever is smaller. This is to insure that if the last byte in the file is
read then EOF will be returned. The code does not consider write first and
then read.

Solution: At BIOINP when setting up for read after write make sure that FILCNT
has the correct value.

[End of TCO 5.1499]


TOPS20 Change Order Number 5.1502

Written by: GRANT		14-Sep-81 09:20:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: ILLUUO BUGHLT.

Diagnosis: NODE JSYS function NDGNT doesn't clean up stack properly under
	certain error conditions.

Solution: At NDGNXX, account for node already popped off stack.
[End of TCO 5.1502]


TOPS20 Change Order Number 5.1503

Written by: GRANT		14-Sep-81 10:50:46

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPPAR	NSPSRV

Related TCO's:
Related SPR's: 


Problem: DECnet Architecture now allows 39-character user ids, passwords,
	and accounts.

Diagnosis: TOPS-20 needs to be updated to allow new lengths.

Solution: Change values in table ATTRTB.
[End of TCO 5.1503]


TOPS20 Change Order Number 5.1505

Written by: MURPHY		14-Sep-81 12:30:10

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: A bad parity word in memory will cause a page fault every time
it is touched.  If the program keeps touching it, the SYSERR file
will be filled with redundant entries.

Diagnosis: 

Solution: Clear the bad word on the first page fault.  If the program
persists in touching it after the interrupt, subsequent references
will succeed.  Thus, each bad parity word causes exactly
one interrupt, as do hard disk errors, etc.

[End of TCO 5.1505]


TOPS20 Change Order Number 5.1507

Written by: MURPHY		14-Sep-81 15:01:29

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: Unprivileged user cannot send message to another terminal.
He can TALK, but may prefer just to send pre-typed and edited message.

Diagnosis: TTMSG requires privileges for all functions.

Solution: Allow TTMSG to specific line by unprivileged user.  In this
case, prefix header so that anonymous message cannot be sent.

[End of TCO 5.1507]


TOPS20 Change Order Number 5.1508

Written by: GRANT		14-Sep-81 16:05:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: DECnet logical link not being cleaned up.

Diagnosis: When DI is sent for an abort close the queues are flushed;
	thus, the DI never gets retried and eventually timed out if the
	other side doesn't answer.

Solution: Don't call FLUSH at CLZWDC.
[End of TCO 5.1508]


TOPS20 Change Order Number 5.1510

Written by: GRANT		15-Sep-81 11:48:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: Network Management counter "number of active links" produces
	funny numbers.

Diagnosis: The counter gets overly decremented.

Solution: Do the bookkeeping further downstream in DELNOD and CIMSG.
[End of TCO 5.1510]


TOPS20 Change Order Number 5.1511

Written by: MOSER		15-Sep-81 11:48:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DEVICE	IO

Related TCO's:
Related SPR's: 


Problem: TCO 5.1499 WAS TOO GENERAL. IF THE CODE WAS CALLED WITH JFN CONTAINING 
A BYTE POINTER THEN BAD THINGS COULD HAPPEN.

Diagnosis: THE CODE SHOULD BE IN SIN SO THAT IT ONLY IS USED WHEN A JFN IS
IN AC JFN.

Solution: MOVE TCO 5.1499 TO IO.MAC.

[End of TCO 5.1511]


TOPS20 Change Order Number 5.1512

Written by: MOSER		15-Sep-81 15:06:03

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: Monitor crashes when a carrier off detached job is reattached.

Diagnosis: JOBCOF runs in sec 0 but may need to be in sec 1 when reattached.

Solution: Add SE1ENT to JOBCOF.

[End of TCO 5.1512]


TOPS20 Change Order Number 5.1513

Written by: DONAHUE		16-Sep-81 14:22:17

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 16650


Problem: 
When creating a top level directory, <ROOT-DIRECTORY>'s subdirectory count
is not incremented. It is however, decremented when a directory is killed.
When the subdirectory count goes to zero, it causes the I DIR <*> to only
see <ROOT-DIRECTORY>.

Diagnosis: 
Coding error.

Solution: 
Don't skip the code to increment the subdirectory count at CRDIAB:+16
if the superior is <ROOT-DIRECTORY>.

[End of TCO 5.1513]


TOPS20 Change Order Number 5.1514

Written by: MURPHY		16-Sep-81 17:48:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC	FREE

Related TCO's:
Related SPR's: 


Problem: See TCO 5.1380 - SYSERR data still getting lost.

Diagnosis: SYSERR fork is not created until well after front end
starts sending data.  Data is lost if amount of available
resident storage is insufficient.

Solution: Create SYSERR fork before front end starts sending SYSERR
data.  Prevent job 0 from unlocking pages so much.

[End of TCO 5.1514]


TOPS20 Change Order Number 5.1515

Written by: GRANT		17-Sep-81 15:26:39

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	P60BIG

Related TCO's:
Related SPR's: 


Problem: Swapping space isn't big enough for the larger configurations.

Diagnosis: Swapping space number are the same as previous release.

Solution: Make big monitor be 10000 and max monitor be 15000.
[End of TCO 5.1515]


TOPS20 Change Order Number 5.1516

Written by: WACHS		18-Sep-81 11:40:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM2

Related TCO's:
Related SPR's: 


Problem: Spurious hard device errors from TU45/TU77 on a TM02 or TM03

Diagnosis: Format error can come up along with some other error bits.
If it does, we claim a hard error. It is a "fake format error" if the
tape moved, and we ought to retry

Solution: Test some other bits if format error is on. Retry if any
tape motion was detected

[End of TCO 5.1516]


TOPS20 Change Order Number 5.1517

Written by: WACHS		21-Sep-81 06:37:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	phym78

Related TCO's:
Related SPR's: 


Problem: MOUNTR has trouble reading a tape on a TU78

Diagnosis: REWIND, if the tape is at BOT, doesn't generate a
PSI interrupt

Solution: generate an interrupt even if there is no tape
motion

[End of TCO 5.1517]


TOPS20 Change Order Number 5.1522

Written by: DONAHUE		21-Sep-81 13:08:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 	 15668


Problem: If the class scheduler is turned on after the system has been brought
up and a batch class is assigned, currently active batch jobs are not assigned
to the batch class.

Diagnosis: No code to do it.

Solution: Add the code to routine SKDSCB: to set active batch jobs to the
new class.

[End of TCO 5.1522]


TOPS20 Change Order Number 5.1523

Written by: DONAHUE		21-Sep-81 14:28:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	phyh11	diag

Related TCO's:
Related SPR's: 	 16188


Problem: Powering off a tape controller will generate a CLRACE Bughlt.

Diagnosis: Routine CLRRAE tries to clear the status register by finding
an existant unit on the channel. If it can not find a unit it will Bughalt.

Solution: Change the Bughalt to a Bugchk. Set the CDB offline to avoid the
cyclic check by the scheduler, and dismiss the interrupt. Also change the
code in DIAG that sets a unit online. Make it recognize this case (CDB
offline) and set the CDB back online instead of returning an error.

[End of TCO 5.1523]


TOPS20 Change Order Number 5.1526

Written by: MOSER		22-Sep-81 11:09:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: COMND called with a .CMNOI linked to anything will not print the
guide words if previous field ended in <ESC> until the user types. The
comments in COMND indicate that it should print guide words and not try
to parse anything else.

Diagnosis: JRST to XCOM7 which tries to do input if on pass 1. No guidewords
printed.

Solution: JRST to XCOM8 which prints the guidewords and does not try
for anything more.

[End of TCO 5.1526]


TOPS20 Change Order Number 5.1528

Written by: GRANT		22-Sep-81 22:45:07

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: IN SOME CASES TOPS-20 IS ACKING DATA SEGMENTS TWICE.

Diagnosis: ACK IS BEING PIGGYBACKED INTO OUTGOING DATA SEGMENT AND
	THEN AN EXPLICIT ACK MESSAGE IS BEING SENT.

Solution: IN LLSRVR, INCORRECT TEST IS BEING MADE TO SEE IF AN EXPLICIT
	ACK IS TO SENT.  TLNE SHOULD BE TLNN.
[End of TCO 5.1528]


TOPS20 Change Order Number 5.1529

Written by: GRANT		22-Sep-81 22:48:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: TOPS-20 IS INCORRECTLY NACKING AN OUT-OF-ORDER DATA SEGMENT.

Diagnosis: SHOULD MAKE NO RESPONSE TO A "TOO NEW" SEGMENT.  UPON
	RECEIVING AN OLD SEGMENT WE SHOULD SEND AN ACK FOR THE LAST
	GOOD SEGMENT RECEIVED.

Solution: CODE IN GOTSEG SHOULD DO THE RIGHT THING.
[End of TCO 5.1529]


TOPS20 Change Order Number 5.1530

Written by: MURPHY		23-Sep-81 15:32:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: If the bias knob is changed, the scheduler may fail to change
its behaviour.  In particular, if the bias knob has been set to a
low number such as to invoke "disaster avoidance" and the scheduler
has entered the state of refusing to load low-Q forks into the balance
set, resetting the bias knob to normal may leave  the scheduler forever
in the state of excluding low-Q forks, regardless of load.

Diagnosis: Flags aren't reset when disaster avoidance is turned off.
NOTE: problem exists in Release 4 also.

Solution: Reset them.

[End of TCO 5.1530]


TOPS20 Change Order Number 5.1531

Written by: PAETZOLD		24-Sep-81 11:44:23

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: 

User feeds a jsys (eg PSOUT) a byte pointer with <77>b5 on.  The system
crashes will an ILLUUO.


Diagnosis: 

Current behaivhoir is correct according to the OWGBP spec.  If one attemps
a byte instruction with a <77> p-field then an ILLUUO will result.  This is
just another case of grief from OWGBP's.


Solution: 

Change the MUUO handler in APRSRV to check if the cause of an ILLUUO was 
a PXCT of byte instruction.  If so generate an illegal instruction trap with
an ARGX09 (invalid byte size) error.


[End of TCO 5.1531]


TOPS20 Change Order Number 5.1533

Written by: GRANT		24-Sep-81 15:40:55

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: Excessive network traffic due to the retrying of timed out messages.

Diagnosis: The retry algorithm inadvertently is efficient only if the other
	end of the link keeps a cache of out-of-order messages.  If that is
	not the case (and it probably won't be on most systems) another
	approach should be used.

Solution: The time out resend algorithm now resends the entire queue
	whenever a message times out.
[End of TCO 5.1533]


TOPS20 Change Order Number 5.1534

Written by: GRANT		24-Sep-81 16:40:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: MTOPR read status of a DECnet link is ambiguous when waiting for
	a connection.

Diagnosis: The manual is quite specific and conveys the correct impression
	of what the read status bits should mean.

Solution: MO%WFC should reflect that the link is in listening state.
	MO%WCC should reflect CI sent state.
[End of TCO 5.1534]


TOPS20 Change Order Number 5.1536

Written by: SOUTH		28-Sep-81 10:56:01

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: RSX20F protocol not fast enough to service IBMCOM.

Diagnosis: Implementation precluded high volume data transfers due to
interaction with scheduler and small transfer limits.

Solution: New protocol to suport IBMCOM front ends.

[End of TCO 5.1536]


TOPS20 Change Order Number 5.1537

Written by: GRANT		28-Sep-81 12:08:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: NSP times out sent messages too often.

Diagnosis: The calculation of the time out value should be smarter.

Solution: Add a fudge factor on each retransmission.
[End of TCO 5.1537]


TOPS20 Change Order Number 5.1544

Written by: PAETZOLD		28-Sep-81 15:31:19

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: 

Under certain circumstances many many calls to VBOOT (greater than 40)
to load the swappable monitor.

Diagnosis: 

Calculation for number of pages to load (at GSMD2 in MEXEC) is done via
an immediate mode instruction.  It should be a non-immedaite mode inst.

Solution: 

Change the ADDI T1,-1000(P1) should be changed to ADD T1,P1 followed by
SUBI T1,1000.


[End of TCO 5.1544]


TOPS20 Change Order Number 5.1545

Written by: GRANT		29-Sep-81 09:00:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPPAR

Related TCO's:
Related SPR's: 


Problem: Different NSPPARs are needed for the "NSPSRV which talks to Phase
	III DN20s" and the "NSPSRV which talks to Phase II DN20s".

Diagnosis: Release 5 NSPPAR is not a proper superset of Release 4 NSPPAR.

Solution: Reinstate LLMSG and move LLLAK into word 31.
[End of TCO 5.1545]


TOPS20 Change Order Number 5.1546

Written by: SOUTH		29-Sep-81 11:18:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: error check in MCB code complains about DN60 messages.

Diagnosis: code doesn't know it is being used by the new protocol.

Solution: teach it.

[End of TCO 5.1546]


TOPS20 Change Order Number 5.1547

Written by: GROUT		29-Sep-81 13:26:16

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: 
When using COMND: command line typed in, edited back into, CTRL/C typed,
interrupted COMND jsys not continued, a .CMINI function is issued, and CTRL/H
is typed, yielding reparse of garbage.

Diagnosis: 
.CMPTR and .CMCNT are not updated until exit, so the valid region of the buffer
(defined between .CMBFP and .CMPTR) can be changed without updating the
pointers, if a CTRL/C is typed.  Then, a CTRL/H typed to a .CMINI causes a
reparse of the "valid" region of the buffer, yielding a gratuitous error.

Solution: 
Save .CMPTR and .CMCNT from inside the TEXTI called by COMND just before each
call to RDBIN if the backup limit has been reached (RD%BLR is set).

[End of TCO 5.1547]


TOPS20 Change Order Number 5.1548

Written by: SCHMITT		30-Sep-81 09:39:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 	 16797


Problem: 
Hung jobs when JSYS trapping.

Diagnosis: 
If a superior process halts an inferior process which is
currently JSYS trapped, the job will hang.  This is because
the inferior process goes NOINT while it is suspended due to
a JSYS trap.  If the process is halted before it is resumed,
the process will never be given the chance to OKINT itself.
Therefore, whenever any function is performed on that
process which needs to have the process suspended (ie,
KFORK) the job will hang.  This is because suspending a fork
actually posts a PSI interrupt to the fork to suspend
itself.  Since the process is NOINT, the PSI will never be
serviced.

Solution: 
In UTFRK, if the trapped process is halted upon returning
from the trap, set the process OKINT.

[End of TCO 5.1548]


TOPS20 Change Order Number 5.1549

Written by: SOUTH		30-Sep-81 09:48:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: DN60 protocol left its data base for a dte in busy state.

Diagnosis: insufficient protection against asynchronous exits.

Solution: set NOINT over adequate range.
[End of TCO 5.1549]


TOPS20 Change Order Number 5.1551

Written by: SCHMITT		30-Sep-81 11:43:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 	 16763


Problem: 
Various functions of the MTOPR JSYS will fail for labeled
tapes with CLSX1 (file is not opened) even though the file 
has been opened.

Diagnosis: 
The file is not opened in the eyes of MAGTAP until some I/O
has occured on the tape, either since the tape was opened
with the OPENF JSYS or the tape has been rewound.

Solution: 
For various functions of the MTOPR JSYS, make sure the tape
is opened with respect to MAGTAP and if not, open it.  This
is accomplished by using the MTOPR dispatch of MTLFCN
instead of MTMTCM.

[End of TCO 5.1551]


TOPS20 Change Order Number 5.1554

Written by: PAETZOLD		 1-Oct-81 13:11:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: 

Hard to track down problems with locking of SPTLKB.

Diagnosis: 

No facility to do so.

Solution: 

Add a temporary table (SPTO3) to keep track of who has OFN's locked.  

SPTO3/	FORKX,,PC of locker


[End of TCO 5.1554]


TOPS20 Change Order Number 5.1557

Written by: SCHMITT		 2-Oct-81 09:46:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 	 16783


Problem: 
Non enabled users sometimes caonnont access files on EBCDIC
labeled tapes.

Diagnosis: 
RACF protection is being enforced for tapes with
non-standard RACF protection characters in the file
accesibility field of the HDR1 label.

Solution: 
If a non standard character appears in this field, do not
perform RACF protection verification (the ACJ request), rather
allow access to the file since it must have been created on
a non RACF system.

[End of TCO 5.1557]


TOPS20 Change Order Number 5.1558

Written by: WALLACE		 2-Oct-81 16:03:26

Edit checked: NO			   Document: NO
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: The .PONAM (Read Program Name) function of the PDVOP%
JSYS returns garbage for the name string, if the name string is
in a non-zero section and a section relative address is used to
specify the address of the name string.

Diagnosis: LINK places a section relative address of the name string
into PDV's that it builds.  Although PDVOP% is smart enough to find
PDV's in non-zero sections, if fails to note that addresses within
the PDV's, that contain zero section numbers, are section relative
addresses. Therefore PDVOP% thinks that these addresses truly point
to section zero.

Solution: If the section number of the address of a name string is
zero, treat the address as a section relative one and use the section
number of the PDVA instead.  If the section number of the address of
a name string is non-zero, leave it alone, and treat it as a 30-bit
address.

Note that this means that name strings can not be placed in section
zero for PDV's that exist in non-zero sections.  The Monitor
modification required for the TCO is a two instruction patch to
PDVOP%.

[End of TCO 5.1558]


TOPS20 Change Order Number 5.1559

Written by: PAETZOLD		 4-Oct-81 20:17:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: 

NVT users dont see as as good performance as they should.

Diagnosis: 

They get treated the same way that PTY users get when comuting new Q values.

Solution: 

Code in NEWST checks for physical ttys.  Change to check for pty's.


[End of TCO 5.1559]


TOPS20 Change Order Number 5.1561

Written by: GRANT		 7-Oct-81 10:44:07

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: We need a version of TOPS-20 which will communicate with a
	DECnet Phase II MCB.

Diagnosis: Too complicated to have a single version of NSPSRV capable of
	communicating with both a Phase II and a Phase III MCB.

Solution: Revive the version of NSPSRV that existed just prior to the addition
	of Phase III capatibility.
[End of TCO 5.1561]


TOPS20 Change Order Number 5.1562

Written by: COBB		 7-Oct-81 11:38:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 


Problem: JFNS% does not return protection and account fields for a JFN created
as "parse-only".

Diagnosis: GTJFN% does not store these.  Code now checks for "new-file" or
"new-version" before allowing prot. and acct. to be stored.

Solution: Add "astf" (parse-only) to flags checked.
[End of TCO 5.1562]


TOPS20 Change Order Number 5.1570

Written by: MURPHY		13-Oct-81 10:40:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	STG

Related TCO's:	5.1580
Related SPR's: 


Problem: Jobs appear hung when running class scheduler with windfall
withheld.  Also possible poor response under class scheduling
with windfall allocated.

Diagnosis: Utilization computed as fraction of time sold.  Causes
utilization to appear high when idle time present.

Solution: Include idle time in divisor for computing utilization.

[End of TCO 5.1570]


TOPS20 Change Order Number 5.1574

Written by: PAETZOLD		14-Oct-81 10:45:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: 

SPTSHR BUGHLT'S.  excessive pmaps of a page to every lots of pages in lots of
sections of a fork results in BUGHLT.

Diagnosis: 

MSETPT calls SETSHR to increment share count when the increment will cause it to
overflow.

Solution: 

Add a routine called CHKSHR which will check for share count allready containing
the maximum value.  Call it before SETSHR in MSETPT.  If share count is allready
at the max value then generate error for insufficient system resources.

[End of TCO 5.1574]


TOPS20 Change Order Number 5.1575

Written by: WACHS		14-Oct-81 10:57:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYX2

Related TCO's:
Related SPR's: 


Problem: magtapes disappear - device becomes inaccessible

Diagnosis: MTCUTB entry gets zeroed or overwritten.

Solution: PHYX2 picks up MTINDX and stores in MTCUTB without
checking that the entry is free. If SETSPD has switched some
tape numbers around, the entry might already be in use

[End of TCO 5.1575]


TOPS20 Change Order Number 5.1576

Written by: PAETZOLD		14-Oct-81 10:57:37

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 

PMAP sometimes leaves files in a bizarre state when it has tried to back out
of an aborted PMAP.

Diagnosis: 

If the source ID is a jfn then FILLFW for the jfn is incremented.  It is not
decremented during the failure code after the calls to MSETPT.

Solution: 

During the backout code decrement FILLFW for the JFN if the SID was a jfn.

[End of TCO 5.1576]


TOPS20 Change Order Number 5.1579

Written by: MOSER		15-Oct-81 12:18:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: When using class scheduling the computed priority for an interactive
job is advertised to be 3.1 if the fork is on Q1 with windfall allocated
or with windfall withheld when the class is not in windfall. The priority
is supposed to be increased by 0.5 if windfall is withheld and the class
is in windfall. The code does the exact opposite of this action always giving
3.1 if windfall is withheld and giving a 0.5 boost if windfall is allocated
and the class is using windfall.

Diagnosis: Test for withholding windfall is wrong.

Solution: Use a SKIPL CLASSF at CORFC5+1 instead of SKIPG.

[End of TCO 5.1579]


TOPS20 Change Order Number 5.1580

Written by: MOSER		15-Oct-81 12:25:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:	5.1570
Related SPR's: 


Problem: When withholding windfall WATCH reports ridiculous times for
IDLE and FILW if there are forks on the GOLST. Class utilization is wrong
and Jobs may hang. TCO 5.1570 fixes part of the problem but not all of it.

Diagnosis: Null job time is charged to FILW is there are forks on the
GOLST. Since a necessary prerequisite for running is working set loaded
simply checking for a non empty GOLST does not insure that there are runnable
forks.

Solution: Check NBPROC instead of NGOJOB to determine if null job time is
to be charged to IDLE or FILW.

[End of TCO 5.1580]


TOPS20 Change Order Number 5.1581

Written by: PAETZOLD		15-Oct-81 16:44:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:
Related SPR's: 


Problem: 

OFN's are getting lost.

Diagnosis: 

Some code in DIRECT has the meaning of DRROF backwards.

Solution: 

Fix them to be correct.

[End of TCO 5.1581]


TOPS20 Change Order Number 5.1586

Written by: WACHS		16-Oct-81 10:57:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: Tape error records get overwritten on TM78s

Diagnosis: The TM does its own error repostioning. If the 
monitor decide that a write is a hard error, and the TM believes
that it is still a soft error, we will give up and return to the user
with the tape positioned before the error record. If the user
decides to keep on going, accepting the error, the failing record
will be overwritten. If the user gives up, an EOF will be
written over the failing record.

Solution: increase the error retry count to 55 (The microcode
will try up to 50 times on some flavors of error). Document
the retry-count definition so hackers won't decrease it without
being aware of the consequences.
NB This is a definition in PHYM78, does not effect the retry
algorithms in any other module.

[End of TCO 5.1586]


TOPS20 Change Order Number 5.1587

Written by: GRANT		19-Oct-81 10:02:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:	5.1490
Related SPR's: 


Problem: File transfer hangs when segment 7777 is reached.

Diagnosis: When the work for TCO 5.1490 was done, wrap around of segment
	numbers was inadvertently removed.

Solution: Do 12-bit arithmetic on segment number in VERSEG.
[End of TCO 5.1587]


TOPS20 Change Order Number 5.1591

Written by: PAETZOLD		20-Oct-81 20:59:08

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM	JSYSA

Related TCO's:
Related SPR's: 


Problem: 

Fork to file PMAPs leave the file in a bad state when the PMAP get interrupted
(eg quota exceeded interupt).

Diagnosis: 

The OFN is locked (SPTLKB) and the JFN is locked FILLCK.

Solution: 

MSETPT locks the destination OFN but unlocks the source OFN when cleaning up.
Fix MSETPT to unlock the destination OFN.

Calls to CPMAPX in PMAP0 will lock the JFN but we never unlock it.  Change the
MSETPT failure clean up code to unlock the JFN of needed.


[End of TCO 5.1591]


TOPS20 Change Order Number 5.1592

Written by: GRANT		21-Oct-81 09:32:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: ILLUUO BUGHLT.

Diagnosis: In LLSRVR, if the call to SQIACK gets a failure return, the
	LL block is no longer in T1.

Solution: Retrieve LL block from STKVAR before continuing.
[End of TCO 5.1592]


TOPS20 Change Order Number 5.1593

Written by: GRANT		21-Oct-81 09:38:55

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: System hung.

Diagnosis: NSP background task stuck in a loop in RESEND.  Based on a count,
	it believes it will find messages that need processing.  The count
	doesn't match the number of messages on the queue.

Solution: Add some defensive code to prevent the infinite looping.  Add a
	BUGCHK to indicate the mismatch between count and number of messages.
	This does not solve the real problem, i.e., the incorrect count, but
	will keep the system running and provide some information for more
	diagnosis.
[End of TCO 5.1593]


TOPS20 Change Order Number 5.1594

Written by: GRANT		21-Oct-81 09:55:54

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	ttphdv

Related TCO's:
Related SPR's: 


Problem: The procedure for dealing with R5 old DECnet and R5 new DECnet is
	too complicated.

Diagnosis: Too many modules require different versions.

Solution: Eliminate the need for 2 TTYSRVs.
[End of TCO 5.1594]


TOPS20 Change Order Number 5.1595

Written by: GRANT		21-Oct-81 14:17:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPPAR

Related TCO's:
Related SPR's: 


Problem: RSTS can't open a logical link to TOPS-20.

Diagnosis: TOPS-20 sending wrong NSP version number in connect message.

Solution: TOPS-20 should say it is NSP 3.2 instead of NSP 3.1.
[End of TCO 5.1595]


TOPS20 Change Order Number 5.1596

Written by: PAETZOLD		24-Oct-81 19:24:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PROLOG

Related TCO's:
Related SPR's: 


Problem: 

DEBUG conditionals are difficult to control without editing PROLOG.

Diagnosis: 

Values are hard coded.

Solution: 

Make DEBUG switch value definitions be INFDEFS with the default off.


[End of TCO 5.1596]


TOPS20 Change Order Number 5.1597

Written by: SOUTH		26-Oct-81 18:58:12

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: symbols for DN60 protocol defined in DTESRV

Diagnosis: 

Solution: move them to MONSYM

[End of TCO 5.1597]


TOPS20 Change Order Number 5.1598

Written by: SOUTH		26-Oct-81 19:00:23

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	monsym

Related TCO's:
Related SPR's: 


Problem: symbols for DN60 protocol in DTESRV not in MONSYM

Diagnosis: 

Solution: move them - related tco  #5.1597.
[End of TCO 5.1598]


TOPS20 Change Order Number 5.1599

Written by: GRANT		28-Oct-81 10:13:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: NTMAN% JSYS doesn't return an error if you try to execute it in
	Rlease 5.0.

Diagnosis: Code has been removed but the return mechanism hasn't been fixed.

Solution: Make NTMAN% return with "Undefined JSYS" should anyone try to execute
it.
[End of TCO 5.1599]


TOPS20 Change Order Number 5.1601

Written by: GRANT		30-Oct-81 13:38:55

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	params

Related TCO's:
Related SPR's: 


Problem: Can't DECnet host into a standard monitor.

Diagnosis: DECnet NVTs only defined in PARAM0.

Solution: Turn on NTTMCB in PARAMS.
[End of TCO 5.1601]


TOPS20 Change Order Number 5.1604

Written by: GRANT		 4-Nov-81 08:50:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: NSP attempts so send of inactivity link service traffic even
	after a disconnect has been sent.

Diagnosis: No coordination between a disconnect being sent and the
	background task's inactivity timer.

Solution: In NSPINA, don't do inactivity checking unless logical link is
	in the run state.
[End of TCO 5.1604]


TOPS20 Change Order Number 5.1605

Written by: GRANT		 4-Nov-81 10:32:23

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: ILLUUO BUGHLT

Diagnosis: After a SWPPTP BUGCHK the code does not correctly return to
	the caller.

Solution: Replace BUG with RET.
[End of TCO 5.1605]


TOPS20 Change Order Number 5.1607

Written by: GRANT		 6-Nov-81 10:13:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: ILLUUO BUGHLT

Diagnosis: In removing some temporary BUGHLTs, a JRST was accidently
	removed by mistake.

Solution: Put it back.
[End of TCO 5.1607]


TOPS20 Change Order Number 5.1608

Written by: MURPHY		 6-Nov-81 11:17:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK	PROLOG

Related TCO's:	5.1703
Related SPR's: 


Problem: Can't start monitor forks in non-0 section with MSFRK.

Diagnosis: Code never changed to handle extended address.

Solution: Change it.

[End of TCO 5.1608]


TOPS20 Change Order Number 5.1609

Written by: MOSER		 6-Nov-81 15:30:14

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: ILSRC Bughlt when user logs in.

Diagnosis: It is possible for VERACT to call MSETMP with a bad page
number if the accounting file is corrupted. This crashes system.

Solution: Make a new Bugchk ACTBAD which indicates a problem with the
accounting file instead of crashing the system and cause VERACT to fail for
the user.

[End of TCO 5.1609]


TOPS20 Change Order Number 5.1610

Written by: PAETZOLD		 7-Nov-81 13:12:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: 

BADTTY BUGHLT's.

Diagnosis: 

NTTMCB is on even when DCN is off.  Someone tries an MTOPR for a DECNET NVT
and the BUGHLT happens.  

Solution: 

Force NTTMCB to zero if DCN is off.


[End of TCO 5.1610]


TOPS20 Change Order Number 5.1611

Written by: WACHS		10-Nov-81 05:30:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYP4

Related TCO's:
Related SPR's: 


Problem: Bad blocks on an RP07 don't get marked in the BAT blocks.

Diagnosis: Operation incomplete is a header error on an RP07 and should
be marked in the BAT blocks. On an RP04/RP06 it is a device error and
should not be marked.

Solution: Test for OPI and RP07. Light IS.DTE if so

[End of TCO 5.1611]


TOPS20 Change Order Number 5.1612

Written by: DONAHUE		12-Nov-81 16:52:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 


Problem: PMAP will sometimes return a garbage error code

Diagnosis: When attempting to create a new page table for a file,
routine NEWFLS will call ASGPAG to assign a page in the JSB area.
If this area is full, NEWLFS gives an error return with no indication
of the error.

Solution: Have NEWLFS return error MONX02 if the call to ASGPAG fails.

[End of TCO 5.1612]


TOPS20 Change Order Number 5.1614

Written by: MOSER		16-Nov-81 15:04:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's: 


Problem: When CJ%ETF is set the monitor assumes CJ%FIL contrary to
documentation.

Diagnosis: No check.

Solution: Check and do the right thing.

[End of TCO 5.1614]


TOPS20 Change Order Number 5.1615

Written by: MURPHY		16-Nov-81 17:29:14

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: ERJMP following a failing memory reference sometimes
doesn't take and process gets "?Illegal write/read at ...".

Diagnosis: Microcode doesn't set PCS on a page fail, so monitor
doesn't see ERJMP.  It works only if PCS happens to be right from
previous JSYS.

Solution: Call SETPCV to setup previous context variables when
handling illegal reference.  Another possible solution would be
to fix the microcode.

[End of TCO 5.1615]


TOPS20 Change Order Number 5.1616

Written by: MURPHY		18-Nov-81 15:46:54

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: ILPAG1 BUGHLTS

Diagnosis: One fork unmapping a page while another fork is
doing DSKOP% on that page causes call to SWPOT0 with
page locked in core.  Could also happen with magtape 
dump i/o instead of DSKOP%.

Solution: Add check for page locked in MOVDSK, wait for
unlock.

[End of TCO 5.1616]


TOPS20 Change Order Number 5.1617

Written by: WACHS		23-Nov-81 07:22:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYP4

Related TCO's:
Related SPR's: 


Problem: RP06 disks don't act correctly when they are shared between
2 processors.

Diagnosis: When we connect to a drive we read the control register in order
to seize the drive to our port. On some (possibly all) RP06 drives this
does not seize the port. The other processor could grab the disk out from
under us after we thought we had gained control of it.

Solution: Write the drive-type register before doing anything else. This will
seize the drive if it is in A/B, put in a request to get the drive if it is
seized to the pther port

[End of TCO 5.1617]


TOPS20 Change Order Number 5.1618

Written by: DONAHUE		24-Nov-81 09:43:21

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 	 16948


Problem: If PS:<SYSTEM>'s logged-in quota is set to something other than
+INF, the quota cannot be changed to +INF.

Diagnosis: At system startup, PS:<SYSTEM>'s entry in ALOC2 is set to be
377777,,0 minus the current allocation of the directory, which is the
number of pages remaining before the directory goes over quota. Tops-20
does not even check the actual logged-in quota of <SYSTEM>. When trying
to change the quota, the monitor will subtract the new quota from the
logged-in quota and use that difference to update the ALOC2 entry. This
will only work if the ALOC2 entry was derived from the logged-in quota.

Solution: When determining the difference between the new and the old
quota, if the directory is currently open, use the ALOC2 entry plus the
current disk allocation of the directory to determine what the
previous quota was. Then subtract the new quota from this figure to
determine how much to update the ALOC2 entry.
[End of TCO 5.1618]


TOPS20 Change Order Number 5.1619

Written by: SOUTH		25-Nov-81 12:43:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: DN60 service sometimes overwrites 1 extra word in user data area.

Diagnosis: incorrect calculation of number of words to transmit back to user
when user supplied certain combination of arguments.

Solution: fix it.

[End of TCO 5.1619]


TOPS20 Change Order Number 5.1621

Written by: GRANT		 1-Dec-81 11:12:15

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: MONPDL BUGHLT

Diagnosis: Stack overflow due to monitor looping

Solution: In SETP6, the routine which checks for potential page pointer
	loops, change JRST SETP6 to JRST SETP6A
[End of TCO 5.1621]


TOPS20 Change Order Number 5.1623

Written by: MURPHY		 2-Dec-81 13:26:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: J0NRUN bughlts when running job which takes all of physical
core.

Diagnosis: Fork allowed to grow too large.  Insufficient free pages
to run fork or load others, system hangs.

Solution: Use BALSHC instead of GNPBAS in calculations in NICCKS
so as to account for unavailable pages (page tables primarily)
when determining maximum fork working set size.  This fix was
previously published as a patch to 3A but never made it to
the sources apparently.

[End of TCO 5.1623]


TOPS20 Change Order Number 5.1624

Written by: GRANT		 3-Dec-81 10:29:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: Customer can't define own terminal type without fear of DEC
	using that number in the future.

Diagnosis: We only reserve 4 terminal type numbers for customer use.

Solution: Increase the reserved types from 4 to 20.
[End of TCO 5.1624]


TOPS20 Change Order Number 5.1625

Written by: MURPHY		 3-Dec-81 10:44:08

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: When approaching an inactive terminal, users may expect
it to response to a carriage-return.  Carriage return will
be the required attention character on corporate terminal
concentrator front ends; it is desirable that the same character
may be used anywhere.

Diagnosis: TOPS20 only creates a job on ^C.

Solution: Treat CR (and LF) on inactive line as equivalent to ^C.

[End of TCO 5.1625]


TOPS20 Change Order Number 5.1626

Written by: GRANT		 4-Dec-81 08:33:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: NSP node init fails on some systems.

Diagnosis: TOPS-20 is not constructing the node init message properly when
	its node number is larger than 127(decimal).

Solution: Fix NODINI to make an extensible field for the node number.
[End of TCO 5.1626]


TOPS20 Change Order Number 5.1627

Written by: SOUTH		 4-Dec-81 19:14:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: "bad argument" errors returned sometimes by DN60 boot jsys when the
argument was,in fact, correct.

Diagnosis: a typo sent control to wrong label when exiting from a wait for
queue blocks.

Solution: fix typo.
[End of TCO 5.1627]


TOPS20 Change Order Number 5.1628

Written by: SOUTH		 5-Dec-81 00:23:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: DN60 protocol does nasty things if the front end dies while an 
operation is pending.

Diagnosis: dte data base page is returned to resident free space without
regard to possibility of pending operation.

Solution: set death flag and check this in scheduler tests. Release page only
when all pending operations have terminated.
[End of TCO 5.1628]


TOPS20 Change Order Number 5.1629

Written by: PAETZOLD		 5-Dec-81 21:05:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IMPDV

Related TCO's:
Related SPR's: 


Problem: 

Not enough IMP buffers.

Diagnosis: 

As above.

Solution: 

Increase NINBFS to ^D16.


[End of TCO 5.1629]


TOPS20 Change Order Number 5.1630

Written by: SOUTH		 7-Dec-81 11:15:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: error exits in DN60 protocol unwieldy.

Diagnosis: previous edit not thought out with suficient caare.

Solution: think carefully.
[End of TCO 5.1630]


TOPS20 Change Order Number 5.1631

Written by: CHALL		 9-Dec-81 17:12:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: DATE/TIME PARSING IN COMND READS ONE CHARACTER TOO MANY.
"SUBMIT FOO/AFTER:15-DEC-81/NOTIFY" FAILS, WHEREAS
"SUBMIT FOO/AFTER:15-DEC-81//NOTIFY" SUCCEEDS.

Diagnosis: THE IDTNC JSYS FORGETS TO BACK UP OVER THE TERMINATOR 
CHARACTER. IT ALWAYS HAS (SO DOES NIN, AND WHO KNOWS WHATALL OTHER JSYI).
FIXING IDTNC (AND FRIENDS) WOULD BE THE IDEA SOLUTION, BUT IT WOULD REQUIRE
A PERIOD OF SETTLING-IN TO SEE WHAT BREAKS. THIS MIGHT BE DONE FOR V6, BUT
IS INAPPROPRIATE AT THIS TIME FOR V5. THEREFORE:

Solution: IN COMND, AT XCMTAD:, REDUCE THE COUNT OF CHARACTERS IN THE 
DATE-TIME PARSED BY IDTNC BY ONE, WHICH WILL SERVE NOT TO INCLUDE THE
TERMINATOR CHARACTER IN THE DATE-TIME FIELD WHICH COMND RETURNS.

[End of TCO 5.1631]


TOPS20 Change Order Number 5.1632

Written by: SOUTH		 9-Dec-81 23:07:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: MCB and DN64 protocol initialize don't always succeed.

Diagnosis: dte hardware bug

Solution: dismiss process while waiting for doorbell. by the time it runs
again the good stuff has arrived.
[End of TCO 5.1632]


TOPS20 Change Order Number 5.1633

Written by: SOUTH		 9-Dec-81 23:10:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: need variables to hold wakeup time for new scheduler test created
in tco 5.1632.

Diagnosis: 

Solution: put in DTETMR block - one word per dte

[End of TCO 5.1633]


TOPS20 Change Order Number 5.1634

Written by: DONAHUE		11-Dec-81 09:26:19

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DIRECT

Related TCO's:
Related SPR's: 


Problem: After a structure has been dismounted, the OFN on its <ROOT-DIRECTORY>
remains active with a share count of one.

Diagnosis: Routine CHKBAK gets called at mount time and maps in a new directory
without unmapping the previous directory. The previous directory is always
<ROOT-DIRECTORY>.

Solution: Before mapping in a new directory in CHKBAK, check if a directory
is currently mapped, and if so, call RELOFN to release the OFN.

[End of TCO 5.1634]


TOPS20 Change Order Number 5.1635

Written by: PAETZOLD		11-Dec-81 13:50:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: 

System runs out of ARPANET NVT's when no one is using them.

Diagnosis: 

Terminal dynamic data is locked.  All network connections etc... are closed.

Solution: 

TELNET protocol negotiation causes a dismiss while TTY data base is locked.
The 4N host connections get closed while waiting for the negotiations.  The
fork is not NOINT and can be killed while waiting.  TTY data base is locked
and it will never be unlocked.

Cause fork to be NOINT doing STPAR jsysi and protocol negotiations.

[End of TCO 5.1635]


TOPS20 Change Order Number 5.1636

Written by: GRANT		13-Dec-81 10:20:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	NSPSRV

Related TCO's:
Related SPR's: 


Problem: Very difficult to change the NSP segment size.

Diagnosis: The value needs to be patched in more than one place if a change
	is needed;  this is too cumbersome.

Solution: Have NSP initialization store the value in a location from which
	all future users retrieve it.
[End of TCO 5.1636]


TOPS20 Change Order Number 5.1637

Written by: GROUT		15-Dec-81 11:53:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: Using the COMND JSYS: if any of CTRL/R, CTRL/U, CTRL/V, or CTRL/W
which are turned on in the user's CCOC mask is typed directly after a failing
command, and a .CMINI is done, the character is echoed and then its format
action (if any) takes place; if a command redo is possible, a CTRL/H typed
directly after a failing command to a .CMINI is echoed (if on in CCOC), and is
followed by a CR/LF, reprompt, and typeout of the correct fields from the last
command.
 Gratuitous SFCOC JSYS calls from COMND and TEXTI.

Diagnosis: Most input within COMND is done by an internal invocation of TEXTI,
which turns off echoing of CTRL/R, CTRL/U, CTRL/V, and CTRL/W; however, the
first character after a .CMINI, if a redo is possible, is read using the BIN
JSYS with TT%WAK set to wake on all characters so the first character can be
checked immediately.  If the first character wasn't a CTRL/H, a BKJFN is done,
and the .CMINI returns, so .CMINI echoes each of CTRL/R, CTRL/U, CTRL/V, and
CTRL/W which are on in the user's CCOC mask; if CTRL/H was typed, it is echoed
if turned on in the user's CCOC mask, then a CR/LF, reprompt, and the correct
fields from the last command are typed.  Even though CTRL/H is normally output
or simulated, it looks ugly when typed out by the .CMINI reparse, and if it
isn't echoed, .CMINI no longer needs to start a new output line after the
CTRL/H.
 COMND and TEXTI don't check to see if the CCOC bits are already correct before
issuing SFCOC JSYS calls.

Solution: Set CTRL/R, CTRL/U, CTRL/V, and CTRL/W to ignore at the top of the
COMND JSYS, so they will not be echoed by the BIN issued by a .CMINI.  Don't
bother to change the CCOC bits at TEXTI if TEXTI was called from COMND.  Set
CTRL/H to ignore before doing the BIN in the .CMINI function; note that CTRL/H
will not be turned off if no redo is possible (if the last command didn't fail,
or there were no correct fields in the last command).  Do not start a new output
line after the CTRL/H on a .CMINI redo.
 Skip over invoking SFCOC if the CCOC bits are already correct.

[End of TCO 5.1637]


TOPS20 Change Order Number 5.1639

Written by: CHALL		18-Dec-81 15:59:53

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND	MONSYM

Related TCO's:
Related SPR's: 


Problem: TCO 6.1036 NEEDS TO BE RETRO-FITTED INTO V5. IT DEFINES FLAG CM%NSF 
IN CM%FFL (THE FUNCTION FLAGS PORTION OF THE COMND FUNCTION DESCRIPTOR BLOCK).
IF CM%NSF IS SET FOR A DEVICE OR NODE NAME THE SUFFIX DOES NOT NEED TO BE 
TYPED.

Diagnosis: 

Solution: PUT IT IN

[End of TCO 5.1639]


TOPS20 Change Order Number 5.1640

Written by: GRANT		20-Dec-81 15:55:37

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: When RSX20F get restarted the "DECsystem-20 continued" message
	has "DECsystem" in mixed case;  it should be all upper case.

Diagnosis: 

Solution: Do it in upper case.
[End of TCO 5.1640]


TOPS20 Change Order Number 5.1641

Written by: WACHS		22-Dec-81 04:12:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYP4

Related TCO's:
Related SPR's: 


Problem: System hung

Diagnosis: If we try to use the front-end disk and it is in use
on the other port we write a read-only register in order to seize the
drive. If another drive gives an attention interrupt at the same time as
the interrupt for the seized drive we lose track of the attention on the
seized drive and don't restart it.

Solution: Tell PHYSIO that the seek is done when we get the attention
interrupt for the seize. The drive will not be on cylinder, but implied
seek will win.

[End of TCO 5.1641]


TOPS20 Change Order Number 5.1649

Written by: GRANT		 4-Jan-82 14:41:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	IO	PROLOG

Related TCO's:
Related SPR's: 


Problem: Try to send mail from VMS to TOPS-20 causes the link to break
	if a blank line is included.

Diagnosis: DECnet-20 can't handle null NSP segments.

Solution: It was never implemented.  Create a new bit in the FILSTS word
	for NSP null segments and check it in the appropriate places.
[End of TCO 5.1649]


TOPS20 Change Order Number 5.1650

Written by: GRANT		 5-Jan-82 09:33:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem:  DTEBAD BUGCHKs, RESCHK BUGHLTs, and other random occurences point
	to bad queue management in the DTE driver.

Diagnosis:  Not enough information to figure out what is going on.

Solution: Add some range checking and a sanity bit in ASGNOD, RELNOD, and
	DTSTRT.
[End of TCO 5.1650]


TOPS20 Change Order Number 5.1651

Written by: MAYO		 5-Jan-82 10:21:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DATIME

Related TCO's:
Related SPR's: 	 16978


Problem: IDTNC preceeded by FLIN gives ZONEX1 errors, dependent on what
number was FLIN'd.

Diagnosis: Any trash left the the LH of AC4 would get fed to an internal
JSYS in the middle of IDTNC, where it was used as flags and time zone
information. If it happened to be zero, no problem. FLIN'ing certain
values (notably 0.48) happened to put interesting things in AC4, and
a subsequent IDTNC promptly fell over.

Solution: A HRRI at IDTNC8:+13 should be a MOVEI, to make sure the flags
get properly zeroed in the cases when they should be. This may have
been a typo; HRRZI might have been the original intent.

[End of TCO 5.1651]


TOPS20 Change Order Number 5.1652

Written by: MILLER		 5-Jan-82 10:55:02

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: The CKINT done when a power fail interrupt is detected
can cause an illegal memory reference.

Diagnosis: CKINT expands to a CALL CKINT0. However, at this
point in the monitor, no stack has been established.

Solution: Don't use CKINT. Open code the equivalent expansion.

[End of TCO 5.1652]


TOPS20 Change Order Number 5.1653

Written by: MILLER		 5-Jan-82 16:54:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TAPE

Related TCO's:
Related SPR's: 


Problem: TAPE does not correctly handle the JFN being
reassigned while dismissed.

Diagnosis: As above. Code at MTFCN0 incorrectly manipluates
the JFN block even if the JFN has been reassigned.

Solution: If MTFCNC returns an error, don't fiddle with the JFN block.

[End of TCO 5.1653]


TOPS20 Change Order Number 5.1655

Written by: PAETZOLD		 6-Jan-82 14:40:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: 

Sendalls only show up on line type zero.

Diagnosis: 

AC is being trashed in TTMS20 for the TDCALL.

Solution: 

Save AC C around the TDCALL in TTMS20.

[End of TCO 5.1655]


TOPS20 Change Order Number 5.1656

Written by: GROUT		 6-Jan-82 17:07:07

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN

Related TCO's:
Related SPR's: 


Problem: When doing a parse-only GTJFN with logical name expansion suppressed,
(GJ%OFG and G1%SLN set), and device DSK: is specified, or no device or directory
is specified, and DSK: is defined, then the device for the JFN is arbitrarily
defined to be the connected structure, even though other structures may be
defined on DSK:.

Diagnosis: The case of DSK: being used and G1%SLN set (local flag NOLOGF) is
never considered, and so an arbitrary action is taken.

Solution: In routine CHKDSK, if NOLOGF is set, and logical name DSK: exists,
do not translate DSK:.  If DSK: does not exist, however, translate DSK: to
the connected structure.

[End of TCO 5.1656]


TOPS20 Change Order Number 5.1657

Written by: MILLER		 7-Jan-82 11:39:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC	monsym

Related TCO's:
Related SPR's: 


Problem: TCO 6.1053 needs to be in release 5 as well as release 6.

Diagnosis: As above

Solution: Merge the changes into rel. 5 as well.

[End of TCO 5.1657]


TOPS20 Change Order Number 5.1658

Written by: PAETZOLD		 7-Jan-82 21:34:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:	5.1680
Related SPR's: 


Problem: 

ILMMRF BUGHLTs from carrier off interrupts.  Under the following conditions:

o	The fork must have enabled interrupts to receive the carrier off 
	interrupt.

o	The fork must be in JSYS context at the time of the interrupt.

Diagnosis: 

When the fork was allready in JSYS context and the interrupt occurred the
call to JOBCOF and friends was done as normal subroutine call.  PIRLG1 is 
reseting PIFL to zero.  When the fork returns to the original jsys PCU is
off in the PC and terrible things happen on page faults.

Solution: 

Dont destroy PIFL for carrier off interrupts.


[End of TCO 5.1658]


TOPS20 Change Order Number 5.1659

Written by: TORREY		 8-Jan-82 13:43:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: WATCH cannot observe more than 80 jobs.

Diagnosis: There are not enough snoop pages in the monitor.

Solution: Increase the snoop pages fron 8 to 12 decimal.

[End of TCO 5.1659]


TOPS20 Change Order Number 5.1660

Written by: MURPHY		 8-Jan-82 16:31:37

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: JSLOOK doesn't work.

Diagnosis: JSLOOK uses SNOOP breakpoints.  Code in monitor changed
causing breakpoints to land in wrong place.

Solution: Put in tags for exclusive use of JSLOOK.

[End of TCO 5.1660]


TOPS20 Change Order Number 5.1661

Written by: MILLER		 9-Jan-82 18:22:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	MEXEC	APRSRV

Related TCO's:
Related SPR's: 


Problem: It is possible for the monitor to crash without
unlatching "corrected" memory errors.

Diagnosis: Neither the monitor nor TGHA unlatches a MOS double
bit error. In principle, this is TGHA's job, but that seems
unlikely to every come about.

Solution: Unlatch MOS controllers after TGHA runs.

[End of TCO 5.1661]


TOPS20 Change Order Number 5.1662

Written by: PAETZOLD		 9-Jan-82 19:31:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: 

FLKTIM BUGCHKs.

Diagnosis: 

CFORK jsys with CR%MAP.  Share count for superior fork page map overflow 
detected by MSETPT (called from CFK4).  ITRAP is generated.  However we 
had FKLOCK.

Solution: 

Unlock FKLOCK on error from MSETPT before generating ITRAP.


[End of TCO 5.1662]


TOPS20 Change Order Number 5.1665

Written by: PAETZOLD		11-Jan-82 15:12:19

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: 

TTLCK may be overly decremented causing succesive locks to unlock TTLCK.

Diagnosis: 

as above.

Solution: 

Create a new BUGHLT TTLOKB  that will detect bas TTLCK state in LKTTY and ULKTTY
and ULKTT.


[End of TCO 5.1665]


TOPS20 Change Order Number 5.1672

Written by: PAETZOLD		13-Jan-82 16:10:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: 

KL CRAM is crammed.

Diagnosis: 

Too many microinstructions used.  Somebody has to lose.  It will be GFLOAT.

Solution: 

Remove four GFLOAT instructions from the microcode.  Simulate GFIX, DGFIX,
GFIXR, and DGFIXR EXTEND instructions.  Make them so slow no one will want
to use them.

z
[End of TCO 5.1672]


TOPS20 Change Order Number 5.1673

Written by: PAETZOLD		13-Jan-82 16:13:15

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV	monsym

Related TCO's:
Related SPR's: 


Problem: 

misleading error message from BOOT jsys.  BOTX16 (11 boot program did not
make it to 11).

Diagnosis: 

as above.

Solution: 

Change BOTX16 to BOTX19 (overdue TO-11 transfer aborted).

[End of TCO 5.1673]


TOPS20 Change Order Number 5.1676

Written by: PLATUKIS		15-Jan-82 10:38:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: on a heavily loaded system sending and reading data messages time
out using the BOOT jsys.

Diagnosis: if the code testing for function done is swapped out when the time
interval expires, no test is made for function completion.

Solution: in dtesrv at tags RMDNL1 and DOPAG1 a test for function completion
is inserted after the time out has occured.

[End of TCO 5.1676]


TOPS20 Change Order Number 5.1677

Written by: PLATUKIS		15-Jan-82 10:46:37

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV	MONSYM	SERCOD

Related TCO's:
Related SPR's: 


Problem: misleading error reporting if a read MOP message function times out

Diagnosis: When a READ MOP message function fails several error bits may be set
	but at tag RMGRNC+1 a JFFO is used to map the error bits to an erstr #.
	Important error data is being lost because of this.

Solution: Redefine error bit .R1DPF to be 40 instead of 100000. Define a new
error symbol .R1RTM to be 100000. Map this new error bit to BOTX20 in MONSYM
with a string <Overdue TO-10 transfer aborted>.

[End of TCO 5.1677]


TOPS20 Change Order Number 5.1678

Written by: MILLER		15-Jan-82 12:46:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC	TTYSRV

Related TCO's:
Related SPR's: 


Problem: It is possible to get two or more jobs using the same
CTY.

Diagnosis: Numerous races in ATACH code and in TTY startup code

Solution: Add some NOSKEDs and some additional checks to
prevent the races.

[End of TCO 5.1678]


TOPS20 Change Order Number 5.1679

Written by: GRANT		15-Jan-82 15:03:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IPCF	PROLOG

Related TCO's:
Related SPR's: 


Problem: FLKTIM BUGCHKs.

Diagnosis: Fork A has the fork lock while trying to kill Fork B.
	However, Fork B is NOINT waiting for the PID lock, which is
	currently owned by another fork.  Fork B should not be NOINT
	while waiting.

Solution: Change the way all IPCF functions acquire the PID lock.
	If the lock is not available, go OKINT, DISMS for a bit,
	go NOINT and try for the lock again.
[End of TCO 5.1679]


TOPS20 Change Order Number 5.1680

Written by: PAETZOLD		16-Jan-82 13:46:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:	5.1658
Related SPR's: 


Problem: 

TCO 5.1658 was not quite right.  It causes PAGLCK BUGHLT's when the fork getting
the carrier off interrupt was in user mode.

Diagnosis: 

preserving PCU when it should not be preserved.

Solution: 

Remove TCO 5.1658.  Force PCU on only if we are simulating the COF interrupt 
with a pushj instead of a jsys.


[End of TCO 5.1680]


TOPS20 Change Order Number 5.1682

Written by: PAETZOLD		17-Jan-82 20:31:26

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: 

User causes an ILLX02 (illegal memory write) error with a MOVE instruction
to section greater than 37.

Diagnosis: 

Code in ILSN is testing TWWRT in the page fail word.  This test is not worth
to much as the page fail is of the hard type (1b1 on in page fail word).  In
a hard page fail we do not know what type of reference was involved.

Solution: 

Create and generate a new error (ILLX05 - Illegal memory reference, section
greater than 37).


[End of TCO 5.1682]


TOPS20 Change Order Number 5.1683

Written by: PAETZOLD		17-Jan-82 20:36:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: 

User references a non-existent section.  Even if the user issued a write 
reference to cause the page fault he still gets an ILLX01 (illegal memory
read) error.

Diagnosis: 

Code in GETTPD and GETT1G dont bother checking if the reference was a write.

Solution: 

Make GETTPD generate the correct error dispatch for the reference on a 
non-existant section reference.

[End of TCO 5.1683]


TOPS20 Change Order Number 5.1684

Written by: PAETZOLD		18-Jan-82 11:17:39

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: 

Page faults in scheduler context from DASALC and friends referencing OFNLEN.

Diagnosis: 

OFNLEN is not resident.  It has never been resident.  This problem has probably
existed since the begining of time.

Solution: 

Make OFNLEN resident.


[End of TCO 5.1684]


TOPS20 Change Order Number 5.1686

Written by: MURPHY		18-Jan-82 17:17:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: SPT full - prevents creating new jobs.

Diagnosis: Twofold: 1. SPT not large enough for numbers of jobs and
forks in largest configurations.  2. SPT allowed to become nearly
full of file pages thus preventing creation of new forks and jobs.

Solution: 1. Lower threshold for using indirect pointers instead
of share pointers for file pages.  This keeps more SPT slots in
reserve for fork special pages (PSB, UPT, stack) which can only
use SPT slots.  2. Increasing SPT size is NOT being done now
because of limited address space.

[End of TCO 5.1686]


TOPS20 Change Order Number 5.1687

Written by: PAETZOLD		19-Jan-82 07:59:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	COMND

Related TCO's:
Related SPR's: 


Problem: 

COMND and TEXTI dont allow OWGBPS.

Diagnosis: 

RDCBP doesnt check for OWGBPs.

Solution: 

Fix RDCBP to check for OWGBP's and allow them if jsys caller came from a 
nonzero section.


[End of TCO 5.1687]


TOPS20 Change Order Number 5.1688

Written by: MURPHY		19-Jan-82 11:40:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	TTYSRV	TTPHDV

Related TCO's:
Related SPR's: 


Problem: Excessive TTYSTP bugchks.

Diagnosis: Problem really is noisy lines.  However, system reports
such lines repeatedly which is annoying when the system administrator
has no intention of fixing the noisy lines.

Solution: Set flag for TTY line when first detected noisy.  Execute
bugchk only once (per system reload) for each noisy line.

[End of TCO 5.1688]


TOPS20 Change Order Number 5.1689

Written by: MILLER		19-Jan-82 14:56:46

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: Setting run time guarantee for a job with
multiple forks can overload the system

Diagnosis: The code assumes only one fork is active and
makes the wrong decisions if there are multiple running
forks.

Solution: Fix the dismiss code to check if other forks are
active and to not intialize the run time interval if so.

[End of TCO 5.1689]


TOPS20 Change Order Number 5.1690

Written by: HALL		19-Jan-82 15:59:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: 
Sometimes when the primary front end is reloaded, we call KILPAG in
section 0. That eventually leads to GDSTX, which can't be called in
section 0 because it references the DST in a non-zero section.

Diagnosis: 
DTSNGL enters section 0 using SE0ENT. Most of the time, it returns
after doing SE1CAL. But it sometimes goes to R, in section 0.

Solution: 
Make it use S0.ENT, which restores the context.

[End of TCO 5.1690]


TOPS20 Change Order Number 5.1691

Written by: PAETZOLD		19-Jan-82 21:35:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: 

ILFPTE BUGHLTs in STRTTO from TTCH7 and friends.

Diagnosis: 

Q1 and Q2 getting smashed causing a bad index into TTACTL on next iteration
of the loop in TTYQOC.


Solution: 

Save Q1 and Q2 around the STRTTO call in TTYQOC.


[End of TCO 5.1691]


TOPS20 Change Order Number 5.1692

Written by: GRANT		20-Jan-82 06:14:26

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: Incorrect testing as to when flow control should be sent.

Diagnosis: Some code was removed and what resulted was a TMNE followed
	by and INCR (which assembles into 2 instructions).

Solution: Recode.
[End of TCO 5.1692]


TOPS20 Change Order Number 5.1695

Written by: GRANT		22-Jan-82 06:25:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: Hung jobs and FLKTIM BUGCHKs.

Diagnosis: The process causing the problem has done a WAIT JSYS and is
	not interruptable but we don't know how it got into such a state.

Solution: Put a test in the beginning of WAIT to test INTDF and FKINT
	to make sure we are interruptable.
[End of TCO 5.1695]


TOPS20 Change Order Number 5.1696

Written by: WACHS		22-Jan-82 08:31:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	phym78

Related TCO's:
Related SPR's: 


Problem: Error file gets cloogged with entries 

Diagnosis: The TM78 can generate continuous errors which all get logged
in the error file

Solution: Count number of asynchronous errors. If over a maximum 
(currently 8) stop the TM. If IO is attempted on the TM restart
the microcode and get 8 more interrupts before declaring the TM
dead again

[End of TCO 5.1696]


TOPS20 Change Order Number 5.1697

Written by: MURPHY		22-Jan-82 12:23:30

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK	MEXEC	SCHED

Related TCO's:
Related SPR's: 


Problem: RMS cannot be used in a non-0 section.  Ditto PA1050.

Diagnosis: 1. Entry vector specification limited to 18 bits.
2. Section 0 always used when RMS or PA1050 loaded automatically.

Solution: 1. Implement 2 new JSYSes to allow setting and
getting of 30-bit entry vector address.  2. Look for
alternate EXE files names (XRMS.EXE or XPA1050.EXE).  If found,
load into first unused non-0 section and set entry vector
accordingly.

XSSEV% - Extended set special entry vector
XGSEC% - Extended get special entry vector.

See DOC:XSSEV.MEM.

[End of TCO 5.1697]


TOPS20 Change Order Number 5.1699

Written by: PAETZOLD		22-Jan-82 15:30:40

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	MONSYM

Related TCO's:
Related SPR's: 


Problem: 

Monitor and exec dont know about VT125 and VK100.

Diagnosis: 

as above.

Solution: 

Add VT125 and VK100 support to the monitor.

[End of TCO 5.1699]


TOPS20 Change Order Number 5.1702

Written by: WALLACE		26-Jan-82 10:00:06

Edit checked: YES			   Document: NO
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: The .POLOC function of the PDVOP% JSYS does not return the
number of PDVA's available from the call.

Diagnosis: The code sets up properly the number available in the left
half and the actual number returned in the right half of an AC.  But
then when the code gives the values back to the user it does an
XCTU [HRRM], thus only returning one of the values (i.e. the one in
the right half).

Solution: Do a full word move to memory (i.e. UMOVEM).

[End of TCO 5.1702]


TOPS20 Change Order Number 5.1703

Written by: WALLACE		26-Jan-82 15:55:16

Edit checked: YES			   Document: NO
  TCO Tested: YES		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:	5.1608
Related SPR's: 


Problem: SFRKV% starts forks at wrong address if entry vector address
contains a non-zero section number and the entry vector is TOPS-10
style.

Diagnosis: Previous Context Section (PCS) is not initialized properly.
As it stands now, PCS is just set to zero.

Solution: Before starting fork, set PCS to section number of the entry
vector address.

[End of TCO 5.1703]


TOPS20 Change Order Number 5.1704

Written by: WACHS		27-Jan-82 06:47:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYX2

Related TCO's:
Related SPR's: 


Problem: The device type byte in a magtape UDB is wrong for a TU73 -
it is reported as a TU72

Diagnosis: No code to set .UTT73

Solution: add code

[End of TCO 5.1704]


TOPS20 Change Order Number 5.1705

Written by: PAETZOLD		27-Jan-82 10:33:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: 

BUGCHK and BUGINF are invalid when a breakpoint is reached for BUGCHKs 
and BUGINFs.

Diagnosis: 

BUGCHK and BUGINF calling sequences have changed.  They used to use JSRs 
but now they use PUSHJs.

Solution: 

Save the BGCCHK and BGCINF caller addresses in BUGCHK and BUGINF.

[End of TCO 5.1705]


TOPS20 Change Order Number 5.1706

Written by: WALLACE		27-Jan-82 15:07:47

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: The XGTPW% JSYS has three problems.

1) The virtual address of the page trap is incorrectly returned
2) The MUUO flags are returned instead of the MUUO OpCode
3) The call returns one less word than the user requests

Diagnosis: In returning the page trap address, the code mistakenly
clears the left six bits of the in-section address.  As stated
above, the code picks up the MUUO flags when it intends to pick
up the MUUO OpCode.  And the count for number of words to return
to the user is off by one.

All these mistakes were found in three out of eight instructions.
Folks, that's 37.5%.  Let's hope that far less than 37.5% of the
entire Monitor contains mistakes.

Solution: Rather than trying to clear the page failure bits, just
use LOAD macro with appropriate symbol to fetch virtual address
of page trap.  Get MUUO OpCode from right half of word.  Change
decrement of counter so count won't be off by one.

[End of TCO 5.1706]


TOPS20 Change Order Number 5.1709

Written by: WALLACE		28-Jan-82 16:25:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILMSC

Related TCO's:
Related SPR's: 


Problem: Doing output to a terminal universal device designator
(i.e. 600000+.DVTTY,,terminal number) fails.

Diagnosis: The routine TTYOUT assume TTY designators come in
two flavors: a JFN or 0,,.TTDES+terminal number.  In fact
the universal device designator is still legal for terminals.
The code mistakenly assumed that the universal device designator
was a JFN.

Solution: Check for universal device designator and transfer
to code that assumes it has a TTY device.

[End of TCO 5.1709]


TOPS20 Change Order Number 5.1710

Written by: WACHS		29-Jan-82 05:11:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	phym78

Related TCO's:
Related SPR's: 


Problem: SPEAR reports all TU78s as slave 0

Diagnosis: UDBSLV not set up

Solution: set it up

[End of TCO 5.1710]


TOPS20 Change Order Number 5.1711

Written by: GRANT		 1-Feb-82 08:59:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: DTEBAD BUGCHKs.

Diagnosis: It appears that an old queue packet header is still in use.

Solution: To help verify this assumption, zero the packet header when it is
	assigned.
[End of TCO 5.1711]


TOPS20 Change Order Number 5.1715

Written by: PLATUKIS		 2-Feb-82 10:18:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: Protocol initilization fails on loaded TOPS-20 systems.

Diagnosis: If the loops at DTINM1+1 and DTINM2+1 are swapped out at the time
the operation timer expires, the initilization will fail.

Solution: To add code to the loops at DTINM1+1 and DTINM2+1 to test if the
operation succeded once the time limit expires before declaring the operation
a failure.

[End of TCO 5.1715]


TOPS20 Change Order Number 5.1716

Written by: GROUT		 2-Feb-82 15:03:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FILMSC	IO	JSYSF

Related TCO's:
Related SPR's: 


Problem: Passing a TTY: device designator of the form 600000+.DVTTY,,Line #
to BIN, SIN, SOUT, and ERSTR doesn't work: with SOUT, it can cause ILLIND and
ILMNRF BUGHLT's.

Diagnosis: No code exists to check for this type of designator, except for
BOUT (due to TCO 5.1709); however, checking at the FILMSC TTY-dependent level
(TTYIN, TTYOUT, etc.), as TCO 5.1709 does, is too late, since the other cases
can blow up before they reach down that far.  For example, passing a TTY
designator of this type to SOUT causes a byte pointer to be constructed with
random garbage in the left half instead of the left half of the window pointer:
usually, the garbage is zero, but if it isn't, things like ILLIND and ILMNRF
happen.

Solution: After each CALL CHKJFN in the code handling BIN, SIN, BOUT, SOUT, and
ERSTR, if the +2 return (TTY designator) was made, translate a 600000+.DVTTY
type designator to the other kind in AC JFN (for internal use only).  Remove
the code added to TTYOUT to check for this, since it is no longer necessary.

[End of TCO 5.1716]


TOPS20 Change Order Number 5.1720

Written by: SOUTH		 5-Feb-82 15:45:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: DN60 protocol hangs under heavy system load while running 4 or more lines.

Diagnosis: Race condition caused an 11 doorbell to be ignored as spurious.

Solution: Remove the race.

[End of TCO 5.1720]


TOPS20 Change Order Number 5.1721

Written by: LEACHE		 6-Feb-82 13:34:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: NODE Jsys is returning updated byte pointer to current user section
of execution, and not to section specified in NODE call.

Diagnosis: NODE is doing halfword addressing for function .NDGLN.

Solution: Change

NDGLN:	UMOVE T2,2		;GET ADDRESS OF USER'S ARGUMENT BLOCK
	UMOVE T1,.NDNOD(T2)	;GET BYTE POINTER TO DEPOSIT NODE NAME
	MOVEI T3,NDNOD(T2)	;GET ADDRESS TO RETURN UPDATED BYTE POINTER


	  to:


NDGLN:	UMOVE T2,2		;GET ADDRESS OF USER'S ARGUMENT BLOCK
	UMOVE T1,.NDNOD(T2)	;GET BYTE POINTER TO DEPOSIT NODE NAME
	MOVE T3,T2		;KEEP 30-BIT ADDRESS IN T3 FOR RETURNING
				; UPDATED BYTE POINTER


[End of TCO 5.1721]


TOPS20 Change Order Number 5.1723

Written by: PAETZOLD		 8-Feb-82 10:01:01

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:	5.1727
Related SPR's: 


Problem: 

ILLGO BUGHLT's.  

Diagnosis: 

This bug is tickled by the read after write code.  In SIOx and friends
it is possible to append an IORB to the TWQ and then call STRTIO for 
that IORB.  If the TWQ has entries other than the IORB just added an
ILLGO may result.


Solution: 

Change code in SIO5 to call STRTIO with the head of the TWQ in P4.


[End of TCO 5.1723]


TOPS20 Change Order Number 5.1724

Written by: GRANT		 9-Feb-82 08:28:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's: 


Problem: System runs out of DECnet resident free space.

Diagnosis: When links are aborted (CLOSF with CZ%ABT) the logical link
	block is disposed of but any messages currently associated with
	the link are not freed.  In retro-fitting R5 work back into a
	R4 NSPSRV a line of code got lost.

Solution: Get rid of all messages immediately when a link is aborted.
[End of TCO 5.1724]


TOPS20 Change Order Number 5.1725

Written by: DONAHUE		 9-Feb-82 10:49:38

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	GTJFN	monsym

Related TCO's:
Related SPR's: 


Problem: In the long form GTJFN, if the user supplies a null string for
the default directory, a parse-only will succeed but a non-parse-only will
fail. When the parse-only succeeds, a subsequent JFNS will return "<>" in
the directory field. This field is basically useless.

Diagnosis: The routine to read the default string from the user will terminate
on any character that is not legal in the directory name. If the user's
default directory string started with "<", a null string will be generated.
The two cases (parse-only and non-parse-only) should really be compatible at
this level.

Solution: Check the default string returned by routine REDFLT. If it is null,
return error GJFX54 - Null directory name given.

[End of TCO 5.1725]


TOPS20 Change Order Number 5.1726

Written by: MURPHY		 9-Feb-82 14:55:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: PM%ABT fails to abort changes made to new pages in
new files.

Diagnosis: Code not checking for new pages.

Solution: Add code around REMFP2 to detect this case and
delete the page.  (Easier said than done of course, many
possibilities for bugs here.)  This edit originally
installed 22-Jan-81 and reported in DBMS V6 beware file,
but was not TCO'd at that time.

[End of TCO 5.1726]


TOPS20 Change Order Number 5.1727

Written by: PAETZOLD		11-Feb-82 16:22:47

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYSIO

Related TCO's:	5.1723
Related SPR's: 


Problem: 

Read after write (or more realistically skip after write) doesnt work.  
The following BUGHLT's result.

ILLGO's
ILUST3's
ILCHS2's


Diagnosis: 

DONIRB requeues IRFWVC IORBs with function code IRFRVC.  DONIRB then calls
SIO and friends to start up on the IORB.  An SIO call from DONIRB confuses
the rest of PHYSIO so that unit, channel, and backup register states are 
very messed up.


Solution: 

Dont call SIO from DONIRB.  Put the IRFRVC IORB onto the TWQ.  Also dont let
an IRFRVC IORB count against the UDB fairness count.  Also turn off IS.DON in
the IRFRVC IORB to prevent confusing other software engineers.  

Enabling read after write causes about a 25% lossage in disk write bandwith.
(eg.  from 130 Pgs/sec to about 100 Pgs/sec.)


[End of TCO 5.1727]


TOPS20 Change Order Number 5.1728

Written by: MILLER		11-Feb-82 16:48:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	STG	APRSRV

Related TCO's:
Related SPR's: 


Problem: Bug fix to release 6 to:

	1. Make sure non-vectored PI routines have a stack

	2. Make PI 6 non-vector code assembly correctly

were never put into 5.

Diagnosis: The QAR indicating a PIPTRP BUGHLT is fixed by these
edit.

Solution: Make them to release 5.

[End of TCO 5.1728]


TOPS20 Change Order Number 5.1729

Written by: GRANT		12-Feb-82 15:18:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG	NSPSRV

Related TCO's:
Related SPR's: 


Problem: R5.1 is out os address space.

Diagnosis: Need to get rid of excess baggage.

Solution: Don't load NSPINT.
[End of TCO 5.1729]


TOPS20 Change Order Number 5.1730

Written by: MURPHY		12-Feb-82 16:52:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: Erratic scheduling.  Jobs which do heavy disk IO
or page faulting have elapsed time disproportionately
extended if there are compute-bound jobs on the
system also.  May be other symptoms as well.

Diagnosis: 1. AC holding scheduler flags being clobbered
causing scheduler always to favor compute-bound jobs
when setting interval timer.
2. Completion of disk IO does not cause rescheduling to
job that was previously stopped if compute bound job
on same queue now running, even if previous job of
higher priority.

Solution: 1. Restore flags AC.
2. Change CAML to CAMLE in APSKED when deciding if current
job might be rescheduled.

[End of TCO 5.1730]


TOPS20 Change Order Number 5.1731

Written by: LSCD		16-Feb-82 11:57:17

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: 

Diagnosis: 

Solution: 
[End of TCO 5.1731]


TOPS20 Change Order Number 5.1733

Written by: MURPHY		18-Feb-82 18:03:25

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: Documentation says .TTATE terminal data mode disables
translation of output.  However, ESC is still printed as "$".

Diagnosis: ESC treated specially, no check for mode .TTATE.

Solution: Add code to detect that case.

[End of TCO 5.1733]


TOPS20 Change Order Number 5.1734

Written by: PLATUKIS		19-Feb-82 10:45:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	ttphdv

Related TCO's:
Related SPR's: 


Problem: There is an inconsistancy in the use of the FLOHLD constant between
TTPHDV and NSPSRV.

Diagnosis: When the FLOHLD constant is modified different results occur in the
requesting of Link-Service messages. NSPSRV requests more segments when the
input queue ( LLLSC ) exceeds FLOHLD number of entries. TTPHDV requests more
segments when the input queue ( LLLSC ) depth is greater than or equal to
the maximum depth( MAXSG1) minus FLOHLD.

Solution: At location MCTYIZ+1 change the line from CAIGE T3,MAXSG1-FLOHLD to
read CAIG T3,FLOHLD. 

[End of TCO 5.1734]


TOPS20 Change Order Number 5.1735

Written by: PAETZOLD		24-Feb-82 11:40:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	bugs	APRSRV	DTESRV

Related TCO's:
Related SPR's: 


Problem: 

KL microcode 275 now saves the IOP word from IO Page Fails in the page fail
word location in the EPT.  It also saves it in AC block 7 AC 2.  ACB 7 AC 2
used to contain the page fail word itself.  The page fail word from an IOPGF
will no longer be available to us from the microcode.

IOPGF analysis currently uses the page fail word to determine if certain 
nasty devices (eg DTEs, AN20) caused the IOPGF.  It also outputs the page fail
word to the CTY.


Diagnosis: 

as above.


Solution: 

Change the IOPGF ananlysis code to output the IOP word and not the PFW word
on an IOPGF.  The address fields of both the IOP and PFW words are the same 
so code that uses the address' still works.

N.B.

If an IOPGF should happen to occur while the monitor is processing a page 
fault and during the time which TRAPS0 is vulnerable (ie. until it is saved
in TRAPSW) wierd, terrible, and attrocous things will happen to the monitor
and probably cause a crash.  This is also true for AR/ARX parity errors and 
any other error that gets returned via a page fault.


[End of TCO 5.1735]


TOPS20 Change Order Number 5.1737

Written by: DONAHUE		25-Feb-82 10:51:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC	JSYSF

Related TCO's:
Related SPR's: 


Problem: The CHECK BITTABLE and REBUILD BITTABLE commands to CHECKD cause
the pages taken up by a subdirectory file to be charged to the superior
directory.

Diagnosis: Two problems: When changing the number of pages in a file with
the CHFDB, the monitor does not bother to change the directory's allocation.
CHECKD issues the CHFDB if, after scanning an index block, it notices that
the page count in the FDB is wrong.
Also, when closing a disk file, routine RELOFN returns a count of the number
of pages in a file. The CLOSF will then update both the count of pages in the
file's FDB and the directory's allocation. This should not be done if the file
happens to be a directory file.

Solution: In DISC, don't update the page count and directory allocation if we
are closing a directory file. In JSYSF, if a CHFDB has been executed to update
a files page count, also update the directory's allocation to reflect the
file's new page count

[End of TCO 5.1737]


TOPS20 Change Order Number 5.1738

Written by: PLATUKIS		25-Feb-82 16:33:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: The in transit bit (CMTOT) is set on a TO-10 transfer and never
cleared when TO-10 done if MCB protocol is used.

Diagnosis: CMTOT stays lit in the COMM region forever....

Solution: Clear the CMTOT bit in the COMM region in routine DN10MC.

[End of TCO 5.1738]


TOPS20 Change Order Number 5.1739

Written by: PAETZOLD		25-Feb-82 16:56:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NETWRK

Related TCO's:
Related SPR's: 


Problem: 

NETBAU BUGHLTs.

Diagnosis: 

ASNTBF gets hurt by the fact that the NETFRE buffer chain has been smashed.
If the buffer pointed to by NETFRE is the last buffer in its chain ASNTBF 
sets the new NETFRE pointer to be 5,,0 instead of 0,,0.  The next time through
ASNTBF we insert a buffer size into location 5,,0 (this creates a page).  The
next time through ASNTBF we get a NETBAU.  This bug has existed since the 
ARPANET buffers moved to a non-zero section.


Solution: 

At ASNTBF+14 if the right half of T2 is a zero then dont set the left half 
to ANBSEC.  This will insure that NETFRE is a zero and the code will behave
correctly.


[End of TCO 5.1739]


TOPS20 Change Order Number 5.1740

Written by: WACHS		26-Feb-82 08:43:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: Can;t talk to TU78s after the diagnostic does a strange
thing

Diagnosis: Diagnostic sets the only bit which can prevent the TM from 
interrupting. The monitor assumes that the TM will always interrupt.

Solution: Check the bit

[End of TCO 5.1740]


TOPS20 Change Order Number 5.1741

Written by: GRANT		 1-Mar-82 09:36:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's: 


Problem: Debugging BUGHLT in DTESRV.

Diagnosis: There's a bug in the debugging code.

Solution: Check for forward pointer of 0 when assigning a packet.  0 is
	legal when the last packet is being assigned.
[End of TCO 5.1741]


TOPS20 Change Order Number 5.1742

Written by: PAETZOLD		 3-Mar-82 15:20:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's: 


Problem: 

OFNJFN can sometimes find a JFN for an OFN that is incorrect.

Diagnosis: 

It is possible for the index block address of a jfn's page table to be the
same as the index block address of another jfn (on another structure).  If this
is true OFNJFN will find the wrong JFN.


Solution: 

Check structure for jfn and ofn to see if they match.  If they do not this is
not our jfn.


[End of TCO 5.1742]


TOPS20 Change Order Number 5.1743

Written by: COBB		 4-Mar-82 12:05:23

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's: 


Problem: CODE ALLOWED SIMULTANEOUS ACCESS WHEN IT SHOULDNT HAVE

Diagnosis: ACCESS BITS WERE NOT UPDATED CORRECTLY AFTER INITIAL OPEN

Solution: UPDATE THEM....ADD A MOVEM T1,SPTH(Q1) AT THE RETSKP RETURN IN
ROUTINE CHKACC OF PAGEM (3M FOUND THIS ORIGINALLY)

[End of TCO 5.1743]


TOPS20 Change Order Number 5.1744

Written by: MURPHY		 4-Mar-82 13:47:32

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC	MONSYM

Related TCO's:
Related SPR's: 


Problem: Too much clutter on user terminals from system messages
such as "swapping space low", etc.

Diagnosis: Code assumes everyone always needs to know all
this.  Should allow system administrator to have some control
over what system messages are sent to users.

Solution: 
Implement bits in SMON to control sending of system messages.
Separate messages into various classes (initially 2) which
can separately be enabled or disabled by the system
administrator.

There are various advisory messages sent by the system to
all terminals.  These are divided into two categories,
less important (level 0) and more important (level 1).
The system administrator can suppress the sending
of either or both message levels by use of SMON functions.

The following messages are level 0:

  1. Swapping space low.
  2. SPT space low.
  3. PS: space low.

The following messages are level 1:

  1. Shutdown messages for a shutdown more than 5 minutes away.
  2. PS: automatic expunge.

The following messages are always sent:

  1. Initial shutdown message and automatic shutdown announcements
	for shutdown 5 minutes or less away.

(Note: this change implemented June 1980, but TCO missing.)

[End of TCO 5.1744]


TOPS20 Change Order Number 5.1745

Written by: PAETZOLD		 4-Mar-82 23:21:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: 

MONPDL BUGHLTs while using DTESKP.

Diagnosis: 

Addition of "new and improved" subroutine calling sequences use up more stack
space.  As a side issue it might be interesting to determine how much extra
time the "new and improved" calling sequences use up since they are being used
at DTE interrupt level.


Solution: 

Increase size of DTESKP.


[End of TCO 5.1745]


TOPS20 Change Order Number 5.1746

Written by: PAETZOLD		 5-Mar-82 01:47:29

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NETWRK

Related TCO's:
Related SPR's: 


Problem: 

ILMNRF and ILFPTE BUGHLTs after a NETRBG BUGCHK.


Diagnosis: 

Code JRSTs into a literal to do the BUGCHK and then does a RET.

Solution: 

Fix the code.

[End of TCO 5.1746]


TOPS20 Change Order Number 5.1747

Written by: WACHS		 5-Mar-82 05:51:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	phym78

Related TCO's:
Related SPR's: 


Problem: FORTRAN V7 test program doesn't work on TU78s

Diagnosis: If the tape is at BOT, and the 1st record on the tape is
not a full page, the word count is not stored in the IORB.

Solution: Reset Q1 on sense after reading 1st record of tape

[End of TCO 5.1747]


TOPS20 Change Order Number 5.1748

Written by: WACHS		 5-Mar-82 06:00:07

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	phm78	globs

Related TCO's:
Related SPR's: 


Problem: All the drives on a TM78 become unusable after the TM is powered
down and powered back up again

Diagnosis: The periodic controller check gets a Register Access Error
since the unit is now non-existant. In clearing the RAE it leaves the
RH not enabled for attention interrupts. When the TM78 is powered up
again it generates an attention, but we don't get the interrupt. The TM78
does wierd things if we try to use it while it has a pending attention
interrupt, so the operation we try to start doesn't complete. The overdue
timer sees the error, gives an OVRDTA BUGINF, clears the channel status
and the unit status, but leaves the controller busy (for eternity). The
TM and all its units are now gone until the system is reloaded.
Comment: There are 2 PHYSIO/PHYH2 bugs here, which I'm afraid to fix
this close to monitor ship

Solution: Remove periodic check from TM78. Check when we go to start
the IO. If we see the TM not there, call CLRCHL in PHYH2 to reset
attention interrupt enable.

[End of TCO 5.1748]


TOPS20 Change Order Number 5.1749

Written by: PAETZOLD		 6-Mar-82 14:12:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	params

Related TCO's:
Related SPR's: 


Problem: 

Many ARPA sites are running low on ARPANET buffers.  IMPABF BUGINFs result.

Diagnosis: 

NNTBFS should be higher.  

Solution: 

Increate NNTBFS from 60000 to 100000.  This has no impact on monitor address
space or on available memory.  This will allow more ARPANET buffers if a 
system needs them.


[End of TCO 5.1749]


TOPS20 Change Order Number 5.1750

Written by: PAETZOLD		 6-Mar-82 20:25:33

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IMPDV	NETWRK	TTYSRV	bugs

Related TCO's:
Related SPR's: 


Problem: 

IMPABF BUGCHK'S endlessly.  ARPANET interface becomes totally wedged.

Diagnosis: 

We sometimes get to IMPB04 when we have locked NCPLCK.  We can never recover
from this.  Detect this situation and force NCPLCK unlock.  Fix routines 
guilty of this.


Solution: 

Add a BUGCHK to detect this deadly embrace situation.  If we detect it then
force NCPLCK to be unlocked.  Also fix code that causes this.  IMPALL is a 
major culprit.  Change IMPALL to unlock NCPLCK before calling IMPSCM.  Change
code that uses IMPALL to not unlock NCPLCK after calling it.

[End of TCO 5.1750]


TOPS20 Change Order Number 5.1751

Written by: PAETZOLD		11-Mar-82 11:23:54

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: 

?Illegal channel 0 interrupt messages from the exec when a start command
is issued after an execute command.


Diagnosis: 

The monitor is confusing the EXEC about the PA1050 entry vector.  On a RESET
and XSSEV jsys the PA1050 entry vector length is not being cleared.  This 
confuses the exec and causes it to issue an interrupt on channel zero.


Solution: 

Zero PATLEV as well as PATADR in SEVC and RSTFK.

[End of TCO 5.1751]


TOPS20 Change Order Number 5.1753

Written by: PAETZOLD		12-Mar-82 14:33:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:	5.1766
Related SPR's: 


Problem: 

PAGLCK BUGHLTs after a JOBCOF interrupt.

Diagnosis: 

Logout at SJLOG4 tries to use PMAP to delete user section zero.  However the
PC is currently in section one.  PMAP tries to default the section number to
one.  The PMAP fails.  We we are about to finally blow the job away it still
has pages and we get a PAGLCK.

Solution: 

Turn on PM%EPN in AC3 of the PMAP call to force it to do what we want.

[End of TCO 5.1753]


TOPS20 Change Order Number 5.1754

Written by: COBB		15-Mar-82 17:36:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's: 


Problem: SKED% JSYS DOES NO ARG CHECKING WHEN SETTING A JOB TO A CERTAIN CLASS
(EG. CLASS N FOR SOME HUGE N CAN BE SET)

Diagnosis: NO CODE

Solution: CHECK FOR 0 < CLASS <= MAXCLS
[End of TCO 5.1754]


TOPS20 Change Order Number 5.1755

Written by: PAETZOLD		16-Mar-82 20:08:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	impanx

Related TCO's:
Related SPR's: 


Problem: 

IMPANX only sends two NOPs when it should send three.  This occurs after
the ready line has changed state to on.

Diagnosis: 

Code is wrong.


Solution: 

Make it correct.


[End of TCO 5.1755]


TOPS20 Change Order Number 5.1756

Written by: PAETZOLD		16-Mar-82 20:17:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's: 


Problem: 

ARPANET host name table has increased again.  NHOSTS is not big enough.  
Although I would rather see the nicknames removed the ARPANET and NIC 
folks do not agree.

Diagnosis: 

As above.


Solution: 

Increase NHOSTS from 251 to 397


[End of TCO 5.1756]


TOPS20 Change Order Number 5.1757

Written by: PAETZOLD		16-Mar-82 20:23:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 

Clearing address break in your own fork does not work.

Diagnosis: 

Fork handle not being restored for call to SETLFX.

Solution: 

Restore it.  This was reported to be fixed in 4 but it is not in 5.

[End of TCO 5.1757]


TOPS20 Change Order Number 5.1758

Written by: PAETZOLD		16-Mar-82 20:27:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 


Problem: 

SFTAD doesnt check for negative counts.

Diagnosis: 

As above.

Solution: 

Check SFTAD length and generate ILLX01 if bad.

[End of TCO 5.1758]


TOPS20 Change Order Number 5.1759

Written by: PAETZOLD		16-Mar-82 20:48:19

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 

NULQTA BUGHLTs.

Diagnosis: 

PMAP does not check if JFNs are OPEN (believe it or not).  If a JFN is closed
but not released succesive PMAPs attempt to suceed.  A NULQTA occurs because
what the monitor believes is the OFN does not have an ALOCX entry.

Solution: 

Fix the code to verify open jfn.

[End of TCO 5.1759]


TOPS20 Change Order Number 5.1760

Written by: PAETZOLD		18-Mar-82 01:07:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 

ARPANET connection data does not get cleared on a RESET jsys.  It does get 
cleared in KSELF however.  This can cause NETSRV hangs as well as other
undesirable effects.  Although it may seem trivial a NETSRV hang is a 
terrible problem to ARPANET sites like RADC-TOPS20 which have only
arpanet virtual terminals.

Diagnosis: 

Oversight.

Solution: 

Add call to NETKFK in RESET JSYS code.

[End of TCO 5.1760]


TOPS20 Change Order Number 5.1761

Written by: PAETZOLD		18-Mar-82 03:19:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: 

ILMNRF bughlt from bad scheduler test.

Diagnosis: 

Bad call of LOKK macro at SCTSET in fork.

Solution: 

Correct it.

[End of TCO 5.1761]


TOPS20 Change Order Number 5.1763

Written by: PAETZOLD		18-Mar-82 19:57:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 

PMAP gives illegal instruction interrupt when disk full instead of disk full
interrupt.

Diagnosis: 

Code doesn't check for disk full errors in PMAP77.  Other IO JSYS's do.

Solution: 

Add code to generate .icqta interrupt in PMAP77 if error was disk full.

[End of TCO 5.1763]


TOPS20 Change Order Number 5.1764

Written by: PAETZOLD		19-Mar-82 15:33:56

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: 

ILFPTE and other BUGHLTs.  

Diagnosis: 

Code in PFAID uses full word references off PFCODT to dispatch to 
handling locations.  This used to be ok.  However now we run in 
section one and it is not good.

Solution: 

Convert PFCODT to full word table and use HRRZ's for references.

[End of TCO 5.1764]


TOPS20 Change Order Number 5.1766

Written by: PAETZOLD		20-Mar-82 19:37:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:	5.1753
Related SPR's: 


Problem: 

TCO 5.1753 was supposed to fix PAGLCK BUGHLTs from the PMAP in KSELF0 failing
due to code running in section one.  Unfortunatly it assumed that PM%EPN worked.
It doesnt work.

Diagnosis: 

As above.


Solution: 

Also turn on FH%EPN in fork handle for now.  PM%EPN will be fixed later.


[End of TCO 5.1766]


TOPS20 Change Order Number 5.1767

Written by: PAETZOLD		21-Mar-82 03:46:06

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: 

TTY locking/unlocking problems.  

Diagnosis: 

It is still possible to lock/unlock TTLCK without going through the 
over unlock code.

Solution: 

SALLI2 does its own INCR and DECR on TTLCK.  I have reason to suspect 
TTMSG stuff causing a TTLCK problem.  Change SALLI2 to use LCKTT and
ULKTT.


[End of TCO 5.1767]


TOPS20 Change Order Number 5.1768

Written by: PAETZOLD		24-Mar-82 09:17:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: 

FLKTIMs do not reset the FKLOCK anymore.

Diagnosis: 

They did in rel 4.  In rel 5 they were changed so that we could find out the
causes of FLKTIMs.  We have indeed solved many.  We wont solve anymore for rel 
rel 5 so this code should be enabled again.

Solution: 

Enable it.


[End of TCO 5.1768]


TOPS20 Change Order Number 5.1769

Written by: COBB		24-Mar-82 10:06:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 


Problem: In some cases, stepping through directories can cause LCKDIR
bughalts.

Diagnosis: Although we check for wildcards alone, we never check for both
wildcards and stepping after the initial arg parse.

Solution: Add a check at RCD550 so we don't try to map the directory again.
[End of TCO 5.1769]


TOPS20 Change Order Number 5.1771

Written by: PAETZOLD		 6-Apr-82 10:53:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PHYP4

Related TCO's:
Related SPR's: 


Problem: 

PITRAP BUGHLTS.

Diagnosis: 

PHYP4 is attempting to use ECC for a IRFRVC function.  ECCADR gets called
an returns bad results.  IRFRVC uses the skip function of the RH.  The last
address word in the channel logout area contains a zero for a skip function.

Solution: 

Dont use ECC correction for IRFRVC functions.  PHYP2 allready does this 
correctly.  This is the same as TCO 6.1079.


[End of TCO 5.1771]


TOPS20 Change Order Number 5.1772

Written by: PAETZOLD		 6-Apr-82 15:06:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's: 


Problem: 

ILMNRF BUGHLTs from TTYSRV after an UNATTACH command.  The UNATTACHED job gets
the BUGHLT.

Diagnosis: 

The target job is involved in a SOUT or some such operation.  It has locked
the line down so that nothing bad can happen to it.  However somehow the line
gets transformed into a short block and when we look at TTLINK we get bad data
causing bad line numbers to get passed to TTLNK3.

Solution: 

Code in TCOU6 is unlocking and locking the line block on us.  The ATACH jsys
code has requested the line to become deallocated.  When we unlock the line is 
deallocated.  The ATTACH code then sends a TTMSG to the line to say that the
job has become detached.  The line is now a short block.  The code in TCOU6
then locks the block and doesnt check if it is a short block.  Change the code
in TCOU6 and TCOU7 to handle this correctly.

[End of TCO 5.1772]


TOPS20 Change Order Number 5.1773

Written by: PAETZOLD		 7-Apr-82 16:52:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: 

GFLOAT code may put us into section zero.

Diagnosis: 

GFLTD needs IFIWs.

Solution: 

Add them.

[End of TCO 5.1773]


TOPS20 Change Order Number 5.1774

Written by: PAETZOLD		13-Apr-82 16:58:16

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's: 


Problem: 

Giving -1 as an argument to SCVEC% in order to
prevent loading of PA1050 no longer works correctly.
It causes fork to jump to 0,,777777.

Diagnosis: 

LH of argument is set to default section number which wrecks
the -1.

Solution: 

Don't shove section number in if arg is -1.  This is the same as 
TCO 6.1091.

[End of TCO 5.1774]


TOPS20 Change Order Number 5.1775

Written by: PAETZOLD		15-Apr-82 15:10:07

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's: 


Problem: 

UFPGS JSYS for short files with a long count (eg. 777777) take much longer
(orders of magnitude) than in release 4.

Diagnosis: 

UFPGS can make many useless calls to JFNOFN.  It has always done this.
However JFNOFN now takes longer because it checks for the file going long
while we have it open (by calling GETFDB).  

Solution: 

For short files force the count to 512 if it is greater than 512.  This will
make short file performance better.  Long file performance is not affected
by this change.  It is still as bad in release 5 as it was in release 4.

[End of TCO 5.1775]


TOPS20 Change Order Number 5.1776

Written by: PAETZOLD		20-Apr-82 12:21:56

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's: 


Problem: 

SMAP% JSYS does not check the source id for legal section numbers.  This is a
terrible security bug as it allows people to have access to directory files.

Diagnosis: 

Who knows why........

Solution: 

Add code in .SMAP to check for legal section numbers.

[End of TCO 5.1776]


TOPS20 Change Order Number 5.1778

Written by: WACHS		29-Jun-82 04:05:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	PHYM78

Related TCO's:
Related SPR's: 


Problem: On a TU78 write error we continuously retry the same bad
spot of tape, although we think we've left some blank tape and
are writing the next record

Diagnosis: If the TM78 microcode screws up and never decides that an
error is hard, it repositions the tape to before the bad spot after
we've done our last retry on the failing record

Solution: Suppress error repositioning on the last retry

[End of TCO 5.1778]


TOPS20 Change Order Number 5.1779

Written by: WACHS		29-Jun-82 04:10:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	phym78

Related TCO's:
Related SPR's: 


Problem: OVRDTA BUGCHKs after a TU78 goes offline.

Diagnosis: If, after a TU78 goes offline and comes back to life
we immediately rewind it, and then attempt to read the 1st record
on the tape, we see a flag which was erroneously left non - 0
on the offline.

Solution: Clear the flag when we start a data operation

[End of TCO 5.1779]


TOPS20 Change Order Number 5.1780

Written by: WACHS		11-Aug-82 09:17:21

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	phym78

Related TCO's:
Related SPR's: 


Problem: Get Register Access Errors on TU78s

Diagnosis: During error recovery we don't set up Q2 after reading
extended status. If there is very heavy IO load on the system this AC
will get wiped.

Solution: Set up Q2

[End of TCO 5.1780]


	Maintenance edits from V5.0 incorporated into V5.1



;MAINTENANCE REVISION HISTORY:
;
;2600	TAM	29-MAR-82	VERSIO
;	Set Edit number to 2600.
;	No SPR
;
;2601	TAM	29-MAR-82	JSYSF
;	Return attributes for parse only JFNs when doing JFNS.
;	20-17473
;
;2602	TAM	30-MAR-82	MEXEC
;	Allow CHKAC to succeed if connected directory is invalid but
;	other parameters would allow access anyway.
;	20-17028
;
;2603	TAM	30-MAR-82	MEXEC
;	Fix argument block length checking in CHKAC.
;	20-17368
;
;2604	TAM	31-MAR-82	VERSIO
;	Put edit history into standard format. No code changes.
;	NO SPR.
;
;2605	PED	2-APR-82	VERSIO
;	Tracking edit.
;	No SPR.
;
;2606	PED	2-APR-82	MONSYM
;	Add GET% symbol definitions so 4.1 will link under 5.0 Monsym.
;	No SPR
;
;2607	JGZ	2-APR-82	VERSIO
;	This edit number is reserved for v4.1.
;
;2608	PED	5-APR-82
;	Tracking edit resevered for 4.1
;
;2609	JGZ	8-APR-82DSKALC
;	Fix structure rebuilding to initialize for BOOTSTRAP.BIN properly.
;	No SPR.  This was edit 1986 to Release 4.
;
;2610	RMT	22-APR-82	VERSIO
;	Tracking edit reserved for 4.1
;	No SPR
;
;2611	JGZ	22-APR-82	MFLIN
;	Fix underflow being reported as overflow by FLIN/DFIN.
;	20-15864
;
;2612	JGZ	22-APR-82	JSYSF
;	Fix RCUSR to return RC%NMD if trying to step a non-wild user string.
;	This was edit 1985 to the Release 4 Autopatch monitor.
;	20-17080
;
;2613	JGZ	26-APR-82	MFLIN
;	Fix FLIN/DFIN returning wrong values.
;	20-15864
;
;2614	TAM	27-APR-82	SCHED
;	MAKE PERCENTAGES OF INTERVAL MORE ACCURATE WHEN BGND IS HIGH.
;	20-15634
;
;2615	JGZ	3-MAY-82	VERSIO
;	This edit number is reserved for version 4.1.
;
;2616	TAM	6-MAY-82	TAPE
;	MAKE .MOSRS FUNCTION OF MTOPR ILLEGAL FOR LABELED TAPES.
;	20-16762
;
;2617	TAM	6-MAY-82	FORK
;	GO OKINT IF FORK IS FROZEN AT WHEN UNTRAPPING.
;	20-15171
;
;2618	JGZ	10-MAY-82	NETWRK
;	Handle termination of GTHST JSYS output strings properly.  ARPA only.
;	20-15113
;
;2619	PED	20-MAY-82	FILINI,DSKALC
;	Set the exempt from migration in some <ROOT-DIRECTORY> files
;	when creating structure. This was edit 1826 to Release 4.
;
;2620	PED	20-MAY-82	COMND
;	Allow ':' within keywords. This was edit 1833 to Release 4.
;
;2621	PED	20-MAY-82	IO
;	Prevent ILMNRF at ILDB in SIN1:. This was Edit 1836 in Release 4.
;
;2622	RMT	25-MAY-82	JSYSF
;	Clear archive status bits on discard.
;	20-15199
;
;2623	RMT	25-MAY-82	TIMER
;	Allow the TIMER JSYS to succeed even if the System Time
;	and Date has not been set if the function is .TIMRT,
;	.TIMEL, or .TIMAL (these don't care if T&D have been set).
;	No SPR
;
;2624	TAM	1-JUN-82	SCHED
;	TEMPORARILY REMOVE 2614.
;	NO SPR.
;
;2625	PED	9-JUN-82	GTJFN
;	Don't allocate CTRL/R buffer if string is from memory.
;	This was edit 1983 in Version 4.
;
;2626	PED	11-JUN-82	MAGTAP
;	Fix maximum size check to allow for 20 page buffer.
;	20-17049
;
;2627	PED	11-JUN-82	FORK
;	Fix security bug in GJCAPS
;	20-16350
;
;2628	PED	23-JUN-82	VERSIO
;	This edit is reserved for version 4.1
;
;2629	PED	23-JUN-82	VERSIO
;	This edit is reserved for version 4.1
;
;2630	TAM	24-JUN-82	VERSIO
;	THIS EDIT RESERVED FOR VERSION 4.1
;
;2631	CLB	14-JUL-82	VERSIO
;	This edit is reserved for version 4.1
;
;2632	PED	16-JUL-82	TTYSRV
;	Prevent NODTEN Bugchk's.
;	20-17930
;
;2633	CLB	16-JUL-82	VERSIO
;	This edit reserved for Version 4.1.
;
;2634	PED	27-JUL-82	PAGEM
;	Prevent SWPSTL Bugchk's.
;
;2635	TAM	28-JUL-82	JSYSA
;	INCLUDE NODE NAME IN USAGE RECORDS.
;	SPR:20-17684
;
;2636	YKT	29-JUL-82	FORK
;	FIX GCVEC TO COMPLAIN OF ILLEGAL INSTRUCTION
;	WHEN RUN PROGRAM @INFORMATION VERSION.
;	SPR:20-17971 and 20-17916
;
;2637	PED	30-JUL-82	VERSIO
;	This edit reserved for Version 4.1.
;
;2638	PED	30-JUL-82	VERSIO
;	This edit reserved for Version 4.1.
;
;2639	TAM	30-JUL-82	JSYSF
;	Make CHFDB return correct error
;	SPR:20-18059
;
;2640	TAM	3-AUG-82	VERSIO
;	THIS EDIT RESERVED FOR VERSION 4.1
;	SPR:NONE
;
;2641	TAM	3-AUG-82	IPCF
;	CORRECTLY CHECK FOR IP%CFP ONLY IN VALARG
;	SPR:20-17830
;
;2642	TAM	3-AUG-82	DISC
;	PREVENT CORRUPTED FILE WHEN LONG FILE IS CLOSED SHORT
;	SPR:20-17740
;
;2643	TAM	4-AUG-82	IPCF
;	MORE OF 2641. USE BETTER TEST.
;	SPR:20-17830
;
;2644	TAM	4-AUG-82	MSTR
;	PREVENT MAPBT1 BUGHLT WHEN RUNNING CHECKD
;	SPR:20-17240
;
;2645	TAM	12-AUG-82	FORK
;	CHECK MINOR FORK STATE IN TRMTST
;	SPR:20-17828
;
;2646	TAM	12-AUG-82	TTPHDV
;	PREVENT ILMNRF BY PASSING DYNAMIC POINTER TO TTCBF9
;	SPR:20-18097
;
;2647	PED	13-AUG-82	VERSIO
;	Reserved for Version 4.1
;
;2648	TW	18-AUG-82	PHYM78
;	Fix error recovery code
;	SPR:NONE
;
;2649	PED	19-AUG-82	VERSIO
;	Reserved for Version 4.1
;
;2650	PED	20-AUG-82	VERSIO
;	Reserved for V4.1.
;
;2651	TAM	26-AUG-82	JSYSF
;	FIX PROBLEM IN 2639
;	SPR:NONE
;
;END OF MAINTENANCE REVISION HISTORY


VEDIT==^D2651
VMAJOR==5
VMINOR==0
IFNDEF VWHO,<VWHO==0>
SCVN==<VWHO>B2+<VMAJOR>B11+<VMINOR>B17+VEDIT


======================================================

Development edits for TOPS-20 V5.1


TOPS20 Change Order Number 5.1.1001

Written by: GRANT		 9-Nov-81 11:12:34

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: NTMAN% does unpredictable things when given a non 8-bit byte
	byte pointer.

Diagnosis: No explicit check for 8-bit bytes.

Solution: During NTMAN% entry make sure user has 8-bit bytes.
[End of TCO 5.1.1001]


TOPS20 Change Order Number 5.1.1002

Written by: GRANT		 7-Dec-81 12:04:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: NSKDIS BUGHLT

Diagnosis: Scheduler found test routine address no to be within resident code.

Solution: When ACKing a remote Link Service message, the failure return doesn't
	properly return a scheduler test.
[End of TCO 5.1.1002]


TOPS20 Change Order Number 5.1.1003

Written by: GRANT		19-Jan-82 16:27:21

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	nsppar

Related TCO's:
Related SPR's:


Problem: Single process can use unfair amount of DECnet resources.

Diagnosis: Number of segments allowed on a single link's resend queue
	is large, especially since we have increased the segment size.

Solution: Decrease single link segment quota from 8 to 5.

[End of TCO 5.1.1003]


TOPS20 Change Order Number 5.1.1005

Written by: GRANT		17-Feb-82 14:20:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Debugging BUGHLT encountered.

Diagnosis: Trying to lock a logical link block without having the outer lock.

Solution: In ACKCCS, use CALL BLKLLK instead of CALL BLKLOK.
[End of TCO 5.1.1005]


TOPS20 Change Order Number 5.1.1006

Written by: GRANT		 6-Mar-82 20:45:43

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Excess code in ONTIMQ and UNQTIM.

Diagnosis: Exit sequences are needlessly repeated.

Solution: Minor rewirte of both routines.
[End of TCO 5.1.1006]


TOPS20 Change Order Number 5.1.1007

Written by: GRANT		 6-Mar-82 21:20:27

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: There are still some JSR BUGHLTs left from development days.

Diagnosis: The checks are not normally needed.

Solution: Comment them out.
[End of TCO 5.1.1007]


TOPS20 Change Order Number 5.1.1008

Written by: GRANT		 6-Mar-82 21:28:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	NSPPAR

Related TCO's:
Related SPR's:


Problem: Phase II NSPSRV used the same number for NSP segment size and
	DLL block size.

Diagnosis: They need to be different for Phase III.

Solution: Create and use new symbol BLKSIZ.
[End of TCO 5.1.1008]


TOPS20 Change Order Number 5.1.1009

Written by: GRANT		 9-Mar-82 14:26:07

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: NODE% function "get network topology" doesn't return the number of
	nodes reported when the user fails to provide enough space and the
	monitor has to truncate the information.

Diagnosis: Error return skips over the code which returns the number.

Solution: Make a subroutine out of the code which returns the info and call
	the routine from both the good and bad returns.
[End of TCO 5.1.1009]


TOPS20 Change Order Number 5.1.1010

Written by: GRANT		11-Mar-82 10:51:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: From a remote system TOPS-20 has very erratic round trip times for
	DECnet messages.  This causes lots of time outs and retransmissions.

Diagnosis: The routine which checks for links which need ACKs sent isn't called
	frequently enough.

Solution: The scheduler code at NSPCH7 should always check the "links which
	need service" queue.
[End of TCO 5.1.1010]


TOPS20 Change Order Number 5.1.1011

Written by: GRANT		11-Mar-82 10:55:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: The round trip time of messages to TOPS-20 from a remote system
	is quite long.

Diagnosis: TOPS-20 pumps out ACKs every 1/2 second.

Solution: Make it do it every 200 milliseconds.
[End of TCO 5.1.1011]


TOPS20 Change Order Number 5.1.1012

Written by: GRANT		11-Mar-82 15:32:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: NSP background task hogging stand alone system.

Diagnosis: When there are no DECnet links, the inactivity timer is never
	reset.

Solution: In the inactivity timer routine NSPINA, reset the timer even if
	there are no links to be serviced.
[End of TCO 5.1.1012]


TOPS20 Change Order Number 5.1.1013

Written by: GRANT		11-Mar-82 15:37:56

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Abandoned links not getting cleaned up soon enough.

Diagnosis: Inactivity timer getting turned off when it shouldn't be.

Solution: Don't turn off inactivity timer if Link Service message doesn't
	get sent.  Keeping the timer on will cause future attempts to send
	the message.
[End of TCO 5.1.1013]


TOPS20 Change Order Number 5.1.1014

Written by: GRANT		11-Mar-82 16:28:03

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Debugging BUGHLT encountered.

Diagnosis: Trying to lock a logical link block without having the outer lock.

Solution: In DATCCS, use CALL BLKLLK instead of CALL BLKLOK.
[End of TCO 5.1.1014]


TOPS20 Change Order Number 5.1.1015

Written by: GRANT		15-Mar-82 08:56:23

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: No more DECnet resident free space.

Diagnosis: Space being lost due to links being aborted without flushing
	the message queues.

Solution: Make sure we never release a logical link without doing the big purge.
[End of TCO 5.1.1015]


TOPS20 Change Order Number 5.1.1016

Written by: GRANT		16-Mar-82 08:58:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Certification disconnect test fails.

Diagnosis: Unsolicited data message being received.

Solution: A data message is incorrectly being sent because the CLOSF code
	still checks for a non-zero byte count.  This is no longer a valid
	check since zero-length messages were implemented.  Remove the check.
[End of TCO 5.1.1016]


TOPS20 Change Order Number 5.1.1017

Written by: GRANT		16-Mar-82 09:01:30

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Certification disconnect test fails.

Diagnosis: Logical link is closed prematurely by DTR.

Solution: When a CLOSF is executed and we are in "connect sent" state,
	wait for link to change state.
[End of TCO 5.1.1017]


TOPS20 Change Order Number 5.1.1018

Written by: GRANT		17-Mar-82 12:19:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: "Disconnect with optional data" certification test fails.

Diagnosis: DTR's MTOPR fails so no disconnect is sent.

Solution: MTOPR needs to check for both run state and connect sent state;
	it currently checks for run state only.
[End of TCO 5.1.1018]


TOPS20 Change Order Number 5.1.1019

Written by: MURPHY		19-Mar-82 17:24:26

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: NSP background task wakes up too often, creating scheduler
overhead.

Diagnosis: Things appear on queue frequently, but instant response
not needed.

Solution: Change scheduler test to wake up only every 2 seconds
if there is something to do.

[End of TCO 5.1.1019]


TOPS20 Change Order Number 5.1.1020

Written by: GRANT		21-Mar-82 18:18:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPPAR	NSPSRV

Related TCO's:
Related SPR's:


Problem: Hung DECnet links to Phase II nodes.

Diagnosis: The Phase II node has sent a message but has never received an
	ACK or NAK.

Solution: TOPS-20 needs to NAK out-of-order messages from Phase II nodes;
	it has never done so.
[End of TCO 5.1.1020]


TOPS20 Change Order Number 5.1.1021

Written by: GRANT		22-Mar-82 11:15:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: No more DECnet resident free space.

Diagnosis: Old DI messages left lying around.

Solution: In some cases the DI processing forgets to release the message block.
	Make sure it does so in all cases.
[End of TCO 5.1.1021]


TOPS20 Change Order Number 5.1.1022

Written by: GRANT		31-Mar-82 10:43:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: DECnet architecture doesn't specify that communication with a Phase II
	node should be different than with a Phase III node in terms of timing
	messages.

Diagnosis: Messages to Phase II nodes should not be timed out.

Solution: Make a check for Phase II links in the timing code.
[End of TCO 5.1.1022]


TOPS20 Change Order Number 5.1.1023

Written by: GRANT		31-Mar-82 10:46:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Out of DECnet resident free space.

Diagnosis: Process is blocked while owning the logical link block lock.

Solution: Correct the logic in determining when to return and when to block.
[End of TCO 5.1.1023]


TOPS20 Change Order Number 5.1.1024

Written by: GRANT		31-Mar-82 14:08:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Erratic behavior when timing messages to unpredictable nodes.

Diagnosis: The round trip calculation is too strict to allow for wild
	variances.

Solution: Impose a lower bound on the round trip calculation.
[End of TCO 5.1.1024]


TOPS20 Change Order Number 5.1.1025

Written by: GRANT		13-Apr-82 14:52:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	NSPPAR

Related TCO's:
Related SPR's:


Problem: Local Delay Factor and Local Delay Weight are not settable from NCP.

Diagnosis: Until now these parameters were not well-enough understood to be
	played with.  Now that we know how they affect the performance of NSP
	we should make them easily accessible.

Solution: Create default values and set them at NSP initialization time.  Make
	NTMAN% JSYS know how to set and report the values.
[End of TCO 5.1.1025]


TOPS20 Change Order Number 5.1.1026

Written by: GRANT		15-Apr-82 16:50:15

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Degraded DECnet performance.

Diagnosis: Waking up the background task on a time basis rather than when
	it has something to do slows things down considerably.

Solution: Reinstate waking up the task when it has a message to process.
[End of TCO 5.1.1026]


TOPS20 Change Order Number 5.1.1027

Written by: GRANT		16-Apr-82 12:18:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Logical link block lock locked forever.

Diagnosis: When the attempt to attach a DECnet NVT fails, the MTOPR
	gives an error return but doesn't unlock the LL block.

Solution: In NTANT, CALL BLKULK before returning from a CALL ASMCB failure.
[End of TCO 5.1.1027]


TOPS20 Change Order Number 5.1.1028

Written by: GRANT		22-Apr-82 13:26:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: TOPS-20 retransmitting too many messages.

Diagnosis: Retransmission algorithm too quick to  declare that a response is
	late.

Solution: Apply local delay factor before the decision to retransmit is made.
[End of TCO 5.1.1028]


TOPS20 Change Order Number 5.1.1029

Written by: GRANT		28-Apr-82 09:59:08

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	nsppar

Related TCO's:
Related SPR's:


Problem: DECnet becomes very sluggish as the load average increases.

Diagnosis: Too much of DECnet's message processing being given to the NSP
	background fork.

Solution: Process all incoming, non-control messages at scheduler level.
[End of TCO 5.1.1029]


TOPS20 Change Order Number 5.1.1030

Written by: GRANT		28-Apr-82 10:03:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	nsppar

Related TCO's:
Related SPR's:


Problem: Can't retry a message more than 7 times.

Diagnosis: Retry count limited to 3 bits.

Solution: Change the data structure definition.
[End of TCO 5.1.1030]


TOPS20 Change Order Number 5.1.1032

Written by: GRANT		 4-May-82 11:51:05

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Link Service messages not getting acked in a reasonable time period.

Diagnosis: The bit that says "need to ack" is getting turned off sometimes when
	it shouldn't.

Solution: Move the bit manipulation from SNDACK to ACKLI.
[End of TCO 5.1.1032]


TOPS20 Change Order Number 5.1.1033

Written by: GRANT		 7-Jun-82 08:01:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: When given a node name not assigned to a network node, NTMAN%
	returns with "invalid identifier" network management error.

Diagnosis: Wrong error being returned.

Solution: Change it to "unrecognized component".
[End of TCO 5.1.1033]


TOPS20 Change Order Number 5.1.1034

Written by: MURPHY		16-Jun-82 12:06:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED	STG

Related TCO's:
Related SPR's:


Problem: IDLE time not reported correctly.  Fork held in balset
causes unused time to appear as FILW instead of IDLE, and such
fork also increases load average.

Diagnosis: Has always been this way, but increased use of
HDISMS means some systems show no idle time even when
doing practically nothing.

Solution: Keep count of forks in balance set hold, reduce
runnable fork count for load average and idle time by
that number.

[End of TCO 5.1.1034]


TOPS20 Change Order Number 5.1.1035

Written by: GRANT		17-Jun-82 09:41:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: DECnet interrupt messages hang the logical link.

Diagnosis: Interrupt messages were totally broken when the work for
	handling all incoming messages in the scheduler was done.

Solution: Make the correct test to distinguish between link service and
	interrupt types;  and, tell scheduler not to release an interrupt
	messages.
[End of TCO 5.1.1035]


TOPS20 Change Order Number 5.1.1036

Written by: MURPHY		22-Jun-82 15:45:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's:


Problem: After user has done SET NO UUO-SIMULATION and run
program, @INFO VERSION complains of illegal instruction.

Diagnosis: GCVEC% confused - thinks -1 means extended
entry vector because of non-0 bits in LH.

Solution: Check for negative before check for LH non-0.

[End of TCO 5.1.1036]


TOPS20 Change Order Number 5.1.1037

Written by: GRANT		30-Jun-82 08:33:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Unprivileged user can set the local node number.

Diagnosis: Code doesn't check for enabled privileges.

Solution: Make it do so.
[End of TCO 5.1.1037]


TOPS20 Change Order Number 5.1.1038

Written by: GRANT		30-Jun-82 08:49:20

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	TTPHDV

Related TCO's:
Related SPR's:


Problem: Unnecessary CALL SQIACK in DECnet NVT porcessor.

Diagnosis: Code couldn't be removed because TTPHDV had to be the same
	as 5.0.

Solution: Now that 5.1 has its own TTPHDV, remove the unnecessary code.
[End of TCO 5.1.1038]


TOPS20 Change Order Number 5.1.1039

Written by: GRANT		30-Jun-82 09:05:23

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: YES

Program: MONITOR
   Routines Affected:	TTYSRV	TTPHDV

Related TCO's:
Related SPR's:


Problem: You can login over a DECnet line when remote logins are disallowed.

Diagnosis: No code to prevent it.

Solution: Add appropriate logic to line startup code;  also, remove a check
	on  DECnet links which breaks the connection if a character is received
	on a line on which there is no job.
[End of TCO 5.1.1039]


TOPS20 Change Order Number 5.1.1040

Written by: GRANT		30-Jun-82 09:13:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Connections to MCB's NML process are incredibly slow.

Diagnosis: TOPS-20 is violating NSP protocol by sending a data segment prior
	to sending a link service ACK.

Solution: In routine SNDCHK, add the appropriate check;  create a scheduler
	test to be returned if the new check fails.
[End of TCO 5.1.1040]


TOPS20 Change Order Number 5.1.1041

Written by: GRANT		30-Jun-82 09:15:27

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	ttphdv

Related TCO's:
Related SPR's:


Problem: DECnet NVT lines hang.

Diagnosis: New test in NSPSRV's SNDCHK causes confusion in TTYSRV.

Solution: If the call to SNDCHK fails and there are characters ready to go,
	set the bit in TTSOQ so we will continue to try to send.  (Note:  This
	fix is actually independent of the change made to SNDCHK, it should
	have been doing this anyway.)

[End of TCO 5.1.1041]


TOPS20 Change Order Number 5.1.1042

Written by: GRANT		 6-Jul-82 09:22:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Page fault while in scheduler.

Diagnosis: Routine ACKCHN needs storage location NSLDWS;  ACKCHN is now
	called at scheduler level whereas in the past it was only call
	by the background task.

Solution: Put NSLDWS in resident storage.
[End of TCO 5.1.1042]


TOPS20 Change Order Number 5.1.1044

Written by: PAETZOLD		 9-Jul-82 11:52:58

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem:

NODTEN BUGCHKs.


Diagnosis:

Some sites have inteligent devices on RSX20F lines.  For some obscure reason
the device sends multitudes of XOFF's down the line to RSX20F.  RSX20F passes
the XOFF up to the monitor.  The shuts down the line.  However on the next XOFF
the monitor shuts down the line again.  etc. etc. etc.

Each XOFF causes some buffers to be allocated etc. etc. etc.  Voila NODTEN.


Solution:

Move the label TTXOFC: up one line.  This will make sure the check for
xoff is correctly done.


[End of TCO 5.1.1044]


TOPS20 Change Order Number 5.1.1045

Written by: GRANT		13-Jul-82 10:39:06

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Logical link block lock is locked forever.

Diagnosis: MTOPR function to "set network host" fails to unlock if the
	call into TTYSRV fails.

Solution: Code in NTSNH should do so.
[End of TCO 5.1.1045]


TOPS20 Change Order Number 5.1.1046

Written by: MURPHY		18-Jul-82 13:18:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem: ILMNRF in TTYFNT (DECNET NVT's)

Diagnosis: Code fails to notice that logical link has been
deleted and attempts to follow pointers from it.

Solution: Check TTNUS to see if logical link pointer still
present.

[End of TCO 5.1.1046]


TOPS20 Change Order Number 5.1.1047

Written by: MURPHY		18-Jul-82 13:21:21

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem: ILMNRF from NSPSRV background task.

Diagnosis: Queue manipulation not interlocked in one particular
case - when NVT being deallocated on logout.

Solution: Put NOSKED before call to TNTCLS in TNHCLS.

[End of TCO 5.1.1047]


TOPS20 Change Order Number 5.1.1048

Written by: MURPHY		18-Jul-82 13:24:16

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV	NSPSRV

Related TCO's:
Related SPR's:


Problem: ILMNRF and possibly others for TTYSRV NVT code.

Diagnosis: Logical link can be flushed without pointers
from TTY data base being cleaned up.

Solution: Make NSP close code check LLTTA to see if TTY is
using this LL, and if so, clean it up.

[End of TCO 5.1.1048]


TOPS20 Change Order Number 5.1.1049

Written by: MURPHY		 6-Aug-82 14:52:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:	5.1.1194
Related SPR's:


Problem: ENQ lock never released.

Diagnosis: If lock acquired by top fork and not released by program,
monitor does not release it when logging out job.

Solution: Add release in cleanup of top fork.

[End of TCO 5.1.1049]


TOPS20 Change Order Number 5.1.1050

Written by: GRANT		10-Aug-82 11:24:37

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: DECnet device driver returns directly to user rather than back to
	 higher level code when the GETOK in DCNOPN fails.

Diagnosis: Device driver should return to OPENF code upon failure.

Solution: Change RETERR to RET in DCNOPN's GTOKM.
[End of TCO 5.1.1050]


TOPS20 Change Order Number 5.1.1051

Written by: GRANT		10-Aug-82 11:54:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Possible loss of free space.

Diagnosis: During an OPENF, if swappable free space is low the JSYS fails
	   but the logical link block remains.

Solution: In SRCOPN, go clean up before returning after GETBLK fails.
[End of TCO 5.1.1051]


TOPS20 Change Order Number 5.1.1052

Written by: GRANT		16-Aug-82 11:48:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	ttphdv

Related TCO's:
Related SPR's:


Problem: ILMNRF while running SETHOST.

Diagnosis: TINET3 calls TTCBF9 with static pointer.  TTCBF9 expects dynamic
pointer.  Stuff gets trashed and finally TTRLBF gets called which kills the
system.

Solution: Do a STADYN before calling TTCBF9.
[End of TCO 5.1.1052]


TOPS20 Change Order Number 5.1.1053

Written by: GRANT		17-Aug-82 09:44:16

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: NODE% JSYS function .NDRNM clobbers user's AC3 upon return.

Diagnosis: Routine called to return string to user returns updated byte pointer
	   in user's AC3.

Solution: Change the routine NTRNAM to return the updated user BP to its caller
	  and have the callers decide where the user is to receive the updated
	  byte pointer.
[End of TCO 5.1.1053]


TOPS20 Change Order Number 5.1.1054

Written by: GRANT		24-Aug-82 14:06:35

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: DECnet program hangs in CLOSF when talking to VMS.

Diagnosis: Another side effect of the zero-length message implementation;
	CLOSF is wrongly sending a bunch of data messages when it shouldn't
	be doing any more output.

Solution: Make the proper check in CLZRUN.
[End of TCO 5.1.1054]


TOPS20 Change Order Number 5.1.1055

Written by: GRANT		25-Aug-82 11:44:53

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: MTOPR function to read the remote host name returns a null
	string.

Diagnosis: Code in MTOPR not aware of new logical link state "CC sent".

Solution: Add code at MTRDCK which check for new Phase III state.
[End of TCO 5.1.1055]


TOPS20 Change Order Number 5.1.1057

Written by: GRANT		27-Aug-82 06:56:38

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPPAR	NSPSRV

Related TCO's:
Related SPR's:


Problem: TOPS-20 can't talk to a node running Phase IV NSP.

Diagnosis: Invalid check being made for remote node's NSP version.

Solution: Need to make an explicit version number check rather than the
	zero/non-zero check which has been adequate up until now.
[End of TCO 5.1.1057]


TOPS20 Change Order Number 5.1.1058

Written by: MCINTEE		30-Aug-82 13:52:50

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: When attempting to do the .MORSS function of MTOPR% on a network
link while not in run state, the error message "link aborted" is returned.

Diagnosis: Wrong error message returned at label MTOBJ1 - is DCNX11, should
be DCNX8 (Illegal operation)

Solution: Change it. Also put into documentation that .MORSS is illegal, except
when link is in run state.
[End of TCO 5.1.1058]


TOPS20 Change Order Number 5.1.1060

Written by: COBB		 8-Sep-82 15:09:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FORK

Related TCO's:
Related SPR's:


Problem: In checking fork state at TRMTST, T2 gets set up with the "Pre-freeze"
state, but an ensuing compare does not use it.

Diagnosis: T2 forgotten in compare.

Solution: Add it!
[End of TCO 5.1.1060]


TOPS20 Change Order Number 5.1.1061

Written by: MCINTEE		14-Sep-82 12:23:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: MONPDL bughlt from NODE% jsys

Diagnosis: Code pushes ALL reachable node numbers onto stack. So, if
there happens to be too many reachable nodes, crash occurs.

Solution: Change code in routine NDGNT.
[End of TCO 5.1.1061]


TOPS20 Change Order Number 5.1.1063

Written by: GRANT		21-Sep-82 13:14:20

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: NCP returning characteristics out of order.

Diagnosis: NTMAN% returns NSP parameters out of order to user.

Solution: Order characterisitics by parameter number when processing the
	sho command.
[End of TCO 5.1.1063]


TOPS20 Change Order Number 5.1.1065

Written by: GRANT		21-Sep-82 14:48:00

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: TOPS-20 claims to be version 3.0 of DECnet routing;  that's not really
	true anymore.

Diagnosis: TOPS-20 doesn't do a DECnet-defined version of routing.

Solution: Since it is valid not to fill in the routing version, that's what
	we'll do.
[End of TCO 5.1.1065]


TOPS20 Change Order Number 5.1.1066

Written by: GRANT		23-Sep-82 09:18:02

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: When attempting to do a synchronous close of a DECnet connection,
	the CLOSF gets a failure return.

Diagnosis: The link has been aborted by the other side, TOPS-20 returns the
	failure in an attempt to notify the user that some data may not have
	been sent.  However, this adds confusion rather than enlightenment.
	Besides, the code has already done the best it could to get all the
	data out.

Solution: Make the CLOSF return success on a link that already has been aborted.
[End of TCO 5.1.1066]


TOPS20 Change Order Number 5.1.1067

Written by: GRANT		23-Sep-82 10:40:47

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Unnecessary DECnet traffic.

Diagnosis: TOPS-20 tries to do a disconnect when a link times out.  This is
	not needed.

Solution: When a link times out, PSI the user and flush the message queues -
	but send no network messages.
[End of TCO 5.1.1067]


TOPS20 Change Order Number 5.1.1068

Written by: GRANT		23-Sep-82 13:58:56

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's:


Problem: FTS can't get DECnet topology change interrupts.

Diagnosis: The monitor's allotted space for forks watching topology is full.

Solution: Increase the table from 5 to 10.
[End of TCO 5.1.1068]


TOPS20 Change Order Number 5.1.1069

Written by: MILLER		24-Sep-82 11:59:03

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSA

Related TCO's:
Related SPR's:


Problem: There is a race in CRJOB wherein a program may
change the CRJOB arguement block and fool the monitor into
using a device unavailable to this job.

Diagnosis: The monitor validates the given TTY designator
but refetches it from the user without revalidating the
value. A persistant hacker could take advantage of this
to gain access to an already in-use TTY.

Solution: Save the TTY designator in the monitor so we don't
have to refetch it from the user.

[End of TCO 5.1.1069]


TOPS20 Change Order Number 5.1.1070

Written by: MILLER		24-Sep-82 12:21:15

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's:


Problem: Another tale from the hacker adventures...

CRDIR'S JFN on a directory file is available for diddling by other
processes in the job.

Diagnosis: As above. One effect of this is that another process
could use this JFN to change a directory's privileges.

Solution: Set GJ%ACC in the GTJFN block. This will limit the JFN
to the fork doing the CRDIR.

[End of TCO 5.1.1070]


TOPS20 Change Order Number 5.1.1071

Written by: GRANT		27-Sep-82 14:41:50

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem: TTMSG JSYS causes monitor crash.

Diagnosis: Monitor has a 6-bit field into which it stores the "time-out"
	count of characters.  No check is made as to the value being stored.

Solution: At GETSB1, add a check to insure that the count of characters will
	fit in the allotted space.
[End of TCO 5.1.1071]


TOPS20 Change Order Number 5.1.1072

Written by: GRANT		28-Sep-82 14:10:10

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Incoming DECnet NVT connections from TOPS-10 are sometimes timed out
	by TOPS-20 when the user has locally XOFFed the terminal.

Diagnosis: TOPS-10 has attempted to turn off all data flow from TOPS-20, but
	TOPS-20 continues to retransmit data segments and eventually times
	them out.

Solution: In the retrnasmission code, make sure that data segments are not
	resent when the flow is off.
[End of TCO 5.1.1072]


TOPS20 Change Order Number 5.1.1073

Written by: MOSER		28-Sep-82 14:11:32

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	LOGNAM

Related TCO's:
Related SPR's:


Problem: Hung jobs and/or system.

Diagnosis: Logical name lock isn't unlocked after failing ASGJFR.

Solution: Unlock it.

[End of TCO 5.1.1073]


TOPS20 Change Order Number 5.1.1074

Written by: GRANT		28-Sep-82 19:14:42

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: ILMNRF BUGHLTs from NSPSRV.

Diagnosis: Cause unknown, more information needed.

Solution: Create a routine to verify a logical link block;  call it
	whenever word FILLLB of the JFN block is written into.
[End of TCO 5.1.1074]


TOPS20 Change Order Number 5.1.1075

Written by: MURPHY		29-Sep-82 14:54:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	SCHED

Related TCO's:
Related SPR's:


Problem: [Same as 6.1280]
Sluggish response, slow logouts, possibly others.

Diagnosis: NEWST not making adequate distinction between
completely compute-bound jobs and jobs which block
for short-to-moderate periods of time.  Particularly with
large load averages, jobs can stay in low queue even
after blocks of a minute or more.

Solution: Revise NEWST to make handling of unblocking
low queue forks more like previous releases.

[End of TCO 5.1.1075]


TOPS20 Change Order Number 5.1.1076

Written by: LEACHE		29-Sep-82 17:06:12

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's:


Problem:
Directory page allocation counts can become inaccurate.

Diagnosis:
Disk utilities (like CHECKD) do an OPENF/CLOSF sequence on the
directory file and inadvertently cause the page count of the
directory file to become non-zero when CLOSF updates the page count.

Solution:
Have CLOSF skip the page-count-update code for directory files.

[End of TCO 5.1.1076]


TOPS20 Change Order Number 5.1.1077

Written by: LEACHE		29-Sep-82 17:47:36

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	FUTILI

Related TCO's:
Related SPR's:


Problem:
Bad 30-bit addresses supplied to the NODE JSYS can crash the monitor.

Diagnosis:

At STRDIR3:
  UMOVEM A,@C
will cause an ILLIND BUGHLT if bits 0 and 1 are on in C.

Solution:
As a temporary solution, change the above instruction to:
  UMOVEM A,(C)

[End of TCO 5.1.1077]


TOPS20 Change Order Number 5.1.1078

Written by: LEACHE		30-Sep-82 18:42:08

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's:


Problem: Bad byte pointers supplied to a JSYS can crash the monitor.

Diagnosis: As above.

Solution: Change KIMXCT so that it returns +1 (to monitor code) if we
are NOINT at the time of the trap, and generates an illegal instruction trap
to user code if we are not NOINT.

[End of TCO 5.1.1078]


TOPS20 Change Order Number 5.1.1079

Written by: GRANT		 1-Oct-82 14:27:28

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: DECnet free space exhausted.

Diagnosis: The queue of messages processed at scheduler level has many
	messages on it and they are not getting processed.

Solution: In routine NSPNXT, use MOVE instead of LOAD!  This will correctly
	find the next message on the queue.
[End of TCO 5.1.1079]


TOPS20 Change Order Number 5.1.1080

Written by: GRANT		 1-Oct-82 17:37:45

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: No more DECnet resident free space.

Diagnosis: Incoming message queue overflowing - some messages not getting
	processed.

Solution: Message which have come from or through a DN20 which has crashed
	should be tossed, regardless of any other factors concerning that
	logical link.
[End of TCO 5.1.1080]


TOPS20 Change Order Number 5.1.1081

Written by: PAETZOLD		 4-Oct-82 13:36:59

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DISC

Related TCO's:
Related SPR's:


Problem:

Long files hang job when pjase of the moon is correct.

Diagnosis:

OFNJFN locks FILLCK for JFNs which can not possibly be the one we want during
the JFN OFN scan.

Solution:

Only lock the FILLCK after we think we have the correct JFN and then check
it again.  This is the same as TCO 6.1152.

[End of TCO 5.1.1081]


TOPS20 Change Order Number 5.1.1082

Written by: COBB		 4-Oct-82 15:39:09

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM	SCHED

Related TCO's:
Related SPR's:


Problem: Debugging code is slow

Diagnosis: System is slow too

Solution: Put IFN SKEDSW around calls to routine which keeps track of
NOSKED blocks and P-faults.
[End of TCO 5.1.1082]


TOPS20 Change Order Number 5.1.1084

Written by: COBB		 7-Oct-82 13:20:40

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's:


Problem: page fault in 20ms sked cycle eventually causes okskbg bughlts

Diagnosis: pgrtrp decrements nsked on behalf of user running

Solution: go to kipfs (and do a skdpf1 if necessary there) if in sked
[End of TCO 5.1.1084]


TOPS20 Change Order Number 5.1.1085

Written by: GRANT		 7-Oct-82 13:29:11

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: Hung DECnet link while running DTS echo test.

Diagnosis: The link has been wrongly removed from the resend queue.

Solution: In routine UNQSEG, use the ACVAR LLB rather than T1 when checking
	for the NSP version of the other side.
[End of TCO 5.1.1085]


TOPS20 Change Order Number 5.1.1086

Written by: GRANT		 8-Oct-82 08:35:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: ILMNRF BUGHLTs from DECnet code.

Diagnosis: Various clean up routines being called with a pointer to
	something other than a logical link block.  The block appears
	to be disappearing out from under the caller.

Solution: Make sure all callers to DELNOD have the logical link tree
	structure lock.
[End of TCO 5.1.1086]


TOPS20 Change Order Number 5.1.1087

Written by: GRANT		 8-Oct-82 09:11:48

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: DECnet logical link block not being cleaned up after connection
	has been aborted.

Diagnosis: When a DI times out, the logical link block must be eliminated
	if the link was closed with a CLOSF (CZ%ABT).  This is the only
	case in which the time out code needs to get rid of the LL block.

Solution: In NSPTMO, add the call to DELNOD.
[End of TCO 5.1.1087]


TOPS20 Change Order Number 5.1.1089

Written by: GRANT		 9-Oct-82 10:12:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	ttphdv	STG

Related TCO's:
Related SPR's:


Problem: ILMNRF BUGHLTs involving DECnet and resident free space.

Diagnosis: Logical link blocks are disappearing.

Solution: The NVT clean up procedure is wrong.  It should be keeping a
	list of logical link IDs not logical link block addresses.
	Rewrite MCBCQ in NSPSRV and TNTCLS in TTPHDV.


[End of TCO 5.1.1089]


TOPS20 Change Order Number 5.1.1091

Written by: PAETZOLD		10-Oct-82 17:43:51

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem:

TTOCN and TYLMD fileds of TTDAT1 conflict.  The MSB of one is the LSB of the
other.

Diagnosis:

Solution:

Change the def of TYLMD to end on bit 4 and not bit 5.  THis is the same as
tco 6.1263

[End of TCO 5.1.1091]


TOPS20 Change Order Number 5.1.1092

Written by: GRANT		11-Oct-82 09:57:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: MONMAX out of address space.

Diagnosis: RSCOD has overflowed INCOD.

Solution: Instruction bumming in NSPSRV.
[End of TCO 5.1.1092]


TOPS20 Change Order Number 5.1.1093

Written by: COBB		11-Oct-82 13:22:04

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem: TTMSG's don't work (feature?)

Diagnosis: SEND-ALL lock is not managed properly.  An unpriv'd user
who tries to send to all lines bombs out, but never releases the lock!

Solution: Turn ITERR (GTJIX2) into an ITERR (GTJIX2,<SETOM SALLCK>).

[End of TCO 5.1.1093]


TOPS20 Change Order Number 5.1.1097

Written by: PAETZOLD		18-Oct-82 15:41:13

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem:

SAVELN in TTYDEA gets skipped during the ARPANET NVT case.

Diagnosis:

The TDCALL for NVTDET may return using a skip return.  THe SAVELN will be
skipped.

Solution:

Add a NOP after the TDCALL.

[End of TCO 5.1.1097]


TOPS20 Change Order Number 5.1.1098

Written by: MURPHY		20-Oct-82 16:16:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's:


Problem: Someone might try to steal TOPS20.  They might have an
EXE file or an old dump around, and might decide to disassemble it,
call it something else, and sell it as t

Diagnosis: There is no copyright notice in the EXE file!!

Solution: Assemble a copyright notice into the very first words
in the resident code segment.  Then, the would-be thieves will
see it when disassembling their file and will know that what
they are doing is WRONG.  To make this project more interesting,
define the copyright notice into the body of a macro and
expand the macro where necessary so that there is still only
one appearance of the copyright notice in STG.MAC to update.

[End of TCO 5.1.1098]


TOPS20 Change Order Number 5.1.1100

Written by: GRANT		 2-Nov-82 11:51:03

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: No more swappable free space.

Diagnosis: Space is filled with 6-word blocks which are no longer needed.
	When a DECnet server closes a connection and goes back into wait
	state one of the swappable blocks is not released before assigning
	a new one.

Solution: In routine CLRBLK, release old block if one exists.
[End of TCO 5.1.1100]


TOPS20 Change Order Number 5.1.1101

Written by: COBB		 5-Nov-82 13:55:31

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	STG

Related TCO's:
Related SPR's:


Problem: MONPDL bughalts when SPEAR tries to collect volumes of data.

Diagnosis: BUGPDL is not long enough.

Solution: Make BUGPDL longer.
[End of TCO 5.1.1101]


TOPS20 Change Order Number 5.1.1102

Written by: COBB		 5-Nov-82 13:59:24

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	DTESRV

Related TCO's:
Related SPR's:


Problem: Monitor gets into section 0 when we'd rather it wouldn't

Diagnosis: JRST @[.....] gets us there.

Solution: In RELODR, make the JRST @[...](B) into a JRST @[IFIW!...](B).
This TCO is identical to 6.1245.
[End of TCO 5.1.1102]


TOPS20 Change Order Number 5.1.1103

Written by: MURPHY		 5-Nov-82 14:09:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's:


Problem: SWPSTL bugchk at startup, not reproducable.

Diagnosis: Unknown.  Reloading system again usually does
not show sympton.  This bugchk means that swapping space
appears to be less than twice the size of main memory--neither
of these should change significantly from one reload to
the next.

Solution: Gather more information.  Include optional data
with bugchk to report size of swapping space and size
of main memory so we will know which is incorrect.

[End of TCO 5.1.1103]


TOPS20 Change Order Number 5.1.1104

Written by: GRANT		11-Nov-82 06:58:14

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	LINEPR

Related TCO's:
Related SPR's:


Problem: OKSKBG BUGHLT.

Diagnosis: TOPS-20 may decide to reload the front end and may call LPTINT
in LINEPR during reload processing.  This can go OKSKED without going NOSKED.

Solution: Go NOSKED when appropriate.
[End of TCO 5.1.1104]


TOPS20 Change Order Number 5.1.1105

Written by: GRANT		12-Nov-82 14:01:52

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV

Related TCO's:
Related SPR's:


Problem: No more address space.

Diagnosis: Addition of copyright to .EXE file overflowed RSCOD.

Solution: Eliminate unused internal links code.
[End of TCO 5.1.1105]


TOPS20 Change Order Number 5.1.1106

Written by: COBB		14-Nov-82 13:56:22

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	IPCF

Related TCO's:
Related SPR's:


Problem: .MUCHO function of MUTIL% can cause mucho BUGHLTs.

Diagnosis: Routine WAKFRK trashes T2 and the mainline routine doesn't
expect it to.

Solution: Use SAVEAC <T1,T2> at the top of CHKFKW and CHKPDW.  Note that
the edit in CHKPDW is for symmetry, since it used to declare a STKVAR
and use MOVEs to save these ACs.

[End of TCO 5.1.1106]


TOPS20 Change Order Number 5.1.1107

Written by: COBB		17-Nov-82 13:55:50

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC

Related TCO's:
Related SPR's:


Problem: Bad data off the stack.

Diagnosis: STKVAR is referenced after an explicit PUSH in MEXEC at
LDTACH + 10 (in literal).

Solution: Replace the PUSH and POP with MOVEM and MOVE to another
STKVAR element.
[End of TCO 5.1.1107]


TOPS20 Change Order Number 5.1.1108

Written by: COBB		17-Nov-82 14:27:57

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTYSRV

Related TCO's:
Related SPR's:


Problem: Jobs releasing permanent lines hang waiting for TTPFK=-1.

Diagnosis: Permanent lines are special case.  Code at TTYDE3 does not
reset TTYFK.

Solution: Do so. (SETONE TTPFK,(T2))

[End of TCO 5.1.1108]


TOPS20 Change Order Number 5.1.1109

Written by: GRANT		18-Nov-82 09:27:02

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	MEXEC	TTPHDV	TTYSRV

Related TCO's:
Related SPR's:


Problem: User dials in and gets an already-logged-in job.

Diagnosis: The job was created by a dial up user who SETHOSTed to another
	system.  Carrier was lost but the TTY block was not destroyed.

Solution: In the carrier off code, insert a check for a DECnet NVT link.
	If yes, throw the SETHOST's escape character at the user and cause
	the TTY block to be deassigned.
[End of TCO 5.1.1109]


TOPS20 Change Order Number 5.1.1110

Written by: PAETZOLD		18-Nov-82 14:01:55

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's:


Problem:

Random crashes (like ILMNRF's) from the GFLT0 code in APRSRV.  The MCENTR
after the opcode compares trashes some ACs.

Diagnosis:

Engineer brain damage.

Solution:

Go NOINT before the data fetchs and then refetch the data after the MCENTR
sends us into JSYS context.


[End of TCO 5.1.1110]


TOPS20 Change Order Number 5.1.1112

Written by: MURPHY		 2-Dec-82 18:41:44

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	JSYSF

Related TCO's:
Related SPR's:


Problem: SMAP% allows execute-only file to be read.

Diagnosis: No check for READF present before mapping file.

Solution: Add a check.

[End of TCO 5.1.1112]


TOPS20 Change Order Number 5.1.1113

Written by: MURPHY		 2-Dec-82 18:45:41

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	PAGEM

Related TCO's:
Related SPR's:


Problem: SMAP% allows read-only files to be written in certain
obscure but easily reproduced circumstances.  In particular,
doing SMAP% "no-indirect" to a section which is already
indirect will lose the access of the indirect section.

Diagnosis: In MSETST, there is a call to "compress out
indirect pointers".  In the process, the lack of write
access is also compressed out.  In fact, indirect pointers
should not be compressed out here.

Solution: Don't eliminate indirect pointers.  Simply duplicate
the pointer at the next level, with its access, as originally
specified.

[End of TCO 5.1.1113]


TOPS20 Change Order Number 5.1.1114

Written by: MURPHY		14-Dec-82 09:35:23

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	TTPHDV

Related TCO's:
Related SPR's:


Problem: XOFF/XON logic busted for incoming characters.  XOFF is
sent, but XON is not sent.

Diagnosis: Missing index on instruction to check for active line--
hence, line always appears inactive and no XON is sent.

Solution: Add the index.

[End of TCO 5.1.1114]


TOPS20 Change Order Number 5.1.1115

Written by: COBB		20-Dec-82 19:47:18

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	diag

Related TCO's:
Related SPR's:


Problem: System crashes when setting a device on-line.

Diagnosis: Not just any device will do.  The path for checking this device's
existance/on-line-ness must cause a BUGCHK.  BUGCHK code CALLs DGFKIL, which
releases any DIAG% resources this fork has.  Since SET ONLINE does a DIAG%
JSYS, we have some of these goodies and this call releases them.  Fine.  Then,
since there's no error-returns to pass things up the stack, we return into
the DIAG% code and try to release these resources again.  BUGHLT DGUTPG!

Solution: In routine at DGPDL2 plus some, check for DIAGFK = -1, if so, don't
try to release the resources, don't crash, etc.

[End of TCO 5.1.1115]


TOPS20 Change Order Number 5.1.1116

Written by: COBB		20-Dec-82 19:57:11

Edit checked: NO			   Document: YES
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	NSPSRV	BUGS

Related TCO's:
Related SPR's:


Problem: GLFNF BUGHLTs

Diagnosis: Fork which enabled for Network Topology Interrupts has been killed
somehow without releasing its slot in the table of topology watchers.  Why?
I don't know.  Code in KSELF looks correct.

Solution: Check for Topology watching bit on in FKQ2 before calling PSIRQ for
that fork.  If we're not watching, BUGCHK to complain, release the table slot,
and return.  BUGCHK is ENTWIT (Erroneous Network Topology Watcher In Table).

[End of TCO 5.1.1116]


TOPS20 Change Order Number 5.1.1117

Written by: COBB		 4-Jan-83 16:09:49

Edit checked: NO			   Document: NO
  TCO Tested: NO		Maintenance Release: NO
Hardware-related: NO

Program: MONITOR
   Routines Affected:	APRSRV

Related TCO's:
Related SPR's: 


Problem: Bad byte pointers can crash the system.

Diagnosis: 1 fix to KIMXCT was not enough.  Right now, the right byte pointer
passed to a JSYS should ITRAP, but since an AC is not set up properly, we
ILLUUO anyway.

Solution: Set up AC to dispatch to ITRAP, then go through the code to check for
a real ILLUUO.

[End of TCO 5.1.1117]

